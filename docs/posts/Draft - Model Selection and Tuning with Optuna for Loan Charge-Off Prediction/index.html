<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Smith">
<meta name="dcterms.date" content="2024-02-04">

<title>djs - Portfolio - Charge-Off Prediction With a Neural Network Tuned Using Optuna</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">djs - Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Charge-Off Prediction With a Neural Network Tuned Using Optuna</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">Pandas</div>
    <div class="quarto-category">TensorFlow</div>
    <div class="quarto-category">Optuna</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Smith </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 4, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="cell-1" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, StratifiedKFold</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, f1_score</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, Dropout</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optuna</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From C:\Users\Daniel\anaconda3\lib\site-packages\keras\src\losses.py:2976: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Daniel\anaconda3\lib\site-packages\tqdm\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm</code></pre>
</div>
</div>
<div id="cell-2" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Python version:"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>python <span class="op">--</span>version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python version:
Python 3.10.9</code></pre>
</div>
</div>
<div id="cell-3" class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optuna version:"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(optuna.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optuna version:
3.5.0</code></pre>
</div>
</div>
<div id="cell-4" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TensorFlow version:"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tf.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorFlow version:
2.15.0</code></pre>
</div>
</div>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">—-</h2>
<p>There are many LendingClub data sets on Kaggle. Here is the information on this particular data set:</p>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
LoanStatNew
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
loan_amnt
</td>
<td>
The listed amount of the loan applied for by the borrower. If at some point in time, the credit department reduces the loan amount, then it will be reflected in this value.
</td>
</tr>
<tr>
<th>
1
</th>
<td>
term
</td>
<td>
The number of payments on the loan. Values are in months and can be either 36 or 60.
</td>
</tr>
<tr>
<th>
2
</th>
<td>
int_rate
</td>
<td>
Interest Rate on the loan
</td>
</tr>
<tr>
<th>
3
</th>
<td>
installment
</td>
<td>
The monthly payment owed by the borrower if the loan originates.
</td>
</tr>
<tr>
<th>
4
</th>
<td>
grade
</td>
<td>
LC assigned loan grade
</td>
</tr>
<tr>
<th>
5
</th>
<td>
sub_grade
</td>
<td>
LC assigned loan subgrade
</td>
</tr>
<tr>
<th>
6
</th>
<td>
emp_title
</td>
<td>
The job title supplied by the Borrower when applying for the loan.*
</td>
</tr>
<tr>
<th>
7
</th>
<td>
emp_length
</td>
<td>
Employment length in years. Possible values are between 0 and 10 where 0 means less than one year and 10 means ten or more years.
</td>
</tr>
<tr>
<th>
8
</th>
<td>
home_ownership
</td>
<td>
The home ownership status provided by the borrower during registration&nbsp;or obtained from the credit report.&nbsp;Our values are: RENT, OWN, MORTGAGE, OTHER
</td>
</tr>
<tr>
<th>
9
</th>
<td>
annual_inc
</td>
<td>
The self-reported annual income provided by the borrower during registration.
</td>
</tr>
<tr>
<th>
10
</th>
<td>
verification_status
</td>
<td>
Indicates if income was verified by LC, not verified, or if the income source was verified
</td>
</tr>
<tr>
<th>
11
</th>
<td>
issue_d
</td>
<td>
The month which the loan was funded
</td>
</tr>
<tr>
<th>
12
</th>
<td>
loan_status
</td>
<td>
Current status of the loan
</td>
</tr>
<tr>
<th>
13
</th>
<td>
purpose
</td>
<td>
A category provided by the borrower for the loan request.
</td>
</tr>
<tr>
<th>
14
</th>
<td>
title
</td>
<td>
The loan title provided by the borrower
</td>
</tr>
<tr>
<th>
15
</th>
<td>
zip_code
</td>
<td>
The first 3 numbers of the zip code provided by the borrower in the loan application.
</td>
</tr>
<tr>
<th>
16
</th>
<td>
addr_state
</td>
<td>
The state provided by the borrower in the loan application
</td>
</tr>
<tr>
<th>
17
</th>
<td>
dti
</td>
<td>
A ratio calculated using the borrower’s total monthly debt payments on the total debt obligations, excluding mortgage and the requested LC loan, divided by the borrower’s self-reported monthly income.
</td>
</tr>
<tr>
<th>
18
</th>
<td>
earliest_cr_line
</td>
<td>
The month the borrower’s earliest reported credit line was opened
</td>
</tr>
<tr>
<th>
19
</th>
<td>
open_acc
</td>
<td>
The number of open credit lines in the borrower’s credit file.
</td>
</tr>
<tr>
<th>
20
</th>
<td>
pub_rec
</td>
<td>
Number of derogatory public records
</td>
</tr>
<tr>
<th>
21
</th>
<td>
revol_bal
</td>
<td>
Total credit revolving balance
</td>
</tr>
<tr>
<th>
22
</th>
<td>
revol_util
</td>
<td>
Revolving line utilization rate, or the amount of credit the borrower is using relative to all available revolving credit.
</td>
</tr>
<tr>
<th>
23
</th>
<td>
total_acc
</td>
<td>
The total number of credit lines currently in the borrower’s credit file
</td>
</tr>
<tr>
<th>
24
</th>
<td>
initial_list_status
</td>
<td>
The initial listing status of the loan. Possible values are – W, F
</td>
</tr>
<tr>
<th>
25
</th>
<td>
application_type
</td>
<td>
Indicates whether the loan is an individual application or a joint application with two co-borrowers
</td>
</tr>
<tr>
<th>
26
</th>
<td>
mort_acc
</td>
<td>
Number of mortgage accounts.
</td>
</tr>
<tr>
<th>
27
</th>
<td>
pub_rec_bankruptcies
</td>
<td>
Number of public record bankruptcies
</td>
</tr>
</tbody>
</table>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">—</h2>
<div id="cell-6" class="cell" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'lending_club_loan.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 396030 entries, 0 to 396029
Data columns (total 27 columns):
 #   Column                Non-Null Count   Dtype  
---  ------                --------------   -----  
 0   loan_amnt             396030 non-null  float64
 1   term                  396030 non-null  object 
 2   int_rate              396030 non-null  float64
 3   installment           396030 non-null  float64
 4   grade                 396030 non-null  object 
 5   sub_grade             396030 non-null  object 
 6   emp_title             373103 non-null  object 
 7   emp_length            377729 non-null  object 
 8   home_ownership        396030 non-null  object 
 9   annual_inc            396030 non-null  float64
 10  verification_status   396030 non-null  object 
 11  issue_d               396030 non-null  object 
 12  loan_status           396030 non-null  object 
 13  purpose               396030 non-null  object 
 14  title                 394274 non-null  object 
 15  dti                   396030 non-null  float64
 16  earliest_cr_line      396030 non-null  object 
 17  open_acc              396030 non-null  float64
 18  pub_rec               396030 non-null  float64
 19  revol_bal             396030 non-null  float64
 20  revol_util            395754 non-null  float64
 21  total_acc             396030 non-null  float64
 22  initial_list_status   396030 non-null  object 
 23  application_type      396030 non-null  object 
 24  mort_acc              358235 non-null  float64
 25  pub_rec_bankruptcies  395495 non-null  float64
 26  address               396030 non-null  object 
dtypes: float64(12), object(15)
memory usage: 81.6+ MB</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">int_rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">grade</th>
<th data-quarto-table-cell-role="th">sub_grade</th>
<th data-quarto-table-cell-role="th">emp_title</th>
<th data-quarto-table-cell-role="th">emp_length</th>
<th data-quarto-table-cell-role="th">home_ownership</th>
<th data-quarto-table-cell-role="th">annual_inc</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">open_acc</th>
<th data-quarto-table-cell-role="th">pub_rec</th>
<th data-quarto-table-cell-role="th">revol_bal</th>
<th data-quarto-table-cell-role="th">revol_util</th>
<th data-quarto-table-cell-role="th">total_acc</th>
<th data-quarto-table-cell-role="th">initial_list_status</th>
<th data-quarto-table-cell-role="th">application_type</th>
<th data-quarto-table-cell-role="th">mort_acc</th>
<th data-quarto-table-cell-role="th">pub_rec_bankruptcies</th>
<th data-quarto-table-cell-role="th">address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10000.0</td>
<td>36 months</td>
<td>11.44</td>
<td>329.48</td>
<td>B</td>
<td>B4</td>
<td>Marketing</td>
<td>10+ years</td>
<td>RENT</td>
<td>117000.0</td>
<td>...</td>
<td>16.0</td>
<td>0.0</td>
<td>36369.0</td>
<td>41.8</td>
<td>25.0</td>
<td>w</td>
<td>INDIVIDUAL</td>
<td>0.0</td>
<td>0.0</td>
<td>0174 Michelle Gateway\r\nMendozaberg, OK 22690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8000.0</td>
<td>36 months</td>
<td>11.99</td>
<td>265.68</td>
<td>B</td>
<td>B5</td>
<td>Credit analyst</td>
<td>4 years</td>
<td>MORTGAGE</td>
<td>65000.0</td>
<td>...</td>
<td>17.0</td>
<td>0.0</td>
<td>20131.0</td>
<td>53.3</td>
<td>27.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>3.0</td>
<td>0.0</td>
<td>1076 Carney Fort Apt. 347\r\nLoganmouth, SD 05113</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>15600.0</td>
<td>36 months</td>
<td>10.49</td>
<td>506.97</td>
<td>B</td>
<td>B3</td>
<td>Statistician</td>
<td>&lt; 1 year</td>
<td>RENT</td>
<td>43057.0</td>
<td>...</td>
<td>13.0</td>
<td>0.0</td>
<td>11987.0</td>
<td>92.2</td>
<td>26.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>0.0</td>
<td>0.0</td>
<td>87025 Mark Dale Apt. 269\r\nNew Sabrina, WV 05113</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7200.0</td>
<td>36 months</td>
<td>6.49</td>
<td>220.65</td>
<td>A</td>
<td>A2</td>
<td>Client Advocate</td>
<td>6 years</td>
<td>RENT</td>
<td>54000.0</td>
<td>...</td>
<td>6.0</td>
<td>0.0</td>
<td>5472.0</td>
<td>21.5</td>
<td>13.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>0.0</td>
<td>0.0</td>
<td>823 Reid Ford\r\nDelacruzside, MA 00813</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24375.0</td>
<td>60 months</td>
<td>17.27</td>
<td>609.33</td>
<td>C</td>
<td>C5</td>
<td>Destiny Management Inc.</td>
<td>9 years</td>
<td>MORTGAGE</td>
<td>55000.0</td>
<td>...</td>
<td>13.0</td>
<td>0.0</td>
<td>24584.0</td>
<td>69.8</td>
<td>43.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>1.0</td>
<td>0.0</td>
<td>679 Luna Roads\r\nGreggshire, VA 11650</td>
</tr>
</tbody>
</table>

<p>5 rows × 27 columns</p>
</div>
</div>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<div id="cell-10" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">'loan_status'</span>,data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-11" class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sns.displot(df[<span class="st">'loan_amnt'</span>],kde<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-12" class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">int_rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">annual_inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">open_acc</th>
<th data-quarto-table-cell-role="th">pub_rec</th>
<th data-quarto-table-cell-role="th">revol_bal</th>
<th data-quarto-table-cell-role="th">revol_util</th>
<th data-quarto-table-cell-role="th">total_acc</th>
<th data-quarto-table-cell-role="th">mort_acc</th>
<th data-quarto-table-cell-role="th">pub_rec_bankruptcies</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">loan_amnt</td>
<td>1.000000</td>
<td>0.168921</td>
<td>0.953929</td>
<td>0.336887</td>
<td>0.016636</td>
<td>0.198556</td>
<td>-0.077779</td>
<td>0.328320</td>
<td>0.099911</td>
<td>0.223886</td>
<td>0.222315</td>
<td>-0.106539</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">int_rate</td>
<td>0.168921</td>
<td>1.000000</td>
<td>0.162758</td>
<td>-0.056771</td>
<td>0.079038</td>
<td>0.011649</td>
<td>0.060986</td>
<td>-0.011280</td>
<td>0.293659</td>
<td>-0.036404</td>
<td>-0.082583</td>
<td>0.057450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">installment</td>
<td>0.953929</td>
<td>0.162758</td>
<td>1.000000</td>
<td>0.330381</td>
<td>0.015786</td>
<td>0.188973</td>
<td>-0.067892</td>
<td>0.316455</td>
<td>0.123915</td>
<td>0.202430</td>
<td>0.193694</td>
<td>-0.098628</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">annual_inc</td>
<td>0.336887</td>
<td>-0.056771</td>
<td>0.330381</td>
<td>1.000000</td>
<td>-0.081685</td>
<td>0.136150</td>
<td>-0.013720</td>
<td>0.299773</td>
<td>0.027871</td>
<td>0.193023</td>
<td>0.236320</td>
<td>-0.050162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">dti</td>
<td>0.016636</td>
<td>0.079038</td>
<td>0.015786</td>
<td>-0.081685</td>
<td>1.000000</td>
<td>0.136181</td>
<td>-0.017639</td>
<td>0.063571</td>
<td>0.088375</td>
<td>0.102128</td>
<td>-0.025439</td>
<td>-0.014558</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">open_acc</td>
<td>0.198556</td>
<td>0.011649</td>
<td>0.188973</td>
<td>0.136150</td>
<td>0.136181</td>
<td>1.000000</td>
<td>-0.018392</td>
<td>0.221192</td>
<td>-0.131420</td>
<td>0.680728</td>
<td>0.109205</td>
<td>-0.027732</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pub_rec</td>
<td>-0.077779</td>
<td>0.060986</td>
<td>-0.067892</td>
<td>-0.013720</td>
<td>-0.017639</td>
<td>-0.018392</td>
<td>1.000000</td>
<td>-0.101664</td>
<td>-0.075910</td>
<td>0.019723</td>
<td>0.011552</td>
<td>0.699408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">revol_bal</td>
<td>0.328320</td>
<td>-0.011280</td>
<td>0.316455</td>
<td>0.299773</td>
<td>0.063571</td>
<td>0.221192</td>
<td>-0.101664</td>
<td>1.000000</td>
<td>0.226346</td>
<td>0.191616</td>
<td>0.194925</td>
<td>-0.124532</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">revol_util</td>
<td>0.099911</td>
<td>0.293659</td>
<td>0.123915</td>
<td>0.027871</td>
<td>0.088375</td>
<td>-0.131420</td>
<td>-0.075910</td>
<td>0.226346</td>
<td>1.000000</td>
<td>-0.104273</td>
<td>0.007514</td>
<td>-0.086751</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">total_acc</td>
<td>0.223886</td>
<td>-0.036404</td>
<td>0.202430</td>
<td>0.193023</td>
<td>0.102128</td>
<td>0.680728</td>
<td>0.019723</td>
<td>0.191616</td>
<td>-0.104273</td>
<td>1.000000</td>
<td>0.381072</td>
<td>0.042035</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">mort_acc</td>
<td>0.222315</td>
<td>-0.082583</td>
<td>0.193694</td>
<td>0.236320</td>
<td>-0.025439</td>
<td>0.109205</td>
<td>0.011552</td>
<td>0.194925</td>
<td>0.007514</td>
<td>0.381072</td>
<td>1.000000</td>
<td>0.027239</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pub_rec_bankruptcies</td>
<td>-0.106539</td>
<td>0.057450</td>
<td>-0.098628</td>
<td>-0.050162</td>
<td>-0.014558</td>
<td>-0.027732</td>
<td>0.699408</td>
<td>-0.124532</td>
<td>-0.086751</td>
<td>0.042035</td>
<td>0.027239</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-13" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df.corr(numeric_only<span class="op">=</span><span class="va">True</span>),annot<span class="op">=</span><span class="va">True</span>,cmap<span class="op">=</span><span class="st">'viridis'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-14" class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df,x<span class="op">=</span><span class="st">'installment'</span>,y<span class="op">=</span><span class="st">'loan_amnt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-15" class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df,x<span class="op">=</span><span class="st">'loan_status'</span>,y<span class="op">=</span><span class="st">'loan_amnt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-16" class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'loan_status'</span>)[<span class="st">'loan_amnt'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">loan_status</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Charged Off</td>
<td>77673.0</td>
<td>15126.300967</td>
<td>8505.090557</td>
<td>1000.0</td>
<td>8525.0</td>
<td>14000.0</td>
<td>20000.0</td>
<td>40000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Fully Paid</td>
<td>318357.0</td>
<td>13866.878771</td>
<td>8302.319699</td>
<td>500.0</td>
<td>7500.0</td>
<td>12000.0</td>
<td>19225.0</td>
<td>40000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-17" class="cell" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'grade'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array(['B', 'A', 'C', 'E', 'D', 'F', 'G'], dtype=object)</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sub_grade'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array(['B4', 'B5', 'B3', 'A2', 'C5', 'C3', 'A1', 'B2', 'C1', 'A5', 'E4',
       'A4', 'A3', 'D1', 'C2', 'B1', 'D3', 'D5', 'D2', 'E1', 'E2', 'E5',
       'F4', 'E3', 'D4', 'G1', 'F5', 'G2', 'C4', 'F1', 'F3', 'G5', 'G4',
       'F2', 'G3'], dtype=object)</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,x<span class="op">=</span><span class="st">'grade'</span>,hue<span class="op">=</span><span class="st">'loan_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-20" class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>subgrade_order <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'sub_grade'</span>].unique())</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'sub_grade'</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>subgrade_order,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>              hue<span class="op">=</span><span class="st">'loan_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-21" class="cell" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>f_g <span class="op">=</span> df[(df[<span class="st">'grade'</span>] <span class="op">==</span> <span class="st">'G'</span>) <span class="op">|</span> (df[<span class="st">'grade'</span>] <span class="op">==</span> <span class="st">'F'</span>)]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>subgrade_order <span class="op">=</span> <span class="bu">sorted</span>(f_g[<span class="st">'sub_grade'</span>].unique())</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>f_g,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'sub_grade'</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>subgrade_order,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>              hue<span class="op">=</span><span class="st">'loan_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="missing-values-and-feature-engineering" class="level1">
<h1>Missing Values and Feature Engineering</h1>
<div id="cell-23" class="cell" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'loan_repaid'</span>] <span class="op">=</span> (df[<span class="st">'loan_status'</span>] <span class="op">==</span> <span class="st">'Fully Paid'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'loan_repaid'</span>,<span class="st">'loan_status'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_repaid</th>
<th data-quarto-table-cell-role="th">loan_status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>Charged Off</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396025</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396026</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396027</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396028</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396029</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
</tbody>
</table>

<p>396030 rows × 2 columns</p>
</div>
</div>
</div>
<div id="cell-24" class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)[<span class="st">'loan_repaid'</span>].sort_values().drop(<span class="st">'loan_repaid'</span>).plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-25" class="cell" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>loan_amnt                   0
term                        0
int_rate                    0
installment                 0
grade                       0
sub_grade                   0
emp_title               22927
emp_length              18301
home_ownership              0
annual_inc                  0
verification_status         0
issue_d                     0
loan_status                 0
purpose                     0
title                    1756
dti                         0
earliest_cr_line            0
open_acc                    0
pub_rec                     0
revol_bal                   0
revol_util                276
total_acc                   0
initial_list_status         0
application_type            0
mort_acc                37795
pub_rec_bankruptcies      535
address                     0
loan_repaid                 0
dtype: int64</code></pre>
</div>
</div>
<div id="cell-26" class="cell" data-tags="[]" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percentage_null(df):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    percentage_missing <span class="op">=</span> (df.isnull().<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(df))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Percentages of values missing:</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(percentage_missing.<span class="bu">round</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.00
term                    0.00
int_rate                0.00
installment             0.00
grade                   0.00
sub_grade               0.00
emp_title               5.79
emp_length              4.62
home_ownership          0.00
annual_inc              0.00
verification_status     0.00
issue_d                 0.00
loan_status             0.00
purpose                 0.00
title                   0.44
dti                     0.00
earliest_cr_line        0.00
open_acc                0.00
pub_rec                 0.00
revol_bal               0.00
revol_util              0.07
total_acc               0.00
initial_list_status     0.00
application_type        0.00
mort_acc                9.54
pub_rec_bankruptcies    0.14
address                 0.00
loan_repaid             0.00
dtype: float64</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'title'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0                        Vacation
1              Debt consolidation
2         Credit card refinancing
3         Credit card refinancing
4           Credit Card Refinance
                   ...           
396025         Debt consolidation
396026         Debt consolidation
396027       pay off credit cards
396028              Loanforpayoff
396029          Toxic Debt Payoff
Name: title, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div id="cell-29" class="cell" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'purpose'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0                   vacation
1         debt_consolidation
2                credit_card
3                credit_card
4                credit_card
                 ...        
396025    debt_consolidation
396026    debt_consolidation
396027    debt_consolidation
396028    debt_consolidation
396029    debt_consolidation
Name: purpose, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div id="cell-30" class="cell" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'title'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="emp_title-and-emp_length" class="level2">
<h2 class="anchored" data-anchor-id="emp_title-and-emp_length"><code>emp_title</code> and <code>emp_length</code></h2>
<div id="cell-32" class="cell" data-tags="[]" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'emp_title'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0                        Marketing
1                  Credit analyst 
2                     Statistician
3                  Client Advocate
4          Destiny Management Inc.
                    ...           
396025            licensed bankere
396026                       Agent
396027                City Carrier
396028        Gracon Services, Inc
396029    Internal Revenue Service
Name: emp_title, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-tags="[]" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'emp_title'</span>].nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>173105</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'emp_title'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'emp_length'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0         10+ years
1           4 years
2          &lt; 1 year
3           6 years
4           9 years
            ...    
396025      2 years
396026      5 years
396027    10+ years
396028    10+ years
396029    10+ years
Name: emp_length, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-tags="[]" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(df[<span class="st">'emp_length'</span>].dropna().unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>['1 year',
 '10+ years',
 '2 years',
 '3 years',
 '4 years',
 '5 years',
 '6 years',
 '7 years',
 '8 years',
 '9 years',
 '&lt; 1 year']</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-tags="[]" data-execution_count="33">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ordered_emp_lengths <span class="op">=</span> [<span class="st">'&lt; 1 year'</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'1 year'</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'2 years'</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'3 years'</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'4 years'</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'5 years'</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'6 years'</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'7 years'</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'8 years'</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'9 years'</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'10+ years'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-38" class="cell" data-tags="[]" data-execution_count="34">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'emp_length'</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>ordered_emp_lengths,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span><span class="st">'viridis'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Daniel\AppData\Local\Temp\ipykernel_19984\1779251200.py:2: FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

  sns.countplot(data=df,</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-35-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell" data-tags="[]" data-execution_count="35">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'emp_length'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>ordered_emp_lengths,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>              hue<span class="op">=</span><span class="st">'loan_repaid'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-40" class="cell" data-tags="[]" data-execution_count="36">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>emp_co <span class="op">=</span> df[df[<span class="st">'loan_repaid'</span>] <span class="op">==</span> <span class="dv">0</span>].groupby(<span class="st">'emp_length'</span>).count()[<span class="st">'loan_repaid'</span>]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>emp_fp <span class="op">=</span> df[df[<span class="st">'loan_repaid'</span>] <span class="op">==</span> <span class="dv">1</span>].groupby(<span class="st">'emp_length'</span>).count()[<span class="st">'loan_repaid'</span>]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">2</span>))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>((emp_co<span class="op">/</span>(emp_fp<span class="op">+</span>emp_co))<span class="op">*</span><span class="dv">100</span>).plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-41" class="cell" data-tags="[]" data-execution_count="37">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'emp_length'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filling-mort_acc-using-total_acc" class="level2">
<h2 class="anchored" data-anchor-id="filling-mort_acc-using-total_acc">Filling <code>mort_acc</code> using <code>total_acc</code></h2>
<div id="cell-43" class="cell" data-tags="[]" data-execution_count="38">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.00
term                    0.00
int_rate                0.00
installment             0.00
grade                   0.00
sub_grade               0.00
home_ownership          0.00
annual_inc              0.00
verification_status     0.00
issue_d                 0.00
loan_status             0.00
purpose                 0.00
dti                     0.00
earliest_cr_line        0.00
open_acc                0.00
pub_rec                 0.00
revol_bal               0.00
revol_util              0.07
total_acc               0.00
initial_list_status     0.00
application_type        0.00
mort_acc                9.54
pub_rec_bankruptcies    0.14
address                 0.00
loan_repaid             0.00
dtype: float64</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'mort_acc'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>mort_acc
0.0     139777
1.0      60416
2.0      49948
3.0      38049
4.0      27887
5.0      18194
6.0      11069
7.0       6052
8.0       3121
9.0       1656
10.0       865
11.0       479
12.0       264
13.0       146
14.0       107
15.0        61
16.0        37
17.0        22
18.0        18
19.0        15
20.0        13
24.0        10
22.0         7
21.0         4
25.0         4
27.0         3
32.0         2
31.0         2
23.0         2
26.0         2
28.0         1
30.0         1
34.0         1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-tags="[]" data-execution_count="40">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)[<span class="st">'mort_acc'</span>].sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>int_rate               -0.082583
dti                    -0.025439
revol_util              0.007514
pub_rec                 0.011552
pub_rec_bankruptcies    0.027239
loan_repaid             0.073111
open_acc                0.109205
installment             0.193694
revol_bal               0.194925
loan_amnt               0.222315
annual_inc              0.236320
total_acc               0.381072
mort_acc                1.000000
Name: mort_acc, dtype: float64</code></pre>
</div>
</div>
<div id="cell-46" class="cell" data-tags="[]" data-execution_count="41">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>total_acc_avgs <span class="op">=</span> df.groupby(<span class="st">'total_acc'</span>).mean(numeric_only<span class="op">=</span><span class="va">True</span>)[<span class="st">'mort_acc'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell" data-tags="[]" data-execution_count="42">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill_mort_acc(total_acc,mort_acc):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(mort_acc):</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total_acc_avgs[total_acc]</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mort_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell" data-tags="[]" data-execution_count="43">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'mort_acc'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: fill_mort_acc(x[<span class="st">'total_acc'</span>],x[<span class="st">'mort_acc'</span>]),axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-49" class="cell" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>loan_amnt                 0
term                      0
int_rate                  0
installment               0
grade                     0
sub_grade                 0
home_ownership            0
annual_inc                0
verification_status       0
issue_d                   0
loan_status               0
purpose                   0
dti                       0
earliest_cr_line          0
open_acc                  0
pub_rec                   0
revol_bal                 0
revol_util              276
total_acc                 0
initial_list_status       0
application_type          0
mort_acc                  0
pub_rec_bankruptcies    535
address                   0
loan_repaid               0
dtype: int64</code></pre>
</div>
</div>
<div id="cell-50" class="cell" data-tags="[]" data-execution_count="45">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.00
term                    0.00
int_rate                0.00
installment             0.00
grade                   0.00
sub_grade               0.00
home_ownership          0.00
annual_inc              0.00
verification_status     0.00
issue_d                 0.00
loan_status             0.00
purpose                 0.00
dti                     0.00
earliest_cr_line        0.00
open_acc                0.00
pub_rec                 0.00
revol_bal               0.00
revol_util              0.07
total_acc               0.00
initial_list_status     0.00
application_type        0.00
mort_acc                0.00
pub_rec_bankruptcies    0.14
address                 0.00
loan_repaid             0.00
dtype: float64</code></pre>
</div>
</div>
<div id="cell-51" class="cell" data-tags="[]" data-execution_count="46">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-52" class="cell" data-scrolled="true" data-tags="[]" data-execution_count="47">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.0
term                    0.0
int_rate                0.0
installment             0.0
grade                   0.0
sub_grade               0.0
home_ownership          0.0
annual_inc              0.0
verification_status     0.0
issue_d                 0.0
loan_status             0.0
purpose                 0.0
dti                     0.0
earliest_cr_line        0.0
open_acc                0.0
pub_rec                 0.0
revol_bal               0.0
revol_util              0.0
total_acc               0.0
initial_list_status     0.0
application_type        0.0
mort_acc                0.0
pub_rec_bankruptcies    0.0
address                 0.0
loan_repaid             0.0
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="categorical-features" class="level2">
<h2 class="anchored" data-anchor-id="categorical-features">Categorical Features</h2>
<div id="cell-54" class="cell" data-tags="[]" data-execution_count="48">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df.select_dtypes([<span class="st">'object'</span>]).columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>Index(['term', 'grade', 'sub_grade', 'home_ownership', 'verification_status',
       'issue_d', 'loan_status', 'purpose', 'earliest_cr_line',
       'initial_list_status', 'application_type', 'address'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-tags="[]" data-execution_count="49">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'term'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>term
 36 months    301247
 60 months     93972
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-56" class="cell" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'term'</span>] <span class="op">=</span> df[<span class="st">'term'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x.split()[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-tags="[]" data-execution_count="51">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'term'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0         36
1         36
2         36
3         36
4         60
          ..
396025    60
396026    36
396027    36
396028    60
396029    36
Name: term, Length: 395219, dtype: int64</code></pre>
</div>
</div>
<div id="cell-58" class="cell" data-tags="[]" data-execution_count="52">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'zip_code'</span>] <span class="op">=</span> df[<span class="st">'address'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> address: address[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-59" class="cell" data-tags="[]" data-execution_count="53">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'zip_code'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>zip_code
70466    56880
22690    56413
30723    56402
48052    55811
00813    45725
29597    45393
05113    45300
11650    11210
93700    11126
86630    10959
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-tags="[]" data-execution_count="54">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'home_ownership'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>home_ownership
MORTGAGE    198022
RENT        159395
OWN          37660
OTHER          110
NONE            29
ANY              3
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'home_ownership'</span>] <span class="op">=</span> df[<span class="st">'home_ownership'</span>].replace([<span class="st">'NONE'</span>,<span class="st">'ANY'</span>],<span class="st">'OTHER'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell" data-tags="[]" data-execution_count="56">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'home_ownership'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>home_ownership
MORTGAGE    198022
RENT        159395
OWN          37660
OTHER          142
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-63" class="cell" data-tags="[]" data-execution_count="57">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>columns_to_1hot <span class="op">=</span> [<span class="st">'home_ownership'</span>,</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'verification_status'</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'application_type'</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'initial_list_status'</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'purpose'</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'zip_code'</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'sub_grade'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-64" class="cell" data-tags="[]" data-execution_count="58">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(data<span class="op">=</span>df,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>                    columns<span class="op">=</span>columns_to_1hot,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                    drop_first<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                    dtype<span class="op">=</span><span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell" data-tags="[]" data-execution_count="59">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>Index(['loan_amnt', 'term', 'int_rate', 'installment', 'grade', 'annual_inc',
       'issue_d', 'loan_status', 'dti', 'earliest_cr_line', 'open_acc',
       'pub_rec', 'revol_bal', 'revol_util', 'total_acc', 'mort_acc',
       'pub_rec_bankruptcies', 'address', 'loan_repaid',
       'home_ownership_OTHER', 'home_ownership_OWN', 'home_ownership_RENT',
       'verification_status_Source Verified', 'verification_status_Verified',
       'application_type_INDIVIDUAL', 'application_type_JOINT',
       'initial_list_status_w', 'purpose_credit_card',
       'purpose_debt_consolidation', 'purpose_educational',
       'purpose_home_improvement', 'purpose_house', 'purpose_major_purchase',
       'purpose_medical', 'purpose_moving', 'purpose_other',
       'purpose_renewable_energy', 'purpose_small_business',
       'purpose_vacation', 'purpose_wedding', 'zip_code_05113',
       'zip_code_11650', 'zip_code_22690', 'zip_code_29597', 'zip_code_30723',
       'zip_code_48052', 'zip_code_70466', 'zip_code_86630', 'zip_code_93700',
       'sub_grade_A2', 'sub_grade_A3', 'sub_grade_A4', 'sub_grade_A5',
       'sub_grade_B1', 'sub_grade_B2', 'sub_grade_B3', 'sub_grade_B4',
       'sub_grade_B5', 'sub_grade_C1', 'sub_grade_C2', 'sub_grade_C3',
       'sub_grade_C4', 'sub_grade_C5', 'sub_grade_D1', 'sub_grade_D2',
       'sub_grade_D3', 'sub_grade_D4', 'sub_grade_D5', 'sub_grade_E1',
       'sub_grade_E2', 'sub_grade_E3', 'sub_grade_E4', 'sub_grade_E5',
       'sub_grade_F1', 'sub_grade_F2', 'sub_grade_F3', 'sub_grade_F4',
       'sub_grade_F5', 'sub_grade_G1', 'sub_grade_G2', 'sub_grade_G3',
       'sub_grade_G4', 'sub_grade_G5'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-66" class="cell" data-tags="[]" data-execution_count="60">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'earliest_cr_line'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>0         Jun-1990
1         Jul-2004
2         Aug-2007
3         Sep-2006
4         Mar-1999
            ...   
396025    Nov-2004
396026    Feb-2006
396027    Mar-1997
396028    Nov-1990
396029    Sep-1998
Name: earliest_cr_line, Length: 395219, dtype: object</code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-tags="[]" data-execution_count="61">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'earliest_cr_year'</span>] <span class="op">=</span> df[<span class="st">'earliest_cr_line'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x.split(<span class="st">'-'</span>)[<span class="op">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-68" class="cell" data-tags="[]" data-execution_count="62">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'earliest_cr_year'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>0         1990
1         2004
2         2007
3         2006
4         1999
          ... 
396025    2004
396026    2006
396027    1997
396028    1990
396029    1998
Name: earliest_cr_year, Length: 395219, dtype: int64</code></pre>
</div>
</div>
<div id="cell-69" class="cell" data-tags="[]" data-execution_count="63">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>columns_to_drop <span class="op">=</span> [<span class="st">'earliest_cr_line'</span>,</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'grade'</span>,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'issue_d'</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'loan_status'</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'address'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-70" class="cell" data-tags="[]" data-execution_count="64">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns_to_drop,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<div id="cell-72" class="cell" data-tags="[]" data-execution_count="65">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">int_rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">annual_inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">open_acc</th>
<th data-quarto-table-cell-role="th">pub_rec</th>
<th data-quarto-table-cell-role="th">revol_bal</th>
<th data-quarto-table-cell-role="th">revol_util</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">sub_grade_F2</th>
<th data-quarto-table-cell-role="th">sub_grade_F3</th>
<th data-quarto-table-cell-role="th">sub_grade_F4</th>
<th data-quarto-table-cell-role="th">sub_grade_F5</th>
<th data-quarto-table-cell-role="th">sub_grade_G1</th>
<th data-quarto-table-cell-role="th">sub_grade_G2</th>
<th data-quarto-table-cell-role="th">sub_grade_G3</th>
<th data-quarto-table-cell-role="th">sub_grade_G4</th>
<th data-quarto-table-cell-role="th">sub_grade_G5</th>
<th data-quarto-table-cell-role="th">earliest_cr_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10000.0</td>
<td>36</td>
<td>11.44</td>
<td>329.48</td>
<td>117000.0</td>
<td>26.24</td>
<td>16.0</td>
<td>0.0</td>
<td>36369.0</td>
<td>41.8</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1990</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8000.0</td>
<td>36</td>
<td>11.99</td>
<td>265.68</td>
<td>65000.0</td>
<td>22.05</td>
<td>17.0</td>
<td>0.0</td>
<td>20131.0</td>
<td>53.3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2004</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>15600.0</td>
<td>36</td>
<td>10.49</td>
<td>506.97</td>
<td>43057.0</td>
<td>12.79</td>
<td>13.0</td>
<td>0.0</td>
<td>11987.0</td>
<td>92.2</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7200.0</td>
<td>36</td>
<td>6.49</td>
<td>220.65</td>
<td>54000.0</td>
<td>2.60</td>
<td>6.0</td>
<td>0.0</td>
<td>5472.0</td>
<td>21.5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24375.0</td>
<td>60</td>
<td>17.27</td>
<td>609.33</td>
<td>55000.0</td>
<td>33.95</td>
<td>13.0</td>
<td>0.0</td>
<td>24584.0</td>
<td>69.8</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396025</td>
<td>10000.0</td>
<td>60</td>
<td>10.99</td>
<td>217.38</td>
<td>40000.0</td>
<td>15.63</td>
<td>6.0</td>
<td>0.0</td>
<td>1990.0</td>
<td>34.3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396026</td>
<td>21000.0</td>
<td>36</td>
<td>12.29</td>
<td>700.42</td>
<td>110000.0</td>
<td>21.45</td>
<td>6.0</td>
<td>0.0</td>
<td>43263.0</td>
<td>95.7</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396027</td>
<td>5000.0</td>
<td>36</td>
<td>9.99</td>
<td>161.32</td>
<td>56500.0</td>
<td>17.56</td>
<td>15.0</td>
<td>0.0</td>
<td>32704.0</td>
<td>66.9</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1997</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396028</td>
<td>21000.0</td>
<td>60</td>
<td>15.31</td>
<td>503.02</td>
<td>64000.0</td>
<td>15.88</td>
<td>9.0</td>
<td>0.0</td>
<td>15704.0</td>
<td>53.8</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1990</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396029</td>
<td>2000.0</td>
<td>36</td>
<td>13.61</td>
<td>67.98</td>
<td>42996.0</td>
<td>8.32</td>
<td>3.0</td>
<td>0.0</td>
<td>4292.0</td>
<td>91.3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1998</td>
</tr>
</tbody>
</table>

<p>395219 rows × 79 columns</p>
</div>
</div>
</div>
<section id="traintest-split" class="level2">
<h2 class="anchored" data-anchor-id="traintest-split">TRAIN/TEST SPLIT</h2>
<div id="cell-74" class="cell" data-tags="[]" data-execution_count="66">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(<span class="st">'loan_repaid'</span>, axis<span class="op">=</span><span class="dv">1</span>).values</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'loan_repaid'</span>].values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-75" class="cell" data-tags="[]" data-execution_count="67">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.05</span>, random_state<span class="op">=</span><span class="dv">594</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-76" class="cell" data-tags="[]" data-execution_count="68">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Training set shape: "</span>, X_train.shape, y_train.shape)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test set shape: "</span>, X_test.shape, y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training set shape:  (375458, 78) (375458,)
Test set shape:  (19761, 78) (19761,)</code></pre>
</div>
</div>
</section>
<section id="normalizing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="normalizing-the-data">Normalizing the Data</h2>
<div id="cell-78" class="cell" data-tags="[]" data-execution_count="69">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-79" class="cell" data-tags="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-80" class="cell" data-tags="[]" data-execution_count="71">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>X_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>array([[ 0.82301704, -0.55823002, -1.28362299, ..., -0.03076372,
        -0.02818382, -2.75955691],
       [-1.45078579, -0.55823002, -0.46740923, ..., -0.03076372,
        -0.02818382,  0.01934793],
       [-1.25930765, -0.55823002,  1.14265627, ..., -0.03076372,
        -0.02818382,  0.5751289 ],
       ...,
       [ 0.70334321, -0.55823002, -0.36901634, ..., -0.03076372,
        -0.02818382,  0.29723841],
       [ 1.90008154, -0.55823002, -0.33994571, ..., -0.03076372,
        -0.02818382, -1.78694022],
       [-0.52929727, -0.55823002, -1.17404909, ..., -0.03076372,
        -0.02818382, -0.25854255]])</code></pre>
</div>
</div>
</section>
</section>
<section id="model-selection-and-hyperparameter-tuning-with-optuna" class="level1">
<h1>Model Selection and Hyperparameter Tuning with Optuna</h1>
<p>The following two code cells implement an Optuna study to select a model with tuned hyperparameters to maximize the F1 score on the validation data.</p>
<ul>
<li><p>We tune to maximize the F1 score of the classifiers rather than other metrics (such as classification accuracy) because the target is imbalanced.</p></li>
<li><p>The model choices searched over are <code>DecisionTreeClassifier</code>, <code>RandomForestClassifier</code> and <code>LogisticRegression</code> from sklearn, <code>XGBClassifier</code> from XGBoost and artificial neural networks (of varying architecture) implemented in TensorFlow.</p></li>
<li><p>The architecture of the neural networks is also tuned. The number of hidden layers is allowed to range from 1 to 6 (inclusive) and the number of units per hidden layer ranges from 32 to 512. The only activation function considered for the hidden layers is ReLU.</p></li>
<li><p>I initially attempted to seperate the model selection and hyperparameter tuning by implementing a seperate Optuna study for each choice of model. Due to the size of the dataset this proved to be impractical.</p></li>
<li><p>Combining the model selection and hyperparameter tuning into a single Optuna study is elegant and allows for a more automated tuning process. It also allows for computational gains due to the shared hyperparameters between the tree-based models <code>DecisionTreeClasifier</code>, <code>RandomForestClassifier</code> and <code>XGBClassifier</code>. In expense for the higher degree of automation the user gains less insight into the reasons behind the model selection than they would if the model was selected manually.</p></li>
<li><p>Attempts to incorporate a support vector machine (<code>SVC</code> from sklearn) into the study failed due to the training time required.</p></li>
</ul>
<div id="cell-82" class="cell" data-tags="[]" data-execution_count="72">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> objective(trial):</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    model_type <span class="op">=</span> trial.suggest_categorical(<span class="st">'model_type'</span>, [<span class="st">'random_forest'</span>, <span class="st">'decision_tree'</span>, <span class="st">'xgboost'</span>, <span class="st">'neural_network'</span>, <span class="st">'logistic_regression'</span>])</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initializing hyperparameters and model for each possible choice of model:</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model_type <span class="kw">in</span> [<span class="st">'random_forest'</span>, <span class="st">'decision_tree'</span>, <span class="st">'xgboost'</span>]:</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Shared hyperparameters for RandomForest, DecisionTree, and XGBoost:</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>        max_depth <span class="op">=</span> trial.suggest_int(<span class="st">'max_depth'</span>, <span class="dv">2</span>, <span class="dv">32</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>        min_samples_split <span class="op">=</span> trial.suggest_int(<span class="st">'min_samples_split'</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf <span class="op">=</span> trial.suggest_int(<span class="st">'min_samples_leaf'</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'decision_tree'</span>:</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>                max_depth<span class="op">=</span>max_depth,</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>                min_samples_split<span class="op">=</span>min_samples_split,</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>                min_samples_leaf<span class="op">=</span>min_samples_leaf,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> model_type <span class="kw">in</span>  [<span class="st">'random_forest'</span>,<span class="st">'xgboost'</span>]:</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Shared hyperparameters for RandomForest and XGBoost but not DecisionTree:</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>            n_estimators <span class="op">=</span> trial.suggest_int(<span class="st">'n_estimators'</span>, <span class="dv">10</span>, <span class="dv">300</span>)</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'random_forest'</span>:</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>                    n_estimators<span class="op">=</span>n_estimators,</span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>                    max_depth<span class="op">=</span>max_depth,</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>                    min_samples_split<span class="op">=</span>min_samples_split,</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>                    min_samples_leaf<span class="op">=</span>min_samples_leaf,</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">'xgboost'</span>:</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>                learning_rate_xgb <span class="op">=</span> trial.suggest_float(<span class="st">'learning_rate_xgb'</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>)</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>                min_child_weight <span class="op">=</span> trial.suggest_int(<span class="st">'min_child_weight'</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>                subsample <span class="op">=</span> trial.suggest_float(<span class="st">'subsample'</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>)</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>                reg_alpha <span class="op">=</span> trial.suggest_float(<span class="st">'reg_alpha'</span>, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>                reg_lambda <span class="op">=</span> trial.suggest_float(<span class="st">'reg_lambda'</span>, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>                colsample_bytree <span class="op">=</span> trial.suggest_float(<span class="st">'colsample_bytree'</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>)</span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>                gamma <span class="op">=</span> trial.suggest_float(<span class="st">'gamma'</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>                    learning_rate<span class="op">=</span>learning_rate_xgb,</span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>                    n_estimators<span class="op">=</span>n_estimators,</span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>                    max_depth<span class="op">=</span>max_depth,</span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>                    min_child_weight<span class="op">=</span>min_child_weight,</span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>                    subsample<span class="op">=</span>subsample,</span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a>                    colsample_bytree<span class="op">=</span>colsample_bytree,</span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>                    gamma<span class="op">=</span>gamma,</span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>                    reg_alpha<span class="op">=</span>reg_alpha,</span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>                    reg_lambda<span class="op">=</span>reg_lambda</span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">'logistic_regression'</span>:</span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a>        C <span class="op">=</span> trial.suggest_float(<span class="st">'C'</span>, <span class="fl">1e-5</span>, <span class="fl">1e5</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> LogisticRegression(C<span class="op">=</span>C, penalty<span class="op">=</span><span class="st">'l2'</span>, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">'neural_network'</span>:</span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># NeuralNetwork-specific hyperparameters</span></span>
<span id="cb106-67"><a href="#cb106-67" aria-hidden="true" tabindex="-1"></a>        n_hidden_layers <span class="op">=</span> trial.suggest_int(<span class="st">'n_hidden_layers'</span>, <span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb106-68"><a href="#cb106-68" aria-hidden="true" tabindex="-1"></a>        learning_rate <span class="op">=</span> trial.suggest_float(<span class="st">'learning_rate'</span>, <span class="fl">1e-5</span>, <span class="fl">1e-1</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a>        batch_size <span class="op">=</span> trial.suggest_categorical(<span class="st">'batch_size'</span>,[<span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>, <span class="dv">512</span>])</span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create the model</span></span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> Sequential()</span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a>        model.add(Dense(<span class="dv">78</span>, input_dim<span class="op">=</span><span class="dv">78</span>, activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb106-75"><a href="#cb106-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-76"><a href="#cb106-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_hidden_layers):</span>
<span id="cb106-77"><a href="#cb106-77" aria-hidden="true" tabindex="-1"></a>            model.add(Dense(trial.suggest_categorical(<span class="ss">f'n_units_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, [<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]), activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb106-78"><a href="#cb106-78" aria-hidden="true" tabindex="-1"></a>            model.add(Dropout(<span class="fl">0.7</span>))</span>
<span id="cb106-79"><a href="#cb106-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-80"><a href="#cb106-80" aria-hidden="true" tabindex="-1"></a>        model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'sigmoid'</span>))</span>
<span id="cb106-81"><a href="#cb106-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-82"><a href="#cb106-82" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">compile</span>(</span>
<span id="cb106-83"><a href="#cb106-83" aria-hidden="true" tabindex="-1"></a>            loss<span class="op">=</span>tf.keras.losses.BinaryCrossentropy(),</span>
<span id="cb106-84"><a href="#cb106-84" aria-hidden="true" tabindex="-1"></a>            optimizer<span class="op">=</span>tf.keras.optimizers.Adam(learning_rate),</span>
<span id="cb106-85"><a href="#cb106-85" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb106-86"><a href="#cb106-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-87"><a href="#cb106-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Training with Cross-Validation</span></span>
<span id="cb106-88"><a href="#cb106-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-89"><a href="#cb106-89" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">594</span>)</span>
<span id="cb106-90"><a href="#cb106-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-91"><a href="#cb106-91" aria-hidden="true" tabindex="-1"></a>    f1_scores <span class="op">=</span> []</span>
<span id="cb106-92"><a href="#cb106-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-93"><a href="#cb106-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> train_idx, val_idx <span class="kw">in</span> cv.split(X_train, y_train):</span>
<span id="cb106-94"><a href="#cb106-94" aria-hidden="true" tabindex="-1"></a>        X_cv_train, X_cv_val <span class="op">=</span> X_train[train_idx], X_train[val_idx]</span>
<span id="cb106-95"><a href="#cb106-95" aria-hidden="true" tabindex="-1"></a>        y_cv_train, y_cv_val <span class="op">=</span> y_train[train_idx], y_train[val_idx]</span>
<span id="cb106-96"><a href="#cb106-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-97"><a href="#cb106-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'neural_network'</span>:  <span class="co"># Neural Networks have a different syntax for model.fit</span></span>
<span id="cb106-98"><a href="#cb106-98" aria-hidden="true" tabindex="-1"></a>            model.fit(X_cv_train,</span>
<span id="cb106-99"><a href="#cb106-99" aria-hidden="true" tabindex="-1"></a>                      y_cv_train,</span>
<span id="cb106-100"><a href="#cb106-100" aria-hidden="true" tabindex="-1"></a>                      epochs<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb106-101"><a href="#cb106-101" aria-hidden="true" tabindex="-1"></a>                      batch_size<span class="op">=</span>batch_size,</span>
<span id="cb106-102"><a href="#cb106-102" aria-hidden="true" tabindex="-1"></a>                      verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb106-103"><a href="#cb106-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:   </span>
<span id="cb106-104"><a href="#cb106-104" aria-hidden="true" tabindex="-1"></a>            model.fit(X_cv_train, y_cv_train)</span>
<span id="cb106-105"><a href="#cb106-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-106"><a href="#cb106-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-107"><a href="#cb106-107" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.<span class="bu">round</span>(model.predict(X_cv_val))</span>
<span id="cb106-108"><a href="#cb106-108" aria-hidden="true" tabindex="-1"></a>        f1_scores.append(f1_score(y_cv_val, y_pred))</span>
<span id="cb106-109"><a href="#cb106-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-110"><a href="#cb106-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Defining the score as the mean of the f1 scores for each fold</span></span>
<span id="cb106-111"><a href="#cb106-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-112"><a href="#cb106-112" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> np.mean(f1_scores)</span>
<span id="cb106-113"><a href="#cb106-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-114"><a href="#cb106-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-83" class="cell" data-tags="[]" data-execution_count="75">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">'maximize'</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>study.optimize(objective, n_trials<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2024-03-15 17:24:22,975] A new study created in memory with name: no-name-d5481abb-38fa-4d3a-bb28-255e6b63b26b
[I 2024-03-15 17:25:40,652] Trial 0 finished with value: 0.908807005337241 and parameters: {'model_type': 'decision_tree', 'max_depth': 24, 'min_samples_split': 6, 'min_samples_leaf': 2}. Best is trial 0 with value: 0.908807005337241.
[I 2024-03-15 17:44:36,879] Trial 1 finished with value: 0.9034837528346717 and parameters: {'model_type': 'neural_network', 'n_hidden_layers': 4, 'learning_rate': 0.0021701917265919356, 'batch_size': 256, 'n_units_1': 256, 'n_units_2': 32, 'n_units_3': 32, 'n_units_4': 32}. Best is trial 0 with value: 0.908807005337241.
[W 2024-03-15 18:13:43,092] Trial 2 failed with parameters: {'model_type': 'neural_network', 'n_hidden_layers': 1, 'learning_rate': 0.023057139351784068, 'batch_size': 64, 'n_units_1': 128} because of the following error: KeyboardInterrupt().
Traceback (most recent call last):
  File "C:\Users\Daniel\anaconda3\lib\site-packages\optuna\study\_optimize.py", line 200, in _run_trial
    value_or_values = func(trial)
  File "C:\Users\Daniel\AppData\Local\Temp\ipykernel_19984\173235607.py", line 98, in objective
    model.fit(X_cv_train,
  File "C:\Users\Daniel\anaconda3\lib\site-packages\keras\src\utils\traceback_utils.py", line 65, in error_handler
    return fn(*args, **kwargs)
  File "C:\Users\Daniel\anaconda3\lib\site-packages\keras\src\engine\training.py", line 1807, in fit
    tmp_logs = self.train_function(iterator)
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\util\traceback_utils.py", line 150, in error_handler
    return fn(*args, **kwargs)
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\polymorphic_function\polymorphic_function.py", line 832, in __call__
    result = self._call(*args, **kwds)
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\polymorphic_function\polymorphic_function.py", line 868, in _call
    return tracing_compilation.call_function(
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\polymorphic_function\tracing_compilation.py", line 139, in call_function
    return function._call_flat(  # pylint: disable=protected-access
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\polymorphic_function\concrete_function.py", line 1323, in _call_flat
    return self._inference_function.call_preflattened(args)
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\polymorphic_function\atomic_function.py", line 216, in call_preflattened
    flat_outputs = self.call_flat(*args)
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\polymorphic_function\atomic_function.py", line 251, in call_flat
    outputs = self._bound_context.call_function(
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\context.py", line 1486, in call_function
    outputs = execute.execute(
  File "C:\Users\Daniel\anaconda3\lib\site-packages\tensorflow\python\eager\execute.py", line 53, in quick_execute
    tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
KeyboardInterrupt
[W 2024-03-15 18:13:43,102] Trial 2 failed with value None.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From C:\Users\Daniel\anaconda3\lib\site-packages\keras\src\backend.py:873: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.

WARNING:tensorflow:From C:\Users\Daniel\anaconda3\lib\site-packages\keras\src\utils\tf_utils.py:492: The name tf.ragged.RaggedTensorValue is deprecated. Please use tf.compat.v1.ragged.RaggedTensorValue instead.

2347/2347 [==============================] - 5s 2ms/step
2347/2347 [==============================] - 5s 2ms/step
2347/2347 [==============================] - 5s 2ms/step
2347/2347 [==============================] - 5s 2ms/step
2347/2347 [==============================] - 5s 2ms/step
2347/2347 [==============================] - 19s 8ms/step
2347/2347 [==============================] - 4s 2ms/step
2347/2347 [==============================] - 5s 2ms/step
2347/2347 [==============================] - 5s 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>KeyboardInterrupt: </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>