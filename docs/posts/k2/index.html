<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel J Smith">
<meta name="dcterms.date" content="2024-03-19">
<meta name="description" content="After cleaning and preprocessing a modified LendingClub dataset of loan applicants I implement an Optuna study for both model selection and hyperparameter tuning with cross-validation to choose a model to predict if an unseen applicant will repay their loan.">

<title>djs - Model Selection and Hyperparameter Tuning using Optuna for Loan Charge-Off Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">djs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-imports" id="toc-data-imports" class="nav-link active" data-scroll-target="#data-imports">Data Imports</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">—</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#missing-values-and-feature-engineering" id="toc-missing-values-and-feature-engineering" class="nav-link" data-scroll-target="#missing-values-and-feature-engineering">Missing Values and Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#emp_title-and-emp_length" id="toc-emp_title-and-emp_length" class="nav-link" data-scroll-target="#emp_title-and-emp_length"><code>emp_title</code> and <code>emp_length</code></a></li>
  <li><a href="#filling-mort_acc-using-total_acc" id="toc-filling-mort_acc-using-total_acc" class="nav-link" data-scroll-target="#filling-mort_acc-using-total_acc">Filling <code>mort_acc</code> using <code>total_acc</code></a></li>
  <li><a href="#categorical-features" id="toc-categorical-features" class="nav-link" data-scroll-target="#categorical-features">Categorical Features</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#traintest-split" id="toc-traintest-split" class="nav-link" data-scroll-target="#traintest-split">TRAIN/TEST SPLIT</a></li>
  <li><a href="#normalising-the-data" id="toc-normalising-the-data" class="nav-link" data-scroll-target="#normalising-the-data">Normalising the Data</a></li>
  </ul></li>
  <li><a href="#model-selection-and-hyperparameter-tuning-with-optuna" id="toc-model-selection-and-hyperparameter-tuning-with-optuna" class="nav-link" data-scroll-target="#model-selection-and-hyperparameter-tuning-with-optuna">Model Selection and Hyperparameter Tuning with Optuna</a></li>
  <li><a href="#fitting-the-best-model-and-predicting-on-test-set" id="toc-fitting-the-best-model-and-predicting-on-test-set" class="nav-link" data-scroll-target="#fitting-the-best-model-and-predicting-on-test-set">Fitting the Best Model and Predicting on Test Set</a></li>
  <li><a href="#examining-misclassified-points" id="toc-examining-misclassified-points" class="nav-link" data-scroll-target="#examining-misclassified-points">Examining Misclassified Points</a>
  <ul class="collapse">
  <li><a href="#producing-some-visualisations-investigating-the-distribution-of-misclassified-points" id="toc-producing-some-visualisations-investigating-the-distribution-of-misclassified-points" class="nav-link" data-scroll-target="#producing-some-visualisations-investigating-the-distribution-of-misclassified-points">Producing some visualisations investigating the distribution of misclassified points</a></li>
  </ul></li>
  <li><a href="#remarks-further-directions" id="toc-remarks-further-directions" class="nav-link" data-scroll-target="#remarks-further-directions">Remarks &amp; Further Directions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Model Selection and Hyperparameter Tuning using Optuna for Loan Charge-Off Prediction</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">ML</div>
    <div class="quarto-category">Pandas</div>
    <div class="quarto-category">Seaborn</div>
    <div class="quarto-category">scikit-learn</div>
    <div class="quarto-category">TensorFlow</div>
    <div class="quarto-category">XGBoost</div>
    <div class="quarto-category">Optuna</div>
  </div>
  </div>

<div>
  <div class="description">
    After cleaning and preprocessing a modified LendingClub dataset of loan applicants I implement an Optuna study for both model selection and hyperparameter tuning with cross-validation to choose a model to predict if an unseen applicant will repay their loan.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel J Smith </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, StratifiedKFold</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, f1_score</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, Dropout</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optuna</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Python version:"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>python <span class="op">--</span>version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python version:
Python 3.11.4</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optuna version:"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(optuna.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optuna version:
3.5.0</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TensorFlow version:"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tf.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorFlow version:
2.14.0</code></pre>
</div>
</div>
<section id="data-imports" class="level1">
<h1>Data Imports</h1>
<p>We use a modified LendingClub dataset from Kaggle, sourced from <a href="https://www.udemy.com/course/python-for-data-science-and-machine-learning-bootcamp/?couponCode=LETSLEARNNOWPP">Udemy course by Jose Portilla</a>.</p>
<p>Before preprocessing, the dataset has the following features:</p>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
LoanStatNew
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
loan_amnt
</td>
<td>
The listed amount of the loan applied for by the borrower. If at some point in time, the credit department reduces the loan amount, then it will be reflected in this value.
</td>
</tr>
<tr>
<th>
1
</th>
<td>
term
</td>
<td>
The number of payments on the loan. Values are in months and can be either 36 or 60.
</td>
</tr>
<tr>
<th>
2
</th>
<td>
int_rate
</td>
<td>
Interest Rate on the loan
</td>
</tr>
<tr>
<th>
3
</th>
<td>
installment
</td>
<td>
The monthly payment owed by the borrower if the loan originates.
</td>
</tr>
<tr>
<th>
4
</th>
<td>
grade
</td>
<td>
LC assigned loan grade
</td>
</tr>
<tr>
<th>
5
</th>
<td>
sub_grade
</td>
<td>
LC assigned loan subgrade
</td>
</tr>
<tr>
<th>
6
</th>
<td>
emp_title
</td>
<td>
The job title supplied by the Borrower when applying for the loan.*
</td>
</tr>
<tr>
<th>
7
</th>
<td>
emp_length
</td>
<td>
Employment length in years. Possible values are between 0 and 10 where 0 means less than one year and 10 means ten or more years.
</td>
</tr>
<tr>
<th>
8
</th>
<td>
home_ownership
</td>
<td>
The home ownership status provided by the borrower during registration&nbsp;or obtained from the credit report.&nbsp;Our values are: RENT, OWN, MORTGAGE, OTHER
</td>
</tr>
<tr>
<th>
9
</th>
<td>
annual_inc
</td>
<td>
The self-reported annual income provided by the borrower during registration.
</td>
</tr>
<tr>
<th>
10
</th>
<td>
verification_status
</td>
<td>
Indicates if income was verified by LC, not verified, or if the income source was verified
</td>
</tr>
<tr>
<th>
11
</th>
<td>
issue_d
</td>
<td>
The month which the loan was funded
</td>
</tr>
<tr>
<th>
12
</th>
<td>
loan_status
</td>
<td>
Current status of the loan
</td>
</tr>
<tr>
<th>
13
</th>
<td>
purpose
</td>
<td>
A category provided by the borrower for the loan request.
</td>
</tr>
<tr>
<th>
14
</th>
<td>
title
</td>
<td>
The loan title provided by the borrower
</td>
</tr>
<tr>
<th>
15
</th>
<td>
zip_code
</td>
<td>
The first 3 numbers of the zip code provided by the borrower in the loan application.
</td>
</tr>
<tr>
<th>
16
</th>
<td>
addr_state
</td>
<td>
The state provided by the borrower in the loan application
</td>
</tr>
<tr>
<th>
17
</th>
<td>
dti
</td>
<td>
A ratio calculated using the borrower’s total monthly debt payments on the total debt obligations, excluding mortgage and the requested LC loan, divided by the borrower’s self-reported monthly income.
</td>
</tr>
<tr>
<th>
18
</th>
<td>
earliest_cr_line
</td>
<td>
The month the borrower’s earliest reported credit line was opened
</td>
</tr>
<tr>
<th>
19
</th>
<td>
open_acc
</td>
<td>
The number of open credit lines in the borrower’s credit file.
</td>
</tr>
<tr>
<th>
20
</th>
<td>
pub_rec
</td>
<td>
Number of derogatory public records
</td>
</tr>
<tr>
<th>
21
</th>
<td>
revol_bal
</td>
<td>
Total credit revolving balance
</td>
</tr>
<tr>
<th>
22
</th>
<td>
revol_util
</td>
<td>
Revolving line utilization rate, or the amount of credit the borrower is using relative to all available revolving credit.
</td>
</tr>
<tr>
<th>
23
</th>
<td>
total_acc
</td>
<td>
The total number of credit lines currently in the borrower’s credit file
</td>
</tr>
<tr>
<th>
24
</th>
<td>
initial_list_status
</td>
<td>
The initial listing status of the loan. Possible values are – W, F
</td>
</tr>
<tr>
<th>
25
</th>
<td>
application_type
</td>
<td>
Indicates whether the loan is an individual application or a joint application with two co-borrowers
</td>
</tr>
<tr>
<th>
26
</th>
<td>
mort_acc
</td>
<td>
Number of mortgage accounts.
</td>
</tr>
<tr>
<th>
27
</th>
<td>
pub_rec_bankruptcies
</td>
<td>
Number of public record bankruptcies
</td>
</tr>
</tbody>

</table>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">—</h2>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'lending_club_loan.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 396030 entries, 0 to 396029
Data columns (total 27 columns):
 #   Column                Non-Null Count   Dtype  
---  ------                --------------   -----  
 0   loan_amnt             396030 non-null  float64
 1   term                  396030 non-null  object 
 2   int_rate              396030 non-null  float64
 3   installment           396030 non-null  float64
 4   grade                 396030 non-null  object 
 5   sub_grade             396030 non-null  object 
 6   emp_title             373103 non-null  object 
 7   emp_length            377729 non-null  object 
 8   home_ownership        396030 non-null  object 
 9   annual_inc            396030 non-null  float64
 10  verification_status   396030 non-null  object 
 11  issue_d               396030 non-null  object 
 12  loan_status           396030 non-null  object 
 13  purpose               396030 non-null  object 
 14  title                 394274 non-null  object 
 15  dti                   396030 non-null  float64
 16  earliest_cr_line      396030 non-null  object 
 17  open_acc              396030 non-null  float64
 18  pub_rec               396030 non-null  float64
 19  revol_bal             396030 non-null  float64
 20  revol_util            395754 non-null  float64
 21  total_acc             396030 non-null  float64
 22  initial_list_status   396030 non-null  object 
 23  application_type      396030 non-null  object 
 24  mort_acc              358235 non-null  float64
 25  pub_rec_bankruptcies  395495 non-null  float64
 26  address               396030 non-null  object 
dtypes: float64(12), object(15)
memory usage: 81.6+ MB</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">int_rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">grade</th>
<th data-quarto-table-cell-role="th">sub_grade</th>
<th data-quarto-table-cell-role="th">emp_title</th>
<th data-quarto-table-cell-role="th">emp_length</th>
<th data-quarto-table-cell-role="th">home_ownership</th>
<th data-quarto-table-cell-role="th">annual_inc</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">open_acc</th>
<th data-quarto-table-cell-role="th">pub_rec</th>
<th data-quarto-table-cell-role="th">revol_bal</th>
<th data-quarto-table-cell-role="th">revol_util</th>
<th data-quarto-table-cell-role="th">total_acc</th>
<th data-quarto-table-cell-role="th">initial_list_status</th>
<th data-quarto-table-cell-role="th">application_type</th>
<th data-quarto-table-cell-role="th">mort_acc</th>
<th data-quarto-table-cell-role="th">pub_rec_bankruptcies</th>
<th data-quarto-table-cell-role="th">address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10000.0</td>
<td>36 months</td>
<td>11.44</td>
<td>329.48</td>
<td>B</td>
<td>B4</td>
<td>Marketing</td>
<td>10+ years</td>
<td>RENT</td>
<td>117000.0</td>
<td>...</td>
<td>16.0</td>
<td>0.0</td>
<td>36369.0</td>
<td>41.8</td>
<td>25.0</td>
<td>w</td>
<td>INDIVIDUAL</td>
<td>0.0</td>
<td>0.0</td>
<td>0174 Michelle Gateway\r\nMendozaberg, OK 22690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8000.0</td>
<td>36 months</td>
<td>11.99</td>
<td>265.68</td>
<td>B</td>
<td>B5</td>
<td>Credit analyst</td>
<td>4 years</td>
<td>MORTGAGE</td>
<td>65000.0</td>
<td>...</td>
<td>17.0</td>
<td>0.0</td>
<td>20131.0</td>
<td>53.3</td>
<td>27.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>3.0</td>
<td>0.0</td>
<td>1076 Carney Fort Apt. 347\r\nLoganmouth, SD 05113</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>15600.0</td>
<td>36 months</td>
<td>10.49</td>
<td>506.97</td>
<td>B</td>
<td>B3</td>
<td>Statistician</td>
<td>&lt; 1 year</td>
<td>RENT</td>
<td>43057.0</td>
<td>...</td>
<td>13.0</td>
<td>0.0</td>
<td>11987.0</td>
<td>92.2</td>
<td>26.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>0.0</td>
<td>0.0</td>
<td>87025 Mark Dale Apt. 269\r\nNew Sabrina, WV 05113</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7200.0</td>
<td>36 months</td>
<td>6.49</td>
<td>220.65</td>
<td>A</td>
<td>A2</td>
<td>Client Advocate</td>
<td>6 years</td>
<td>RENT</td>
<td>54000.0</td>
<td>...</td>
<td>6.0</td>
<td>0.0</td>
<td>5472.0</td>
<td>21.5</td>
<td>13.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>0.0</td>
<td>0.0</td>
<td>823 Reid Ford\r\nDelacruzside, MA 00813</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24375.0</td>
<td>60 months</td>
<td>17.27</td>
<td>609.33</td>
<td>C</td>
<td>C5</td>
<td>Destiny Management Inc.</td>
<td>9 years</td>
<td>MORTGAGE</td>
<td>55000.0</td>
<td>...</td>
<td>13.0</td>
<td>0.0</td>
<td>24584.0</td>
<td>69.8</td>
<td>43.0</td>
<td>f</td>
<td>INDIVIDUAL</td>
<td>1.0</td>
<td>0.0</td>
<td>679 Luna Roads\r\nGreggshire, VA 11650</td>
</tr>
</tbody>
</table>

<p>5 rows × 27 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<p>In this section I produce some figures while exploring the distribution of the dataset.</p>
<p>The uninterested should feel free to skip forward a section</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">'loan_status'</span>,data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;Axes: xlabel='loan_status', ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sns.displot(df[<span class="st">'loan_amnt'</span>],kde<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">int_rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">annual_inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">open_acc</th>
<th data-quarto-table-cell-role="th">pub_rec</th>
<th data-quarto-table-cell-role="th">revol_bal</th>
<th data-quarto-table-cell-role="th">revol_util</th>
<th data-quarto-table-cell-role="th">total_acc</th>
<th data-quarto-table-cell-role="th">mort_acc</th>
<th data-quarto-table-cell-role="th">pub_rec_bankruptcies</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">loan_amnt</td>
<td>1.000000</td>
<td>0.168921</td>
<td>0.953929</td>
<td>0.336887</td>
<td>0.016636</td>
<td>0.198556</td>
<td>-0.077779</td>
<td>0.328320</td>
<td>0.099911</td>
<td>0.223886</td>
<td>0.222315</td>
<td>-0.106539</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">int_rate</td>
<td>0.168921</td>
<td>1.000000</td>
<td>0.162758</td>
<td>-0.056771</td>
<td>0.079038</td>
<td>0.011649</td>
<td>0.060986</td>
<td>-0.011280</td>
<td>0.293659</td>
<td>-0.036404</td>
<td>-0.082583</td>
<td>0.057450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">installment</td>
<td>0.953929</td>
<td>0.162758</td>
<td>1.000000</td>
<td>0.330381</td>
<td>0.015786</td>
<td>0.188973</td>
<td>-0.067892</td>
<td>0.316455</td>
<td>0.123915</td>
<td>0.202430</td>
<td>0.193694</td>
<td>-0.098628</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">annual_inc</td>
<td>0.336887</td>
<td>-0.056771</td>
<td>0.330381</td>
<td>1.000000</td>
<td>-0.081685</td>
<td>0.136150</td>
<td>-0.013720</td>
<td>0.299773</td>
<td>0.027871</td>
<td>0.193023</td>
<td>0.236320</td>
<td>-0.050162</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">dti</td>
<td>0.016636</td>
<td>0.079038</td>
<td>0.015786</td>
<td>-0.081685</td>
<td>1.000000</td>
<td>0.136181</td>
<td>-0.017639</td>
<td>0.063571</td>
<td>0.088375</td>
<td>0.102128</td>
<td>-0.025439</td>
<td>-0.014558</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">open_acc</td>
<td>0.198556</td>
<td>0.011649</td>
<td>0.188973</td>
<td>0.136150</td>
<td>0.136181</td>
<td>1.000000</td>
<td>-0.018392</td>
<td>0.221192</td>
<td>-0.131420</td>
<td>0.680728</td>
<td>0.109205</td>
<td>-0.027732</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pub_rec</td>
<td>-0.077779</td>
<td>0.060986</td>
<td>-0.067892</td>
<td>-0.013720</td>
<td>-0.017639</td>
<td>-0.018392</td>
<td>1.000000</td>
<td>-0.101664</td>
<td>-0.075910</td>
<td>0.019723</td>
<td>0.011552</td>
<td>0.699408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">revol_bal</td>
<td>0.328320</td>
<td>-0.011280</td>
<td>0.316455</td>
<td>0.299773</td>
<td>0.063571</td>
<td>0.221192</td>
<td>-0.101664</td>
<td>1.000000</td>
<td>0.226346</td>
<td>0.191616</td>
<td>0.194925</td>
<td>-0.124532</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">revol_util</td>
<td>0.099911</td>
<td>0.293659</td>
<td>0.123915</td>
<td>0.027871</td>
<td>0.088375</td>
<td>-0.131420</td>
<td>-0.075910</td>
<td>0.226346</td>
<td>1.000000</td>
<td>-0.104273</td>
<td>0.007514</td>
<td>-0.086751</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">total_acc</td>
<td>0.223886</td>
<td>-0.036404</td>
<td>0.202430</td>
<td>0.193023</td>
<td>0.102128</td>
<td>0.680728</td>
<td>0.019723</td>
<td>0.191616</td>
<td>-0.104273</td>
<td>1.000000</td>
<td>0.381072</td>
<td>0.042035</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">mort_acc</td>
<td>0.222315</td>
<td>-0.082583</td>
<td>0.193694</td>
<td>0.236320</td>
<td>-0.025439</td>
<td>0.109205</td>
<td>0.011552</td>
<td>0.194925</td>
<td>0.007514</td>
<td>0.381072</td>
<td>1.000000</td>
<td>0.027239</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pub_rec_bankruptcies</td>
<td>-0.106539</td>
<td>0.057450</td>
<td>-0.098628</td>
<td>-0.050162</td>
<td>-0.014558</td>
<td>-0.027732</td>
<td>0.699408</td>
<td>-0.124532</td>
<td>-0.086751</td>
<td>0.042035</td>
<td>0.027239</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df.corr(numeric_only<span class="op">=</span><span class="va">True</span>),annot<span class="op">=</span><span class="va">True</span>,cmap<span class="op">=</span><span class="st">'viridis'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df,x<span class="op">=</span><span class="st">'installment'</span>,y<span class="op">=</span><span class="st">'loan_amnt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;Axes: xlabel='installment', ylabel='loan_amnt'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df,x<span class="op">=</span><span class="st">'loan_status'</span>,y<span class="op">=</span><span class="st">'loan_amnt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>&lt;Axes: xlabel='loan_status', ylabel='loan_amnt'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'loan_status'</span>)[<span class="st">'loan_amnt'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">loan_status</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Charged Off</td>
<td>77673.0</td>
<td>15126.300967</td>
<td>8505.090557</td>
<td>1000.0</td>
<td>8525.0</td>
<td>14000.0</td>
<td>20000.0</td>
<td>40000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Fully Paid</td>
<td>318357.0</td>
<td>13866.878771</td>
<td>8302.319699</td>
<td>500.0</td>
<td>7500.0</td>
<td>12000.0</td>
<td>19225.0</td>
<td>40000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'grade'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array(['B', 'A', 'C', 'E', 'D', 'F', 'G'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sub_grade'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array(['B4', 'B5', 'B3', 'A2', 'C5', 'C3', 'A1', 'B2', 'C1', 'A5', 'E4',
       'A4', 'A3', 'D1', 'C2', 'B1', 'D3', 'D5', 'D2', 'E1', 'E2', 'E5',
       'F4', 'E3', 'D4', 'G1', 'F5', 'G2', 'C4', 'F1', 'F3', 'G5', 'G4',
       'F2', 'G3'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,x<span class="op">=</span><span class="st">'grade'</span>,hue<span class="op">=</span><span class="st">'loan_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>&lt;Axes: xlabel='grade', ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>subgrade_order <span class="op">=</span> <span class="bu">sorted</span>(df[<span class="st">'sub_grade'</span>].unique())</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'sub_grade'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>subgrade_order,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>              hue<span class="op">=</span><span class="st">'loan_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>&lt;Axes: xlabel='sub_grade', ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-19-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>f_g <span class="op">=</span> df[(df[<span class="st">'grade'</span>] <span class="op">==</span> <span class="st">'G'</span>) <span class="op">|</span> (df[<span class="st">'grade'</span>] <span class="op">==</span> <span class="st">'F'</span>)]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>subgrade_order <span class="op">=</span> <span class="bu">sorted</span>(f_g[<span class="st">'sub_grade'</span>].unique())</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>f_g,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'sub_grade'</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>subgrade_order,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>              hue<span class="op">=</span><span class="st">'loan_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>&lt;Axes: xlabel='sub_grade', ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="missing-values-and-feature-engineering" class="level1">
<h1>Missing Values and Feature Engineering</h1>
<p>Some of the columns in the dataframe have missing values which we need to fill before we can hope to train any machine learning models.</p>
<p>In this section we also conduct “feature engineering”, creating new columns from the existing columns in order to try and enhance the expressibility of the data.</p>
<p>The categorical features also need to be encoded. The machine learning algorithms I want to search over cannot all handle textual data such as ‘False’, so we need to conduct <a href="https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/">One Hot Encoding</a> to ensure the dataframe only consists of numeric columns.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'loan_repaid'</span>] <span class="op">=</span> (df[<span class="st">'loan_status'</span>] <span class="op">==</span> <span class="st">'Fully Paid'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'loan_repaid'</span>,<span class="st">'loan_status'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_repaid</th>
<th data-quarto-table-cell-role="th">loan_status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>Charged Off</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396025</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396026</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396027</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396028</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396029</td>
<td>1</td>
<td>Fully Paid</td>
</tr>
</tbody>
</table>

<p>396030 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)[<span class="st">'loan_repaid'</span>].sort_values().drop(<span class="st">'loan_repaid'</span>).plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-22-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Looking at how many missing values are present in each column of the dataframe:</p>
<div class="cell" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>loan_amnt                   0
term                        0
int_rate                    0
installment                 0
grade                       0
sub_grade                   0
emp_title               22927
emp_length              18301
home_ownership              0
annual_inc                  0
verification_status         0
issue_d                     0
loan_status                 0
purpose                     0
title                    1756
dti                         0
earliest_cr_line            0
open_acc                    0
pub_rec                     0
revol_bal                   0
revol_util                276
total_acc                   0
initial_list_status         0
application_type            0
mort_acc                37795
pub_rec_bankruptcies      535
address                     0
loan_repaid                 0
dtype: int64</code></pre>
</div>
</div>
<p>Defining a function to print what percentages of columns these missing values correspond too.</p>
<div class="cell" data-tags="[]" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percentage_null(df):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    percentage_missing <span class="op">=</span> (df.isnull().<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(df))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Percentages of values missing:</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(percentage_missing.<span class="bu">round</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.00
term                    0.00
int_rate                0.00
installment             0.00
grade                   0.00
sub_grade               0.00
emp_title               5.79
emp_length              4.62
home_ownership          0.00
annual_inc              0.00
verification_status     0.00
issue_d                 0.00
loan_status             0.00
purpose                 0.00
title                   0.44
dti                     0.00
earliest_cr_line        0.00
open_acc                0.00
pub_rec                 0.00
revol_bal               0.00
revol_util              0.07
total_acc               0.00
initial_list_status     0.00
application_type        0.00
mort_acc                9.54
pub_rec_bankruptcies    0.14
address                 0.00
loan_repaid             0.00
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'title'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0                        Vacation
1              Debt consolidation
2         Credit card refinancing
3         Credit card refinancing
4           Credit Card Refinance
                   ...           
396025         Debt consolidation
396026         Debt consolidation
396027       pay off credit cards
396028              Loanforpayoff
396029          Toxic Debt Payoff
Name: title, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'purpose'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0                   vacation
1         debt_consolidation
2                credit_card
3                credit_card
4                credit_card
                 ...        
396025    debt_consolidation
396026    debt_consolidation
396027    debt_consolidation
396028    debt_consolidation
396029    debt_consolidation
Name: purpose, Length: 396030, dtype: object</code></pre>
</div>
</div>
<p>The columns <code>title</code> and <code>purpose</code> are duplicates, so we can drop one without losing any information.</p>
<div class="cell" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'title'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="emp_title-and-emp_length" class="level2">
<h2 class="anchored" data-anchor-id="emp_title-and-emp_length"><code>emp_title</code> and <code>emp_length</code></h2>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'emp_title'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0                        Marketing
1                  Credit analyst 
2                     Statistician
3                  Client Advocate
4          Destiny Management Inc.
                    ...           
396025            licensed bankere
396026                       Agent
396027                City Carrier
396028        Gracon Services, Inc
396029    Internal Revenue Service
Name: emp_title, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="29">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'emp_title'</span>].nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>173105</code></pre>
</div>
</div>
<p><code>emp_title</code> has too many unique values to encode</p>
<div class="cell" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'emp_title'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'emp_length'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0         10+ years
1           4 years
2          &lt; 1 year
3           6 years
4           9 years
            ...    
396025      2 years
396026      5 years
396027    10+ years
396028    10+ years
396029    10+ years
Name: emp_length, Length: 396030, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="32">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(df[<span class="st">'emp_length'</span>].dropna().unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>['1 year',
 '10+ years',
 '2 years',
 '3 years',
 '4 years',
 '5 years',
 '6 years',
 '7 years',
 '8 years',
 '9 years',
 '&lt; 1 year']</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="33">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ordered_emp_lengths <span class="op">=</span> [<span class="st">'&lt; 1 year'</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'1 year'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'2 years'</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'3 years'</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'4 years'</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'5 years'</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'6 years'</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'7 years'</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'8 years'</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'9 years'</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'10+ years'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="34">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'emp_length'</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>ordered_emp_lengths,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span><span class="st">'viridis'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>&lt;Axes: xlabel='emp_length', ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-35-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="35">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'emp_length'</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>ordered_emp_lengths,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>              hue<span class="op">=</span><span class="st">'loan_repaid'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>&lt;Axes: xlabel='emp_length', ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="36">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>emp_co <span class="op">=</span> df[df[<span class="st">'loan_repaid'</span>] <span class="op">==</span> <span class="dv">0</span>].groupby(<span class="st">'emp_length'</span>).count()[<span class="st">'loan_repaid'</span>]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>emp_fp <span class="op">=</span> df[df[<span class="st">'loan_repaid'</span>] <span class="op">==</span> <span class="dv">1</span>].groupby(<span class="st">'emp_length'</span>).count()[<span class="st">'loan_repaid'</span>]</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">2</span>))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>((emp_co<span class="op">/</span>(emp_fp<span class="op">+</span>emp_co))<span class="op">*</span><span class="dv">100</span>).plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>&lt;Axes: xlabel='emp_length'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-37-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><code>emp_length</code> doesn’t look to tell us anything about <code>loan_repaid</code>. Very similar fractions of all employment lengths did not manage to repay their loans, so we drop this column too.</p>
<div class="cell" data-tags="[]" data-execution_count="37">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'emp_length'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filling-mort_acc-using-total_acc" class="level2">
<h2 class="anchored" data-anchor-id="filling-mort_acc-using-total_acc">Filling <code>mort_acc</code> using <code>total_acc</code></h2>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.00
term                    0.00
int_rate                0.00
installment             0.00
grade                   0.00
sub_grade               0.00
home_ownership          0.00
annual_inc              0.00
verification_status     0.00
issue_d                 0.00
loan_status             0.00
purpose                 0.00
dti                     0.00
earliest_cr_line        0.00
open_acc                0.00
pub_rec                 0.00
revol_bal               0.00
revol_util              0.07
total_acc               0.00
initial_list_status     0.00
application_type        0.00
mort_acc                9.54
pub_rec_bankruptcies    0.14
address                 0.00
loan_repaid             0.00
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'mort_acc'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>mort_acc
0.0     139777
1.0      60416
2.0      49948
3.0      38049
4.0      27887
5.0      18194
6.0      11069
7.0       6052
8.0       3121
9.0       1656
10.0       865
11.0       479
12.0       264
13.0       146
14.0       107
15.0        61
16.0        37
17.0        22
18.0        18
19.0        15
20.0        13
24.0        10
22.0         7
21.0         4
25.0         4
27.0         3
32.0         2
31.0         2
23.0         2
26.0         2
28.0         1
30.0         1
34.0         1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="40">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)[<span class="st">'mort_acc'</span>].sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>int_rate               -0.082583
dti                    -0.025439
revol_util              0.007514
pub_rec                 0.011552
pub_rec_bankruptcies    0.027239
loan_repaid             0.073111
open_acc                0.109205
installment             0.193694
revol_bal               0.194925
loan_amnt               0.222315
annual_inc              0.236320
total_acc               0.381072
mort_acc                1.000000
Name: mort_acc, dtype: float64</code></pre>
</div>
</div>
<p><code>mort_acc</code> correlates most strongly with <code>total_acc</code>, so we can leverage the fact that <code>total_acc</code> has no missing values to fill the missing values in <code>mort_acc</code></p>
<div class="cell" data-tags="[]" data-execution_count="41">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>total_acc_avgs <span class="op">=</span> df.groupby(<span class="st">'total_acc'</span>).mean(numeric_only<span class="op">=</span><span class="va">True</span>)[<span class="st">'mort_acc'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="42">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill_mort_acc(total_acc,mort_acc):</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(mort_acc):</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total_acc_avgs[total_acc]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mort_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="43">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'mort_acc'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: fill_mort_acc(x[<span class="st">'total_acc'</span>],x[<span class="st">'mort_acc'</span>]),axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>loan_amnt                 0
term                      0
int_rate                  0
installment               0
grade                     0
sub_grade                 0
home_ownership            0
annual_inc                0
verification_status       0
issue_d                   0
loan_status               0
purpose                   0
dti                       0
earliest_cr_line          0
open_acc                  0
pub_rec                   0
revol_bal                 0
revol_util              276
total_acc                 0
initial_list_status       0
application_type          0
mort_acc                  0
pub_rec_bankruptcies    535
address                   0
loan_repaid               0
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="45">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.00
term                    0.00
int_rate                0.00
installment             0.00
grade                   0.00
sub_grade               0.00
home_ownership          0.00
annual_inc              0.00
verification_status     0.00
issue_d                 0.00
loan_status             0.00
purpose                 0.00
dti                     0.00
earliest_cr_line        0.00
open_acc                0.00
pub_rec                 0.00
revol_bal               0.00
revol_util              0.07
total_acc               0.00
initial_list_status     0.00
application_type        0.00
mort_acc                0.00
pub_rec_bankruptcies    0.14
address                 0.00
loan_repaid             0.00
dtype: float64</code></pre>
</div>
</div>
<p>Only a neglible amount of rows still have missing data points, so we now feel comfortable dropping these rows</p>
<div class="cell" data-tags="[]" data-execution_count="46">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-tags="[]" data-execution_count="47">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>percentage_null(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Percentages of values missing:

loan_amnt               0.0
term                    0.0
int_rate                0.0
installment             0.0
grade                   0.0
sub_grade               0.0
home_ownership          0.0
annual_inc              0.0
verification_status     0.0
issue_d                 0.0
loan_status             0.0
purpose                 0.0
dti                     0.0
earliest_cr_line        0.0
open_acc                0.0
pub_rec                 0.0
revol_bal               0.0
revol_util              0.0
total_acc               0.0
initial_list_status     0.0
application_type        0.0
mort_acc                0.0
pub_rec_bankruptcies    0.0
address                 0.0
loan_repaid             0.0
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="categorical-features" class="level2">
<h2 class="anchored" data-anchor-id="categorical-features">Categorical Features</h2>
<p>Here we treat the categorical features such as <code>home_ownership</code> and <code>purpose</code> by either dropping them or one-hot encoding them as to end with a dataframe consisting only of numeric features.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df.select_dtypes([<span class="st">'object'</span>]).columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>Index(['term', 'grade', 'sub_grade', 'home_ownership', 'verification_status',
       'issue_d', 'loan_status', 'purpose', 'earliest_cr_line',
       'initial_list_status', 'application_type', 'address'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="49">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'term'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>term
 36 months    301247
 60 months     93972
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'term'</span>] <span class="op">=</span> df[<span class="st">'term'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x.split()[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="51">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'term'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0         36
1         36
2         36
3         36
4         60
          ..
396025    60
396026    36
396027    36
396028    60
396029    36
Name: term, Length: 395219, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="52">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'zip_code'</span>] <span class="op">=</span> df[<span class="st">'address'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> address: address[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="53">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'zip_code'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>zip_code
70466    56880
22690    56413
30723    56402
48052    55811
00813    45725
29597    45393
05113    45300
11650    11210
93700    11126
86630    10959
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="54">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'home_ownership'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>home_ownership
MORTGAGE    198022
RENT        159395
OWN          37660
OTHER          110
NONE            29
ANY              3
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'home_ownership'</span>] <span class="op">=</span> df[<span class="st">'home_ownership'</span>].replace([<span class="st">'NONE'</span>,<span class="st">'ANY'</span>],<span class="st">'OTHER'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="56">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'home_ownership'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>home_ownership
MORTGAGE    198022
RENT        159395
OWN          37660
OTHER          142
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>one-hot encoding with <code>pandas.get_dummies</code>:</p>
<div class="cell" data-tags="[]" data-execution_count="57">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>columns_to_1hot <span class="op">=</span> [<span class="st">'home_ownership'</span>,</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'verification_status'</span>,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'application_type'</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'initial_list_status'</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'purpose'</span>,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'zip_code'</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'sub_grade'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="58">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(data<span class="op">=</span>df,</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>                    columns<span class="op">=</span>columns_to_1hot,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                    drop_first<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                    dtype<span class="op">=</span><span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="59">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>Index(['loan_amnt', 'term', 'int_rate', 'installment', 'grade', 'annual_inc',
       'issue_d', 'loan_status', 'dti', 'earliest_cr_line', 'open_acc',
       'pub_rec', 'revol_bal', 'revol_util', 'total_acc', 'mort_acc',
       'pub_rec_bankruptcies', 'address', 'loan_repaid',
       'home_ownership_OTHER', 'home_ownership_OWN', 'home_ownership_RENT',
       'verification_status_Source Verified', 'verification_status_Verified',
       'application_type_INDIVIDUAL', 'application_type_JOINT',
       'initial_list_status_w', 'purpose_credit_card',
       'purpose_debt_consolidation', 'purpose_educational',
       'purpose_home_improvement', 'purpose_house', 'purpose_major_purchase',
       'purpose_medical', 'purpose_moving', 'purpose_other',
       'purpose_renewable_energy', 'purpose_small_business',
       'purpose_vacation', 'purpose_wedding', 'zip_code_05113',
       'zip_code_11650', 'zip_code_22690', 'zip_code_29597', 'zip_code_30723',
       'zip_code_48052', 'zip_code_70466', 'zip_code_86630', 'zip_code_93700',
       'sub_grade_A2', 'sub_grade_A3', 'sub_grade_A4', 'sub_grade_A5',
       'sub_grade_B1', 'sub_grade_B2', 'sub_grade_B3', 'sub_grade_B4',
       'sub_grade_B5', 'sub_grade_C1', 'sub_grade_C2', 'sub_grade_C3',
       'sub_grade_C4', 'sub_grade_C5', 'sub_grade_D1', 'sub_grade_D2',
       'sub_grade_D3', 'sub_grade_D4', 'sub_grade_D5', 'sub_grade_E1',
       'sub_grade_E2', 'sub_grade_E3', 'sub_grade_E4', 'sub_grade_E5',
       'sub_grade_F1', 'sub_grade_F2', 'sub_grade_F3', 'sub_grade_F4',
       'sub_grade_F5', 'sub_grade_G1', 'sub_grade_G2', 'sub_grade_G3',
       'sub_grade_G4', 'sub_grade_G5'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="60">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'earliest_cr_line'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>0         Jun-1990
1         Jul-2004
2         Aug-2007
3         Sep-2006
4         Mar-1999
            ...   
396025    Nov-2004
396026    Feb-2006
396027    Mar-1997
396028    Nov-1990
396029    Sep-1998
Name: earliest_cr_line, Length: 395219, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="61">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'earliest_cr_year'</span>] <span class="op">=</span> df[<span class="st">'earliest_cr_line'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x.split(<span class="st">'-'</span>)[<span class="op">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="62">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'earliest_cr_year'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>0         1990
1         2004
2         2007
3         2006
4         1999
          ... 
396025    2004
396026    2006
396027    1997
396028    1990
396029    1998
Name: earliest_cr_year, Length: 395219, dtype: int64</code></pre>
</div>
</div>
<p>Dropping categorical features not worth encoding:</p>
<div class="cell" data-tags="[]" data-execution_count="63">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>columns_to_drop <span class="op">=</span> [<span class="st">'earliest_cr_line'</span>,</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'grade'</span>,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'issue_d'</span>,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'loan_status'</span>,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'address'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="64">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns_to_drop,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<p>After our feature engineering we have the following dataset:</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">term</th>
<th data-quarto-table-cell-role="th">int_rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">annual_inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">open_acc</th>
<th data-quarto-table-cell-role="th">pub_rec</th>
<th data-quarto-table-cell-role="th">revol_bal</th>
<th data-quarto-table-cell-role="th">revol_util</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">sub_grade_F2</th>
<th data-quarto-table-cell-role="th">sub_grade_F3</th>
<th data-quarto-table-cell-role="th">sub_grade_F4</th>
<th data-quarto-table-cell-role="th">sub_grade_F5</th>
<th data-quarto-table-cell-role="th">sub_grade_G1</th>
<th data-quarto-table-cell-role="th">sub_grade_G2</th>
<th data-quarto-table-cell-role="th">sub_grade_G3</th>
<th data-quarto-table-cell-role="th">sub_grade_G4</th>
<th data-quarto-table-cell-role="th">sub_grade_G5</th>
<th data-quarto-table-cell-role="th">earliest_cr_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10000.0</td>
<td>36</td>
<td>11.44</td>
<td>329.48</td>
<td>117000.0</td>
<td>26.24</td>
<td>16.0</td>
<td>0.0</td>
<td>36369.0</td>
<td>41.8</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1990</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8000.0</td>
<td>36</td>
<td>11.99</td>
<td>265.68</td>
<td>65000.0</td>
<td>22.05</td>
<td>17.0</td>
<td>0.0</td>
<td>20131.0</td>
<td>53.3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2004</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>15600.0</td>
<td>36</td>
<td>10.49</td>
<td>506.97</td>
<td>43057.0</td>
<td>12.79</td>
<td>13.0</td>
<td>0.0</td>
<td>11987.0</td>
<td>92.2</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7200.0</td>
<td>36</td>
<td>6.49</td>
<td>220.65</td>
<td>54000.0</td>
<td>2.60</td>
<td>6.0</td>
<td>0.0</td>
<td>5472.0</td>
<td>21.5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24375.0</td>
<td>60</td>
<td>17.27</td>
<td>609.33</td>
<td>55000.0</td>
<td>33.95</td>
<td>13.0</td>
<td>0.0</td>
<td>24584.0</td>
<td>69.8</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396025</td>
<td>10000.0</td>
<td>60</td>
<td>10.99</td>
<td>217.38</td>
<td>40000.0</td>
<td>15.63</td>
<td>6.0</td>
<td>0.0</td>
<td>1990.0</td>
<td>34.3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396026</td>
<td>21000.0</td>
<td>36</td>
<td>12.29</td>
<td>700.42</td>
<td>110000.0</td>
<td>21.45</td>
<td>6.0</td>
<td>0.0</td>
<td>43263.0</td>
<td>95.7</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396027</td>
<td>5000.0</td>
<td>36</td>
<td>9.99</td>
<td>161.32</td>
<td>56500.0</td>
<td>17.56</td>
<td>15.0</td>
<td>0.0</td>
<td>32704.0</td>
<td>66.9</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1997</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">396028</td>
<td>21000.0</td>
<td>60</td>
<td>15.31</td>
<td>503.02</td>
<td>64000.0</td>
<td>15.88</td>
<td>9.0</td>
<td>0.0</td>
<td>15704.0</td>
<td>53.8</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1990</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">396029</td>
<td>2000.0</td>
<td>36</td>
<td>13.61</td>
<td>67.98</td>
<td>42996.0</td>
<td>8.32</td>
<td>3.0</td>
<td>0.0</td>
<td>4292.0</td>
<td>91.3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1998</td>
</tr>
</tbody>
</table>

<p>395219 rows × 79 columns</p>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="66">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 395219 entries, 0 to 396029
Data columns (total 79 columns):
 #   Column                               Non-Null Count   Dtype  
---  ------                               --------------   -----  
 0   loan_amnt                            395219 non-null  float64
 1   term                                 395219 non-null  int64  
 2   int_rate                             395219 non-null  float64
 3   installment                          395219 non-null  float64
 4   annual_inc                           395219 non-null  float64
 5   dti                                  395219 non-null  float64
 6   open_acc                             395219 non-null  float64
 7   pub_rec                              395219 non-null  float64
 8   revol_bal                            395219 non-null  float64
 9   revol_util                           395219 non-null  float64
 10  total_acc                            395219 non-null  float64
 11  mort_acc                             395219 non-null  float64
 12  pub_rec_bankruptcies                 395219 non-null  float64
 13  loan_repaid                          395219 non-null  int32  
 14  home_ownership_OTHER                 395219 non-null  int32  
 15  home_ownership_OWN                   395219 non-null  int32  
 16  home_ownership_RENT                  395219 non-null  int32  
 17  verification_status_Source Verified  395219 non-null  int32  
 18  verification_status_Verified         395219 non-null  int32  
 19  application_type_INDIVIDUAL          395219 non-null  int32  
 20  application_type_JOINT               395219 non-null  int32  
 21  initial_list_status_w                395219 non-null  int32  
 22  purpose_credit_card                  395219 non-null  int32  
 23  purpose_debt_consolidation           395219 non-null  int32  
 24  purpose_educational                  395219 non-null  int32  
 25  purpose_home_improvement             395219 non-null  int32  
 26  purpose_house                        395219 non-null  int32  
 27  purpose_major_purchase               395219 non-null  int32  
 28  purpose_medical                      395219 non-null  int32  
 29  purpose_moving                       395219 non-null  int32  
 30  purpose_other                        395219 non-null  int32  
 31  purpose_renewable_energy             395219 non-null  int32  
 32  purpose_small_business               395219 non-null  int32  
 33  purpose_vacation                     395219 non-null  int32  
 34  purpose_wedding                      395219 non-null  int32  
 35  zip_code_05113                       395219 non-null  int32  
 36  zip_code_11650                       395219 non-null  int32  
 37  zip_code_22690                       395219 non-null  int32  
 38  zip_code_29597                       395219 non-null  int32  
 39  zip_code_30723                       395219 non-null  int32  
 40  zip_code_48052                       395219 non-null  int32  
 41  zip_code_70466                       395219 non-null  int32  
 42  zip_code_86630                       395219 non-null  int32  
 43  zip_code_93700                       395219 non-null  int32  
 44  sub_grade_A2                         395219 non-null  int32  
 45  sub_grade_A3                         395219 non-null  int32  
 46  sub_grade_A4                         395219 non-null  int32  
 47  sub_grade_A5                         395219 non-null  int32  
 48  sub_grade_B1                         395219 non-null  int32  
 49  sub_grade_B2                         395219 non-null  int32  
 50  sub_grade_B3                         395219 non-null  int32  
 51  sub_grade_B4                         395219 non-null  int32  
 52  sub_grade_B5                         395219 non-null  int32  
 53  sub_grade_C1                         395219 non-null  int32  
 54  sub_grade_C2                         395219 non-null  int32  
 55  sub_grade_C3                         395219 non-null  int32  
 56  sub_grade_C4                         395219 non-null  int32  
 57  sub_grade_C5                         395219 non-null  int32  
 58  sub_grade_D1                         395219 non-null  int32  
 59  sub_grade_D2                         395219 non-null  int32  
 60  sub_grade_D3                         395219 non-null  int32  
 61  sub_grade_D4                         395219 non-null  int32  
 62  sub_grade_D5                         395219 non-null  int32  
 63  sub_grade_E1                         395219 non-null  int32  
 64  sub_grade_E2                         395219 non-null  int32  
 65  sub_grade_E3                         395219 non-null  int32  
 66  sub_grade_E4                         395219 non-null  int32  
 67  sub_grade_E5                         395219 non-null  int32  
 68  sub_grade_F1                         395219 non-null  int32  
 69  sub_grade_F2                         395219 non-null  int32  
 70  sub_grade_F3                         395219 non-null  int32  
 71  sub_grade_F4                         395219 non-null  int32  
 72  sub_grade_F5                         395219 non-null  int32  
 73  sub_grade_G1                         395219 non-null  int32  
 74  sub_grade_G2                         395219 non-null  int32  
 75  sub_grade_G3                         395219 non-null  int32  
 76  sub_grade_G4                         395219 non-null  int32  
 77  sub_grade_G5                         395219 non-null  int32  
 78  earliest_cr_year                     395219 non-null  int64  
dtypes: float64(12), int32(65), int64(2)
memory usage: 143.2 MB</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="67">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>Index(['loan_amnt', 'term', 'int_rate', 'installment', 'annual_inc', 'dti',
       'open_acc', 'pub_rec', 'revol_bal', 'revol_util', 'total_acc',
       'mort_acc', 'pub_rec_bankruptcies', 'loan_repaid',
       'home_ownership_OTHER', 'home_ownership_OWN', 'home_ownership_RENT',
       'verification_status_Source Verified', 'verification_status_Verified',
       'application_type_INDIVIDUAL', 'application_type_JOINT',
       'initial_list_status_w', 'purpose_credit_card',
       'purpose_debt_consolidation', 'purpose_educational',
       'purpose_home_improvement', 'purpose_house', 'purpose_major_purchase',
       'purpose_medical', 'purpose_moving', 'purpose_other',
       'purpose_renewable_energy', 'purpose_small_business',
       'purpose_vacation', 'purpose_wedding', 'zip_code_05113',
       'zip_code_11650', 'zip_code_22690', 'zip_code_29597', 'zip_code_30723',
       'zip_code_48052', 'zip_code_70466', 'zip_code_86630', 'zip_code_93700',
       'sub_grade_A2', 'sub_grade_A3', 'sub_grade_A4', 'sub_grade_A5',
       'sub_grade_B1', 'sub_grade_B2', 'sub_grade_B3', 'sub_grade_B4',
       'sub_grade_B5', 'sub_grade_C1', 'sub_grade_C2', 'sub_grade_C3',
       'sub_grade_C4', 'sub_grade_C5', 'sub_grade_D1', 'sub_grade_D2',
       'sub_grade_D3', 'sub_grade_D4', 'sub_grade_D5', 'sub_grade_E1',
       'sub_grade_E2', 'sub_grade_E3', 'sub_grade_E4', 'sub_grade_E5',
       'sub_grade_F1', 'sub_grade_F2', 'sub_grade_F3', 'sub_grade_F4',
       'sub_grade_F5', 'sub_grade_G1', 'sub_grade_G2', 'sub_grade_G3',
       'sub_grade_G4', 'sub_grade_G5', 'earliest_cr_year'],
      dtype='object')</code></pre>
</div>
</div>
<section id="traintest-split" class="level2">
<h2 class="anchored" data-anchor-id="traintest-split">TRAIN/TEST SPLIT</h2>
<p>Splitting the dataset into a training set and a test set:</p>
<p>(Note that cross-validation is performed inside the Optuna study, so we don’t need to separate out a validation set here)</p>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(<span class="st">'loan_repaid'</span>, axis<span class="op">=</span><span class="dv">1</span>).values</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'loan_repaid'</span>].values</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> df.columns.drop(<span class="st">'loan_repaid'</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="st">'loan_repaid'</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.05</span>, random_state<span class="op">=</span><span class="dv">594</span>)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame and add column names</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>X_test_df <span class="op">=</span> pd.DataFrame(X_test, columns<span class="op">=</span>features)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>y_test_df <span class="op">=</span> pd.DataFrame(y_test, columns<span class="op">=</span>[target])</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> pd.concat([X_test_df, y_test_df], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="98">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Training set shape: "</span>, X_train.shape, y_train.shape)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test set shape: "</span>, X_test.shape, y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training set shape:  (375458, 78) (375458,)
Test set shape:  (19761, 78) (19761,)</code></pre>
</div>
</div>
</section>
<section id="normalising-the-data" class="level2">
<h2 class="anchored" data-anchor-id="normalising-the-data">Normalising the Data</h2>
<p>Some machine learning algorithms require all columns of the dataframe to consist of data on comparable scales. We use <code>StandardScalar</code> from scikit-learn to force this to be true.</p>
<p>There is rarely a drawback to normalising data like this. If in doubt, normalise.</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="74">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="75">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>X_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>array([[ 0.82301704, -0.55823002, -1.28362299, ..., -0.03076372,
        -0.02818382, -2.75955691],
       [-1.45078579, -0.55823002, -0.46740923, ..., -0.03076372,
        -0.02818382,  0.01934793],
       [-1.25930765, -0.55823002,  1.14265627, ..., -0.03076372,
        -0.02818382,  0.5751289 ],
       ...,
       [ 0.70334321, -0.55823002, -0.36901634, ..., -0.03076372,
        -0.02818382,  0.29723841],
       [ 1.90008154, -0.55823002, -0.33994571, ..., -0.03076372,
        -0.02818382, -1.78694022],
       [-0.52929727, -0.55823002, -1.17404909, ..., -0.03076372,
        -0.02818382, -0.25854255]])</code></pre>
</div>
</div>
</section>
</section>
<section id="model-selection-and-hyperparameter-tuning-with-optuna" class="level1">
<h1>Model Selection and Hyperparameter Tuning with Optuna</h1>
<p>The following two code cells implement an Optuna study to select a model with tuned hyperparameters to maximize the F1 score using cross-validation.</p>
<ul>
<li><p>We tune to maximize the F1 score of the classifiers rather than other metrics (such as classification accuracy) because the target <code>loan_repaid</code> is imbalanced.</p></li>
<li><p>The model choices searched over are <code>DecisionTreeClassifier</code>, <code>RandomForestClassifier</code> and <code>LogisticRegression</code> from sklearn, <code>XGBClassifier</code> from XGBoost and artificial neural networks (of varying architecture) implemented in TensorFlow.</p></li>
<li><p>The architecture of the neural networks is also tuned. The number of hidden layers is allowed to range from 1 to 6 (inclusive) and the number of units per hidden layer ranges from 32 to 512. The only activation function considered for the hidden layers is ReLU.</p></li>
<li><p>I initially attempted to seperate the model selection and hyperparameter tuning by implementing a seperate Optuna study for each choice of model. Due to the size of the dataset this proved to be impractical.</p></li>
<li><p>Combining the model selection and hyperparameter tuning into a single Optuna study is elegant and allows for a more automated tuning process. It also allows for computational gains due to the shared hyperparameters between the tree-based models <code>DecisionTreeClasifier</code>, <code>RandomForestClassifier</code> and <code>XGBClassifier</code>. In expense for the higher degree of automation the user gains less insight into the reasons behind the model selection than they would if the model was selected manually.</p></li>
<li><p>Attempts to incorporate a support vector machine (<code>SVC</code> from sklearn) into the study failed due to the training time required.</p></li>
</ul>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> objective(trial):</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    model_type <span class="op">=</span> trial.suggest_categorical(<span class="st">'model_type'</span>, [<span class="st">'random_forest'</span>, <span class="st">'decision_tree'</span>, <span class="st">'xgboost'</span>, <span class="st">'neural_network'</span>, <span class="st">'logistic_regression'</span>])</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initializing hyperparameters and model for each possible choice of model:</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model_type <span class="kw">in</span> [<span class="st">'random_forest'</span>, <span class="st">'decision_tree'</span>, <span class="st">'xgboost'</span>]:</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Shared hyperparameters for RandomForest, DecisionTree, and XGBoost:</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>        max_depth <span class="op">=</span> trial.suggest_int(<span class="st">'max_depth'</span>, <span class="dv">2</span>, <span class="dv">32</span>)</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>        min_samples_split <span class="op">=</span> trial.suggest_int(<span class="st">'min_samples_split'</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf <span class="op">=</span> trial.suggest_int(<span class="st">'min_samples_leaf'</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'decision_tree'</span>:</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>                max_depth<span class="op">=</span>max_depth,</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>                min_samples_split<span class="op">=</span>min_samples_split,</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>                min_samples_leaf<span class="op">=</span>min_samples_leaf,</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> model_type <span class="kw">in</span>  [<span class="st">'random_forest'</span>,<span class="st">'xgboost'</span>]:</span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Shared hyperparameters for RandomForest and XGBoost but not DecisionTree:</span></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a>            n_estimators <span class="op">=</span> trial.suggest_int(<span class="st">'n_estimators'</span>, <span class="dv">10</span>, <span class="dv">300</span>)</span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'random_forest'</span>:</span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a>                    n_estimators<span class="op">=</span>n_estimators,</span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a>                    max_depth<span class="op">=</span>max_depth,</span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a>                    min_samples_split<span class="op">=</span>min_samples_split,</span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a>                    min_samples_leaf<span class="op">=</span>min_samples_leaf,</span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">'xgboost'</span>:</span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a>                learning_rate_xgb <span class="op">=</span> trial.suggest_float(<span class="st">'learning_rate_xgb'</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>)</span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>                min_child_weight <span class="op">=</span> trial.suggest_int(<span class="st">'min_child_weight'</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a>                subsample <span class="op">=</span> trial.suggest_float(<span class="st">'subsample'</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>)</span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a>                reg_alpha <span class="op">=</span> trial.suggest_float(<span class="st">'reg_alpha'</span>, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a>                reg_lambda <span class="op">=</span> trial.suggest_float(<span class="st">'reg_lambda'</span>, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>                colsample_bytree <span class="op">=</span> trial.suggest_float(<span class="st">'colsample_bytree'</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>)</span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a>                gamma <span class="op">=</span> trial.suggest_float(<span class="st">'gamma'</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a>                    learning_rate<span class="op">=</span>learning_rate_xgb,</span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a>                    n_estimators<span class="op">=</span>n_estimators,</span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a>                    max_depth<span class="op">=</span>max_depth,</span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a>                    min_child_weight<span class="op">=</span>min_child_weight,</span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a>                    subsample<span class="op">=</span>subsample,</span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a>                    colsample_bytree<span class="op">=</span>colsample_bytree,</span>
<span id="cb117-52"><a href="#cb117-52" aria-hidden="true" tabindex="-1"></a>                    gamma<span class="op">=</span>gamma,</span>
<span id="cb117-53"><a href="#cb117-53" aria-hidden="true" tabindex="-1"></a>                    reg_alpha<span class="op">=</span>reg_alpha,</span>
<span id="cb117-54"><a href="#cb117-54" aria-hidden="true" tabindex="-1"></a>                    reg_lambda<span class="op">=</span>reg_lambda</span>
<span id="cb117-55"><a href="#cb117-55" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb117-56"><a href="#cb117-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-57"><a href="#cb117-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-58"><a href="#cb117-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">'logistic_regression'</span>:</span>
<span id="cb117-59"><a href="#cb117-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-60"><a href="#cb117-60" aria-hidden="true" tabindex="-1"></a>        C <span class="op">=</span> trial.suggest_float(<span class="st">'C'</span>, <span class="fl">1e-5</span>, <span class="fl">1e5</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb117-61"><a href="#cb117-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-62"><a href="#cb117-62" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> LogisticRegression(C<span class="op">=</span>C, penalty<span class="op">=</span><span class="st">'l2'</span>, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb117-63"><a href="#cb117-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-64"><a href="#cb117-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-65"><a href="#cb117-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">'neural_network'</span>:</span>
<span id="cb117-66"><a href="#cb117-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># NeuralNetwork-specific hyperparameters</span></span>
<span id="cb117-67"><a href="#cb117-67" aria-hidden="true" tabindex="-1"></a>        n_hidden_layers <span class="op">=</span> trial.suggest_int(<span class="st">'n_hidden_layers'</span>, <span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb117-68"><a href="#cb117-68" aria-hidden="true" tabindex="-1"></a>        learning_rate <span class="op">=</span> trial.suggest_float(<span class="st">'learning_rate'</span>, <span class="fl">1e-5</span>, <span class="fl">1e-1</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb117-69"><a href="#cb117-69" aria-hidden="true" tabindex="-1"></a>        batch_size <span class="op">=</span> trial.suggest_categorical(<span class="st">'batch_size'</span>,[<span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>, <span class="dv">512</span>])</span>
<span id="cb117-70"><a href="#cb117-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-71"><a href="#cb117-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create the model</span></span>
<span id="cb117-72"><a href="#cb117-72" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> Sequential()</span>
<span id="cb117-73"><a href="#cb117-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-74"><a href="#cb117-74" aria-hidden="true" tabindex="-1"></a>        model.add(Dense(<span class="dv">78</span>, input_dim<span class="op">=</span><span class="dv">78</span>, activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb117-75"><a href="#cb117-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-76"><a href="#cb117-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_hidden_layers):</span>
<span id="cb117-77"><a href="#cb117-77" aria-hidden="true" tabindex="-1"></a>            model.add(Dense(trial.suggest_categorical(<span class="ss">f'n_units_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, [<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">256</span>]), activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb117-78"><a href="#cb117-78" aria-hidden="true" tabindex="-1"></a>            model.add(Dropout(<span class="fl">0.7</span>))</span>
<span id="cb117-79"><a href="#cb117-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-80"><a href="#cb117-80" aria-hidden="true" tabindex="-1"></a>        model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'sigmoid'</span>))</span>
<span id="cb117-81"><a href="#cb117-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-82"><a href="#cb117-82" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">compile</span>(</span>
<span id="cb117-83"><a href="#cb117-83" aria-hidden="true" tabindex="-1"></a>            loss<span class="op">=</span>tf.keras.losses.BinaryCrossentropy(),</span>
<span id="cb117-84"><a href="#cb117-84" aria-hidden="true" tabindex="-1"></a>            optimizer<span class="op">=</span>tf.keras.optimizers.Adam(learning_rate),</span>
<span id="cb117-85"><a href="#cb117-85" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb117-86"><a href="#cb117-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-87"><a href="#cb117-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Training with Cross-Validation</span></span>
<span id="cb117-88"><a href="#cb117-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-89"><a href="#cb117-89" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">594</span>)</span>
<span id="cb117-90"><a href="#cb117-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-91"><a href="#cb117-91" aria-hidden="true" tabindex="-1"></a>    f1_scores <span class="op">=</span> []</span>
<span id="cb117-92"><a href="#cb117-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-93"><a href="#cb117-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> train_idx, val_idx <span class="kw">in</span> cv.split(X_train, y_train):</span>
<span id="cb117-94"><a href="#cb117-94" aria-hidden="true" tabindex="-1"></a>        X_cv_train, X_cv_val <span class="op">=</span> X_train[train_idx], X_train[val_idx]</span>
<span id="cb117-95"><a href="#cb117-95" aria-hidden="true" tabindex="-1"></a>        y_cv_train, y_cv_val <span class="op">=</span> y_train[train_idx], y_train[val_idx]</span>
<span id="cb117-96"><a href="#cb117-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-97"><a href="#cb117-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'neural_network'</span>:  <span class="co"># Neural Networks have a different syntax for model.fit</span></span>
<span id="cb117-98"><a href="#cb117-98" aria-hidden="true" tabindex="-1"></a>            model.fit(X_cv_train,</span>
<span id="cb117-99"><a href="#cb117-99" aria-hidden="true" tabindex="-1"></a>                      y_cv_train,</span>
<span id="cb117-100"><a href="#cb117-100" aria-hidden="true" tabindex="-1"></a>                      epochs<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb117-101"><a href="#cb117-101" aria-hidden="true" tabindex="-1"></a>                      batch_size<span class="op">=</span>batch_size,</span>
<span id="cb117-102"><a href="#cb117-102" aria-hidden="true" tabindex="-1"></a>                      verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb117-103"><a href="#cb117-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:   </span>
<span id="cb117-104"><a href="#cb117-104" aria-hidden="true" tabindex="-1"></a>            model.fit(X_cv_train, y_cv_train)</span>
<span id="cb117-105"><a href="#cb117-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-106"><a href="#cb117-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-107"><a href="#cb117-107" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.<span class="bu">round</span>(model.predict(X_cv_val))</span>
<span id="cb117-108"><a href="#cb117-108" aria-hidden="true" tabindex="-1"></a>        f1_scores.append(f1_score(y_cv_val, y_pred))</span>
<span id="cb117-109"><a href="#cb117-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-110"><a href="#cb117-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Defining the score as the mean of the f1 scores for each fold</span></span>
<span id="cb117-111"><a href="#cb117-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-112"><a href="#cb117-112" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> np.mean(f1_scores)</span>
<span id="cb117-113"><a href="#cb117-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-114"><a href="#cb117-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="79">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">'maximize'</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>study.optimize(objective, n_trials<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2024-03-18 22:06:40,744] A new study created in memory with name: no-name-57f734b0-8962-432d-bfb6-59471441a5f4
[I 2024-03-18 22:06:48,434] Trial 0 finished with value: 0.9348813881269542 and parameters: {'model_type': 'decision_tree', 'max_depth': 3, 'min_samples_split': 7, 'min_samples_leaf': 4}. Best is trial 0 with value: 0.9348813881269542.
[I 2024-03-18 22:07:02,292] Trial 1 finished with value: 0.9351173423793565 and parameters: {'model_type': 'logistic_regression', 'C': 0.003376487874914207}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:07:27,675] Trial 2 finished with value: 0.9308350280356752 and parameters: {'model_type': 'decision_tree', 'max_depth': 16, 'min_samples_split': 9, 'min_samples_leaf': 3}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:15:32,269] Trial 3 finished with value: 0.9350101137588679 and parameters: {'model_type': 'xgboost', 'max_depth': 28, 'min_samples_split': 5, 'min_samples_leaf': 1, 'n_estimators': 184, 'learning_rate_xgb': 0.016618408577867994, 'min_child_weight': 5, 'subsample': 0.8917198401161827, 'reg_alpha': 0.8616141785378104, 'reg_lambda': 0.7523759516329682, 'colsample_bytree': 0.8157162246657587, 'gamma': 0.28038167915123857}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:20:42,102] Trial 4 finished with value: 0.9321975043732882 and parameters: {'model_type': 'xgboost', 'max_depth': 15, 'min_samples_split': 9, 'min_samples_leaf': 4, 'n_estimators': 219, 'learning_rate_xgb': 0.16305096746719058, 'min_child_weight': 7, 'subsample': 0.9134170979002356, 'reg_alpha': 0.26508659053047456, 'reg_lambda': 0.138587811192453, 'colsample_bytree': 0.8552290270444581, 'gamma': 0.1061279968034901}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:21:10,756] Trial 5 finished with value: 0.9243288921392534 and parameters: {'model_type': 'decision_tree', 'max_depth': 19, 'min_samples_split': 2, 'min_samples_leaf': 2}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:21:59,392] Trial 6 finished with value: 0.9349168875035684 and parameters: {'model_type': 'xgboost', 'max_depth': 11, 'min_samples_split': 4, 'min_samples_leaf': 3, 'n_estimators': 43, 'learning_rate_xgb': 0.175014877747516, 'min_child_weight': 1, 'subsample': 0.9870392659632631, 'reg_alpha': 0.7735504526827838, 'reg_lambda': 0.17110783013189612, 'colsample_bytree': 0.9737179700729804, 'gamma': 0.15108925636371232}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:22:23,025] Trial 7 finished with value: 0.9334728765188016 and parameters: {'model_type': 'decision_tree', 'max_depth': 14, 'min_samples_split': 6, 'min_samples_leaf': 2}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:25:01,738] Trial 8 finished with value: 0.932800002007825 and parameters: {'model_type': 'xgboost', 'max_depth': 16, 'min_samples_split': 9, 'min_samples_leaf': 1, 'n_estimators': 91, 'learning_rate_xgb': 0.18146088009665673, 'min_child_weight': 2, 'subsample': 0.8679306976916659, 'reg_alpha': 0.8252235195309418, 'reg_lambda': 0.712616986557245, 'colsample_bytree': 0.9125270189180515, 'gamma': 0.1686125594604482}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:33:49,108] Trial 9 finished with value: 0.7142288590214265 and parameters: {'model_type': 'neural_network', 'n_hidden_layers': 5, 'learning_rate': 0.0007589397505339159, 'batch_size': 256, 'n_units_1': 32, 'n_units_2': 256, 'n_units_3': 128, 'n_units_4': 32, 'n_units_5': 32}. Best is trial 1 with value: 0.9351173423793565.
[I 2024-03-18 22:34:00,258] Trial 10 finished with value: 0.9351463663145185 and parameters: {'model_type': 'logistic_regression', 'C': 0.0016662846208744218}. Best is trial 10 with value: 0.9351463663145185.
[I 2024-03-18 22:34:09,393] Trial 11 finished with value: 0.9351004010191634 and parameters: {'model_type': 'logistic_regression', 'C': 0.0010317129078925686}. Best is trial 10 with value: 0.9351463663145185.
[I 2024-03-18 22:34:22,985] Trial 12 finished with value: 0.9351229667198243 and parameters: {'model_type': 'logistic_regression', 'C': 0.0034007756162559443}. Best is trial 10 with value: 0.9351463663145185.
[I 2024-03-18 22:35:58,457] Trial 13 finished with value: 0.9349544159815644 and parameters: {'model_type': 'logistic_regression', 'C': 12.73995665452104}. Best is trial 10 with value: 0.9351463663145185.
[I 2024-03-18 22:54:25,454] Trial 14 finished with value: 0.9351871782786303 and parameters: {'model_type': 'random_forest', 'max_depth': 32, 'min_samples_split': 2, 'min_samples_leaf': 1, 'n_estimators': 279}. Best is trial 14 with value: 0.9351871782786303.
[I 2024-03-18 23:13:43,695] Trial 15 finished with value: 0.9351857977737448 and parameters: {'model_type': 'random_forest', 'max_depth': 32, 'min_samples_split': 2, 'min_samples_leaf': 1, 'n_estimators': 293}. Best is trial 14 with value: 0.9351871782786303.
[I 2024-03-18 23:33:04,396] Trial 16 finished with value: 0.935266998582307 and parameters: {'model_type': 'random_forest', 'max_depth': 31, 'min_samples_split': 2, 'min_samples_leaf': 1, 'n_estimators': 297}. Best is trial 16 with value: 0.935266998582307.
[I 2024-03-18 23:49:25,148] Trial 17 finished with value: 0.9351134430131598 and parameters: {'model_type': 'random_forest', 'max_depth': 25, 'min_samples_split': 3, 'min_samples_leaf': 2, 'n_estimators': 291}. Best is trial 16 with value: 0.935266998582307.
[I 2024-03-19 00:05:11,031] Trial 18 finished with value: 0.9351522931336632 and parameters: {'model_type': 'random_forest', 'max_depth': 32, 'min_samples_split': 4, 'min_samples_leaf': 1, 'n_estimators': 241}. Best is trial 16 with value: 0.935266998582307.
[I 2024-03-19 00:21:55,036] Trial 19 finished with value: 0.9351375564429716 and parameters: {'model_type': 'random_forest', 'max_depth': 24, 'min_samples_split': 2, 'min_samples_leaf': 1, 'n_estimators': 300}. Best is trial 16 with value: 0.935266998582307.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>2347/2347 [==============================] - 2s 790us/step
2347/2347 [==============================] - 2s 776us/step
2347/2347 [==============================] - 2s 785us/step
2347/2347 [==============================] - 2s 795us/step
2347/2347 [==============================] - 2s 779us/step</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="85">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> study.best_params</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Best parameters found by the study:</span><span class="ch">\n</span><span class="st">'</span>, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameters found by the study:
 {'model_type': 'random_forest', 'max_depth': 31, 'min_samples_split': 2, 'min_samples_leaf': 1, 'n_estimators': 297}</code></pre>
</div>
</div>
</section>
<section id="fitting-the-best-model-and-predicting-on-test-set" class="level1">
<h1>Fitting the Best Model and Predicting on Test Set</h1>
<p>The Optuna study tried all of the allowed models at least once, and settled on a <code>RandomForestClassifier</code> being the one that maxmised the mean of the F1 scores across each fold of the cross-validation.</p>
<p>Initialising and fitting this model to the train set:</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">'max_depth'</span>: <span class="dv">31</span>, <span class="st">'min_samples_split'</span>: <span class="dv">2</span>, <span class="st">'min_samples_leaf'</span>: <span class="dv">1</span>, <span class="st">'n_estimators'</span>: <span class="dv">297</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="78">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="79">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=31, n_estimators=297)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(max_depth=31, n_estimators=297)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="80">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="81">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'F1 Score of best model on test set:  '</span>, f1_score(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score of best model on test set:   0.9361802943702432</code></pre>
</div>
</div>
<p>The true F1 score on the test set turned out to be even higher than the cross-val score of 0.935266998582307 found during the study.</p>
<div class="cell" data-tags="[]" data-execution_count="82">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 1800  2112]
 [   43 15806]]</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="83">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.98      0.46      0.63      3912
           1       0.88      1.00      0.94     15849

    accuracy                           0.89     19761
   macro avg       0.93      0.73      0.78     19761
weighted avg       0.90      0.89      0.87     19761
</code></pre>
</div>
</div>
</section>
<section id="examining-misclassified-points" class="level1">
<h1>Examining Misclassified Points</h1>
<p>Printing the features of a random false positive and a random false negative:</p>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="99">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, y_pred).ravel()</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>fp_indices <span class="op">=</span> np.where((y_test <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (y_pred <span class="op">==</span> <span class="dv">1</span>))</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>fn_indices <span class="op">=</span> np.where((y_test <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (y_pred <span class="op">==</span> <span class="dv">0</span>))</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>random_fp <span class="op">=</span> np.random.choice(fp_indices[<span class="dv">0</span>])</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>random_fn <span class="op">=</span> np.random.choice(fn_indices[<span class="dv">0</span>])</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>fp_row <span class="op">=</span> df_test.iloc[random_fp].<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>fn_row <span class="op">=</span> df_test.iloc[random_fn].<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Random False Positive:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Index=</span><span class="sc">{</span>random_fp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_pred=</span><span class="sc">{</span>y_pred[random_fp]<span class="sc">}</span><span class="ss">, y_true=</span><span class="sc">{</span>y_test[random_fp]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp_row)</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-----------------------------------------------------"</span>)</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Random False Negative:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Index=</span><span class="sc">{</span>random_fn<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_pred=</span><span class="sc">{</span>y_pred[random_fn]<span class="sc">}</span><span class="ss">, y_true=</span><span class="sc">{</span>y_test[random_fn]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fn_row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random False Positive:

Index=2906
y_pred=1, y_true=0

loan_amnt                              22000.00
term                                      60.00
int_rate                                  22.15
installment                              609.50
annual_inc                             65000.00
dti                                       25.48
open_acc                                  13.00
pub_rec                                    1.00
revol_bal                               4418.00
revol_util                                38.00
total_acc                                 28.00
mort_acc                                   3.00
pub_rec_bankruptcies                       1.00
home_ownership_OTHER                       0.00
home_ownership_OWN                         0.00
home_ownership_RENT                        0.00
verification_status_Source Verified        1.00
verification_status_Verified               0.00
application_type_INDIVIDUAL                1.00
application_type_JOINT                     0.00
initial_list_status_w                      1.00
purpose_credit_card                        0.00
purpose_debt_consolidation                 1.00
purpose_educational                        0.00
purpose_home_improvement                   0.00
purpose_house                              0.00
purpose_major_purchase                     0.00
purpose_medical                            0.00
purpose_moving                             0.00
purpose_other                              0.00
purpose_renewable_energy                   0.00
purpose_small_business                     0.00
purpose_vacation                           0.00
purpose_wedding                            0.00
zip_code_05113                             0.00
zip_code_11650                             0.00
zip_code_22690                             0.00
zip_code_29597                             0.00
zip_code_30723                             0.00
zip_code_48052                             1.00
zip_code_70466                             0.00
zip_code_86630                             0.00
zip_code_93700                             0.00
sub_grade_A2                               0.00
sub_grade_A3                               0.00
sub_grade_A4                               0.00
sub_grade_A5                               0.00
sub_grade_B1                               0.00
sub_grade_B2                               0.00
sub_grade_B3                               0.00
sub_grade_B4                               0.00
sub_grade_B5                               0.00
sub_grade_C1                               0.00
sub_grade_C2                               0.00
sub_grade_C3                               0.00
sub_grade_C4                               0.00
sub_grade_C5                               0.00
sub_grade_D1                               0.00
sub_grade_D2                               0.00
sub_grade_D3                               0.00
sub_grade_D4                               0.00
sub_grade_D5                               0.00
sub_grade_E1                               0.00
sub_grade_E2                               0.00
sub_grade_E3                               0.00
sub_grade_E4                               0.00
sub_grade_E5                               1.00
sub_grade_F1                               0.00
sub_grade_F2                               0.00
sub_grade_F3                               0.00
sub_grade_F4                               0.00
sub_grade_F5                               0.00
sub_grade_G1                               0.00
sub_grade_G2                               0.00
sub_grade_G3                               0.00
sub_grade_G4                               0.00
sub_grade_G5                               0.00
earliest_cr_year                        1998.00
loan_repaid                                0.00
Name: 2906, dtype: float64
-----------------------------------------------------
Random False Negative:

Index=8627
y_pred=0, y_true=1

loan_amnt                              20975.00
term                                      60.00
int_rate                                  20.99
installment                              567.33
annual_inc                             50000.00
dti                                       30.47
open_acc                                  17.00
pub_rec                                    0.00
revol_bal                              18290.00
revol_util                                63.30
total_acc                                 34.00
mort_acc                                   0.00
pub_rec_bankruptcies                       0.00
home_ownership_OTHER                       0.00
home_ownership_OWN                         0.00
home_ownership_RENT                        1.00
verification_status_Source Verified        0.00
verification_status_Verified               1.00
application_type_INDIVIDUAL                1.00
application_type_JOINT                     0.00
initial_list_status_w                      1.00
purpose_credit_card                        0.00
purpose_debt_consolidation                 1.00
purpose_educational                        0.00
purpose_home_improvement                   0.00
purpose_house                              0.00
purpose_major_purchase                     0.00
purpose_medical                            0.00
purpose_moving                             0.00
purpose_other                              0.00
purpose_renewable_energy                   0.00
purpose_small_business                     0.00
purpose_vacation                           0.00
purpose_wedding                            0.00
zip_code_05113                             0.00
zip_code_11650                             0.00
zip_code_22690                             0.00
zip_code_29597                             0.00
zip_code_30723                             1.00
zip_code_48052                             0.00
zip_code_70466                             0.00
zip_code_86630                             0.00
zip_code_93700                             0.00
sub_grade_A2                               0.00
sub_grade_A3                               0.00
sub_grade_A4                               0.00
sub_grade_A5                               0.00
sub_grade_B1                               0.00
sub_grade_B2                               0.00
sub_grade_B3                               0.00
sub_grade_B4                               0.00
sub_grade_B5                               0.00
sub_grade_C1                               0.00
sub_grade_C2                               0.00
sub_grade_C3                               0.00
sub_grade_C4                               0.00
sub_grade_C5                               0.00
sub_grade_D1                               0.00
sub_grade_D2                               0.00
sub_grade_D3                               0.00
sub_grade_D4                               0.00
sub_grade_D5                               0.00
sub_grade_E1                               0.00
sub_grade_E2                               0.00
sub_grade_E3                               0.00
sub_grade_E4                               1.00
sub_grade_E5                               0.00
sub_grade_F1                               0.00
sub_grade_F2                               0.00
sub_grade_F3                               0.00
sub_grade_F4                               0.00
sub_grade_F5                               0.00
sub_grade_G1                               0.00
sub_grade_G2                               0.00
sub_grade_G3                               0.00
sub_grade_G4                               0.00
sub_grade_G5                               0.00
earliest_cr_year                        1992.00
loan_repaid                                1.00
Name: 8627, dtype: float64</code></pre>
</div>
</div>
<section id="producing-some-visualisations-investigating-the-distribution-of-misclassified-points" class="level2">
<h2 class="anchored" data-anchor-id="producing-some-visualisations-investigating-the-distribution-of-misclassified-points">Producing some visualisations investigating the distribution of misclassified points</h2>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>misclassified <span class="op">=</span> df.iloc[np.concatenate((fp_indices[<span class="dv">0</span>], fn_indices[<span class="dv">0</span>]))].copy()</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>misclassified.loc[:, <span class="st">'type'</span>] <span class="op">=</span> [<span class="st">'FP'</span> <span class="cf">if</span> i <span class="kw">in</span> fp_indices[<span class="dv">0</span>] <span class="cf">else</span> <span class="st">'FN'</span> <span class="cf">for</span> i <span class="kw">in</span> misclassified.index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="87">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of loan_amnt</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'type'</span>, y<span class="op">=</span><span class="st">'loan_amnt'</span>, data<span class="op">=</span>misclassified)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Loan Amount Spread for Misclassified Points'</span>)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-87-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="88">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of int_rate</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'type'</span>, y<span class="op">=</span><span class="st">'int_rate'</span>, data<span class="op">=</span>misclassified)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Interest Rate Spread for Misclassified Points'</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-88-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="89">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of annual_inc</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'type'</span>, y<span class="op">=</span><span class="st">'annual_inc'</span>, data<span class="op">=</span>misclassified)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Annual Income Spread for Misclassified Points'</span>)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>,<span class="dv">200000</span>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-89-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="90">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of revol_bal</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'type'</span>, y<span class="op">=</span><span class="st">'revol_bal'</span>, data<span class="op">=</span>misclassified)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Revolving Balance Spread for Misclassified Points'</span>)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>,<span class="dv">60000</span>)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-90-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="remarks-further-directions" class="level1">
<h1>Remarks &amp; Further Directions</h1>
<blockquote class="blockquote">
<p>I would’ve liked to conduct more extensive Optuna studies with more trials, but was limited by the extensive training time. The Optuna study above alone took &gt;2 hours. Conducting several studies turned out to just be impractical.</p>
<p>Similarly, I wanted to conduct a seperate Optuna study tuning only over neural networks of varying architecture.</p>
<p>I would’ve preferred to include a <code>SupportVectorClassifier</code> in the study, but again was limited by my computational resources.</p>
</blockquote>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>