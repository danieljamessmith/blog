<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel J Smith">
<meta name="dcterms.date" content="2023-12-22">
<meta name="description" content="Informed by YouTube videos of Rob Mulla we use XGBoost to forecast energy consumption in the eastern US.">

<title>djs - Forecasting Energy Consumption with XGBoost</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">djs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Forecasting Energy Consumption with XGBoost</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">ML</div>
    <div class="quarto-category">Pandas</div>
    <div class="quarto-category">Seaborn</div>
    <div class="quarto-category">XGBoost</div>
    <div class="quarto-category">Time Series Forecasting</div>
  </div>
  </div>

<div>
  <div class="description">
    Informed by YouTube videos of <a href="https://www.youtube.com/@robmulla">Rob Mulla</a> we use XGBoost to forecast energy consumption in the eastern US.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel J Smith </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 22, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="3425a038-4ed8-4a66-b641-f10b2264ea38" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>color_pal <span class="op">=</span> sns.color_palette(<span class="st">'magma'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> TimeSeriesSplit</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f59b8851" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Python version:"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>python <span class="op">--</span>version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python version:
Python 3.11.4</code></pre>
</div>
</div>
<p><strong>Table of contents</strong><a id="toc0_"></a><br>
1. <a href="#toc1_">Data</a><br>
2. <a href="#toc2_">Periodic Trends</a><br>
3. <a href="#toc3_">Outlier Analysis and Removal</a><br>
4. <a href="#toc4_">Feature Creation</a><br>
5. <a href="#toc5_">Lag Features</a><br>
6. <a href="#toc6_">Visualising Feature/Target Relationships</a><br>
7. <a href="#toc7_">Train/Test Split</a><br>
8. <a href="#toc8_"><strong>Aside</strong> - Time Series Cross Validation</a><br>
8.1. <a href="#toc8_1_">Training using Cross-Validation</a><br>
9. <a href="#toc9_">Predicting on Test Set</a><br>
9.1. <a href="#toc9_1_">Fitting an <code>XGBRegressor</code></a><br>
9.2. <a href="#toc9_2_">Feature Importances</a><br>
9.3. <a href="#toc9_3_">Predictions</a><br>
10. <a href="#toc10_">Forecasting the Future</a></p>
<!-- vscode-jupyter-toc-config
    numbering=true
    anchor=true
    flat=true
    minLevel=1
    maxLevel=5
    /vscode-jupyter-toc-config -->
<!-- THIS CELL WILL BE REPLACED ON TOC UPDATE. DO NOT WRITE YOUR TEXT IN THIS CELL -->
<section id="data" class="level1">
<h1>1. <a id="toc1_"></a><a href="#toc0_">Data</a></h1>
<p>The data can be downloaded <a href="https://www.kaggle.com/datasets/robikscube/hourly-energy-consumption">here</a>. According to the Kaggle page:</p>
<blockquote class="blockquote">
<p>PJM Interconnection LLC (PJM) is a regional transmission organization (RTO) in the United States. It is part of the Eastern Interconnection grid operating an electric transmission system serving all or parts of Delaware, Illinois, Indiana, Kentucky, Maryland, Michigan, New Jersey, North Carolina, Ohio, Pennsylvania, Tennessee, Virginia, West Virginia, and the District of Columbia. The hourly power consumption data comes from PJM’s website and are in megawatts (MW).</p>
</blockquote>
<div id="9d591175-a644-41dd-a02c-101a9011108d" class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'PJME_hourly.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4a524de0-caf2-4263-963b-7e1985bdc044" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Datetime</th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2002-12-31 01:00:00</td>
<td>26498.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2002-12-31 02:00:00</td>
<td>25147.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2002-12-31 03:00:00</td>
<td>24574.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2002-12-31 04:00:00</td>
<td>24393.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2002-12-31 05:00:00</td>
<td>24860.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="57ed5f95-4c51-441c-a76b-f05adc247b5a" class="cell" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 145366 entries, 0 to 145365
Data columns (total 2 columns):
 #   Column    Non-Null Count   Dtype  
---  ------    --------------   -----  
 0   Datetime  145366 non-null  object 
 1   PJME_MW   145366 non-null  float64
dtypes: float64(1), object(1)
memory usage: 2.2+ MB</code></pre>
</div>
</div>
<div id="24815591-d87a-48c0-a472-5a50ac7191f1" class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>145366.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>32080.222831</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>6464.012166</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>14544.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>27573.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>31421.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>35650.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>62009.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Use the ‘Datetime’ column as the dataframe index, and convert to the <code>Datetime</code> type</p>
<div id="86de5988-6165-4a37-acdc-032f8c5027b2" class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'Datetime'</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> pd.to_datetime(df.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2381e638-e426-4107-8a60-fd67bd61c9a3" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 145366 entries, 2002-12-31 01:00:00 to 2018-01-02 00:00:00
Data columns (total 1 columns):
 #   Column   Non-Null Count   Dtype  
---  ------   --------------   -----  
 0   PJME_MW  145366 non-null  float64
dtypes: float64(1)
memory usage: 2.2 MB</code></pre>
</div>
</div>
<div id="1460bbe4-0757-478a-bcbd-b4ca08599820" class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Datetime</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 01:00:00</td>
<td>26498.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-31 02:00:00</td>
<td>25147.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 03:00:00</td>
<td>24574.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-31 04:00:00</td>
<td>24393.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 05:00:00</td>
<td>24860.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e3360280" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.plot(style<span class="op">=</span><span class="st">'.'</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>color_pal[<span class="dv">0</span>],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">'PJME Energy Use in MW'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Energy Consumption (MW)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Text(0, 0.5, 'Energy Consumption (MW)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="periodic-trends" class="level1">
<h1>2. <a id="toc2_"></a><a href="#toc0_">Periodic Trends</a></h1>
<div id="e1dd444c-8213-496c-99f1-55d91b841116" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>week <span class="op">=</span> df.loc[(df.index <span class="op">&gt;</span><span class="st">'01-01-2010'</span>) <span class="op">&amp;</span> (df.index <span class="op">&lt;</span> <span class="st">'01-08-2010'</span>)]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>week, ax<span class="op">=</span>ax)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'One Week of Data (01-01-2010 to 01-08-2010)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Energy Consumption (MW)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="4a959de9-b7f9-4ced-83d4-596d479cf5de" class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>selected_date <span class="op">=</span> <span class="st">'01-01-2010'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>selected_day <span class="op">=</span> df.loc[selected_date]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>selected_day, ax<span class="op">=</span>ax)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'One Day of Data (</span><span class="sc">{</span>selected_date<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Energy Consumption (MW)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>One might worry that new year’s day might not be a typical day for energy consumption.</p>
<p>Repeating this plot for the first of February:</p>
<div id="42e4e41e-dc63-4fd3-a9dc-fa4a8d9b86f1" class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>selected_date <span class="op">=</span> <span class="st">'01-02-2010'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>selected_day <span class="op">=</span> df.loc[selected_date]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>selected_day, ax<span class="op">=</span>ax)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'One Day of Data (</span><span class="sc">{</span>selected_date<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Energy Consumption (MW)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It seems that the daily trend seems to be the same.</p>
<p>To be sure, we repeat this plot once more for four randomly chosen dates in 2005-2010:</p>
<div id="7688a6c5-7c38-4eab-b13e-2b0d3ffbdaeb" class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> <span class="st">'01-01-2005'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> <span class="st">'12-31-2010'</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>date_range <span class="op">=</span> pd.date_range(start<span class="op">=</span>start_date, end<span class="op">=</span>end_date)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>), gridspec_kw<span class="op">=</span>{<span class="st">'hspace'</span>: <span class="fl">0.5</span>})</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.flatten()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#FFB6C1'</span>, <span class="st">'#87CEFA'</span>, <span class="st">'#98FB98'</span>, <span class="st">'#FFD700'</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose a random day</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    random_date <span class="op">=</span> pd.to_datetime(np.random.choice(date_range))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    day_data <span class="op">=</span> df[df.index.date <span class="op">==</span> random_date.date()]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a subplot</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i]</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(data<span class="op">=</span>day_data, ax<span class="op">=</span>ax, palette<span class="op">=</span>[colors[i]])</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>random_date<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Time'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Energy Consumption (MW)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Unsuprisingly, the time of year seems to have a significant impact on daily energy consumption patterns.</p>
<p>The very general trend of less energy consumption at night compared with in the day seems however to persist across the year.</p>
<p>Creating another 2x2 grid, this time plotting the energy consumption across random weeks in 2005-2010:</p>
<div id="4f4f33a5" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> <span class="st">'01-01-2005'</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> <span class="st">'12-31-2010'</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>date_range <span class="op">=</span> pd.date_range(start<span class="op">=</span>start_date, end<span class="op">=</span>end_date)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>), gridspec_kw<span class="op">=</span>{<span class="st">'hspace'</span>: <span class="fl">0.5</span>})</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.flatten()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#FFB6C1'</span>, <span class="st">'#87CEFA'</span>, <span class="st">'#98FB98'</span>, <span class="st">'#FFD700'</span>]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose a random week</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    random_start_date <span class="op">=</span> pd.to_datetime(np.random.choice(date_range))</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> random_start_date</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> start_date <span class="op">+</span> pd.DateOffset(days<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    week_data <span class="op">=</span> df.loc[(df.index <span class="op">&gt;=</span> start_date) <span class="op">&amp;</span> (df.index <span class="op">&lt;</span> end_date)]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a subplot</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i]</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(data<span class="op">=</span>week_data, ax<span class="op">=</span>ax, palette<span class="op">=</span>[colors[i]])</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    week_year_string <span class="op">=</span> start_date.strftime(<span class="st">'Week %U, %Y'</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>week_year_string<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Time'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Energy Consumption (MW)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'header.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="outlier-analysis-and-removal" class="level1">
<h1>3. <a id="toc3_"></a><a href="#toc0_">Outlier Analysis and Removal</a></h1>
<div id="8e4c6837-0d63-4d7c-8c21-79aae6d8007a" class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'PJME_MW'</span>].plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                   bins<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>color_pal[<span class="dv">1</span>])</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Energy Consumption (MW)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>Text(0.5, 0, 'Energy Consumption (MW)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f7fecee6-a38e-4fc1-addc-e8e39b559ab5" class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df.query(<span class="st">'PJME_MW &lt; 20_000'</span>).plot(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>),</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                  style<span class="op">=</span><span class="st">'x'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                  color<span class="op">=</span><span class="st">'r'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The data points sitting signficantly below 20,000 in 2013 seem to be highly suspect.</p>
<p>Lower the query threshold to 19,00 in an attempt to isolate these points:</p>
<div id="cd2e61f9-4055-499e-a575-17d346686564" class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df.query(<span class="st">'PJME_MW &lt; 19_000'</span>).plot(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                                  style<span class="op">=</span><span class="st">'x'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                  color<span class="op">=</span><span class="st">'r'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We’ve successfully isolated these outliers, now filtering them out:</p>
<div id="14c5c115-130d-44c4-9d98-52c3a95d3133" class="cell" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.query(<span class="st">'PJME_MW &gt;= 19_000'</span>).copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7a890a55" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df.query(<span class="st">'PJME_MW &lt; 19_000'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="feature-creation" class="level1">
<h1>4. <a id="toc4_"></a><a href="#toc0_">Feature Creation</a></h1>
<div id="4b940deb-6614-4be5-b296-6affcd5ebde1" class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_features(df):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Create time series features using pd DateTime object methods on dataframe index</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'hour'</span>] <span class="op">=</span> df.index.hour</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'dayofweek'</span>] <span class="op">=</span> df.index.dayofweek</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'quarter'</span>] <span class="op">=</span> df.index.quarter</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df.index.month</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'year'</span>] <span class="op">=</span> df.index.year</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'dayofyear'</span>] <span class="op">=</span> df.index.dayofyear</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ed7e1645-4624-4516-af58-4d0972eae52e" class="cell" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> create_features(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6460b2a6" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">dayofweek</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dayofyear</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Datetime</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 01:00:00</td>
<td>26498.0</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-31 02:00:00</td>
<td>25147.0</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 03:00:00</td>
<td>24574.0</td>
<td>3</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-31 04:00:00</td>
<td>24393.0</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 05:00:00</td>
<td>24860.0</td>
<td>5</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01 20:00:00</td>
<td>44284.0</td>
<td>20</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-01 21:00:00</td>
<td>43751.0</td>
<td>21</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01 22:00:00</td>
<td>42402.0</td>
<td>22</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-01 23:00:00</td>
<td>40164.0</td>
<td>23</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-02 00:00:00</td>
<td>38608.0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>2</td>
</tr>
</tbody>
</table>

<p>145351 rows × 7 columns</p>
</div>
</div>
</div>
</section>
<section id="lag-features" class="level1">
<h1>5. <a id="toc5_"></a><a href="#toc0_">Lag Features</a></h1>
<div id="a3bf34d8-4e04-4c99-a536-ce8a58dd0dc8" class="cell" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_lags(df):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    target_map <span class="op">=</span> df[<span class="st">'PJME_MW'</span>].to_dict()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lag1'</span>] <span class="op">=</span> (df.index <span class="op">-</span> pd.Timedelta(<span class="st">'364 days'</span>)).<span class="bu">map</span>(target_map)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lag2'</span>] <span class="op">=</span> (df.index <span class="op">-</span> pd.Timedelta(<span class="st">'728 days'</span>)).<span class="bu">map</span>(target_map)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lag3'</span>] <span class="op">=</span> (df.index <span class="op">-</span> pd.Timedelta(<span class="st">'1092 days'</span>)).<span class="bu">map</span>(target_map)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f0d1c17a-da0d-4cc2-9467-1f9df19d346a" class="cell" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> add_lags(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cbc02e71" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">dayofweek</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dayofyear</th>
<th data-quarto-table-cell-role="th">lag1</th>
<th data-quarto-table-cell-role="th">lag2</th>
<th data-quarto-table-cell-role="th">lag3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Datetime</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 01:00:00</td>
<td>26498.0</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
<td>30393.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-31 02:00:00</td>
<td>25147.0</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
<td>29265.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 03:00:00</td>
<td>24574.0</td>
<td>3</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
<td>28357.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-31 04:00:00</td>
<td>24393.0</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
<td>27899.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-31 05:00:00</td>
<td>24860.0</td>
<td>5</td>
<td>1</td>
<td>4</td>
<td>12</td>
<td>2002</td>
<td>365</td>
<td>28057.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01 20:00:00</td>
<td>44284.0</td>
<td>20</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
<td>34600.0</td>
<td>41772.0</td>
<td>40740.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-01 21:00:00</td>
<td>43751.0</td>
<td>21</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
<td>33674.0</td>
<td>41393.0</td>
<td>40049.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01 22:00:00</td>
<td>42402.0</td>
<td>22</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
<td>32035.0</td>
<td>40092.0</td>
<td>38473.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-01 23:00:00</td>
<td>40164.0</td>
<td>23</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>1</td>
<td>29870.0</td>
<td>37911.0</td>
<td>35962.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-02 00:00:00</td>
<td>38608.0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2018</td>
<td>2</td>
<td>27771.0</td>
<td>35931.0</td>
<td>33680.0</td>
</tr>
</tbody>
</table>

<p>145351 rows × 10 columns</p>
</div>
</div>
</div>
</section>
<section id="visualising-featuretarget-relationships" class="level1">
<h1>6. <a id="toc6_"></a><a href="#toc0_">Visualising Feature/Target Relationships</a></h1>
<div id="788880e7-686b-414d-b7eb-8a6d3745c1ac" class="cell" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'hour'</span>, y<span class="op">=</span><span class="st">'PJME_MW'</span>, palette<span class="op">=</span><span class="st">'magma'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Energy Consumption (MW) by Hour'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ef528dd0" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'month'</span>, y<span class="op">=</span><span class="st">'PJME_MW'</span>, palette<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Energy Consumption (MW) by Month'</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="traintest-split" class="level1">
<h1>7. <a id="toc7_"></a><a href="#toc0_">Train/Test Split</a></h1>
<p>We reserve the data from 2015 and beyond as a test set, and use the data before 2015 as a training set. The following code produces an illustration to help explain this.</p>
<div id="a8122695" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> df.loc[df.index <span class="op">&lt;</span> <span class="st">'01-01-2015'</span>][<span class="st">'PJME_MW'</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> df.loc[df.index <span class="op">&gt;=</span> <span class="st">'01-01-2015'</span>][<span class="st">'PJME_MW'</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>train.plot(ax<span class="op">=</span>ax, </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="st">'Training Set'</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>           title<span class="op">=</span><span class="st">'Data Train/Test Split'</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span>color_pal[<span class="dv">3</span>])</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>test.plot(ax<span class="op">=</span>ax,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>          label<span class="op">=</span><span class="st">'Test Set'</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">0</span>])</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="st">'01-01-2015'</span>, color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>ax.legend([<span class="st">'Training Set'</span>, <span class="st">'Test Set'</span>])</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Energy Consumption (MW)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>Text(0, 0.5, 'Energy Consumption (MW)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-30-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aside---time-series-cross-validation" class="level1">
<h1>8. <a id="toc8_"></a><a href="#toc0_"><strong>Aside</strong> - Time Series Cross Validation</a></h1>
<p>To implement cross-validation while training a model on time series data, one can use <code>TimeSeriesSplit</code> from sklearn.</p>
<div id="0098b337-1679-4ff5-ae63-ea51d583713e" class="cell" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tss <span class="op">=</span> TimeSeriesSplit(n_splits<span class="op">=</span><span class="dv">5</span>, test_size<span class="op">=</span><span class="dv">24</span><span class="op">*</span><span class="dv">365</span><span class="op">*</span><span class="dv">1</span>, gap<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code produces a visualisation to illustrate how the data is structured into a training set and a test set during 5-fold time series cross-validation.</p>
<div id="57f31563" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>fold <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_idx, val_idx <span class="kw">in</span> tss.split(df):</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    train <span class="op">=</span> df.iloc[train_idx]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> df.iloc[val_idx]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    train[<span class="st">'PJME_MW'</span>].plot(ax<span class="op">=</span>axs[fold],</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                          label<span class="op">=</span><span class="st">'Training Set'</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                          title<span class="op">=</span><span class="ss">f'Data Train/Test Split Fold </span><span class="sc">{</span>fold<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                          color<span class="op">=</span>color_pal[<span class="dv">3</span>])</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    test[<span class="st">'PJME_MW'</span>].plot(ax<span class="op">=</span>axs[fold],</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="st">'Test Set'</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                         color<span class="op">=</span>color_pal[<span class="dv">0</span>])</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    axs[fold].axvline(test.index.<span class="bu">min</span>(), color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    fold <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="training-using-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="training-using-cross-validation">8.1. <a id="toc8_1_"></a><a href="#toc0_">Training using Cross-Validation</a></h2>
<p>The following code trains an <code>XGBRegressor</code> on each of the above 5 folds, saving the score (RMSE) in a list <code>scores</code>.</p>
<div id="38a581de-8ac2-48a4-a44b-fa4542c3d944" class="cell" data-tags="[]" data-execution_count="32">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fold <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> []</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_idx, val_idx <span class="kw">in</span> tss.split(df):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    train <span class="op">=</span> df.iloc[train_idx]</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> df.iloc[val_idx]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    train <span class="op">=</span> create_features(train)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> create_features(test)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    FEATURES <span class="op">=</span> [<span class="st">'dayofyear'</span>, <span class="st">'hour'</span>, <span class="st">'dayofweek'</span>, <span class="st">'quarter'</span>, <span class="st">'month'</span>,<span class="st">'year'</span>, <span class="st">'lag1'</span>, <span class="st">'lag2'</span>, <span class="st">'lag3'</span>]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    TARGET <span class="op">=</span> <span class="st">'PJME_MW'</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> train[FEATURES]</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> train[TARGET]</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> test[FEATURES]</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> test[TARGET]</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    reg <span class="op">=</span> xgb.XGBRegressor(base_score<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                           booster<span class="op">=</span><span class="st">'gbtree'</span>,    </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>                           n_estimators<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                           early_stopping_rounds<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                           objective<span class="op">=</span><span class="st">'reg:squarederror'</span>,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                           max_depth<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                           learning_rate<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    reg.fit(X_train, </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>            y_train,</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>            eval_set<span class="op">=</span>[(X_train, y_train), (X_test, y_test)],</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>            verbose<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> reg.predict(X_test)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    preds.append(y_pred)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred))</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    scores.append(score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0] validation_0-rmse:32732.50147   validation_1-rmse:31956.66494
[100]   validation_0-rmse:12532.10915   validation_1-rmse:11906.70125
[200]   validation_0-rmse:5739.78666    validation_1-rmse:5352.86754
[300]   validation_0-rmse:3868.29390    validation_1-rmse:3891.32148
[400]   validation_0-rmse:3428.85875    validation_1-rmse:3753.95996
[456]   validation_0-rmse:3349.18480    validation_1-rmse:3761.64093
[0] validation_0-rmse:32672.16154   validation_1-rmse:32138.88680
[100]   validation_0-rmse:12513.25338   validation_1-rmse:12222.97626
[200]   validation_0-rmse:5755.14393    validation_1-rmse:5649.54800
[300]   validation_0-rmse:3909.18294    validation_1-rmse:3930.98277
[400]   validation_0-rmse:3477.91771    validation_1-rmse:3603.77859
[500]   validation_0-rmse:3356.63775    validation_1-rmse:3534.18452
[600]   validation_0-rmse:3299.24378    validation_1-rmse:3495.69013
[700]   validation_0-rmse:3258.86466    validation_1-rmse:3470.24780
[800]   validation_0-rmse:3222.68998    validation_1-rmse:3446.36557
[900]   validation_0-rmse:3195.04645    validation_1-rmse:3438.00845
[999]   validation_0-rmse:3169.68251    validation_1-rmse:3434.35289
[0] validation_0-rmse:32631.19070   validation_1-rmse:31073.24659
[100]   validation_0-rmse:12498.56469   validation_1-rmse:11133.47932
[200]   validation_0-rmse:5749.48268    validation_1-rmse:4812.56835
[300]   validation_0-rmse:3915.69493    validation_1-rmse:3552.97165
[400]   validation_0-rmse:3493.17887    validation_1-rmse:3492.55244
[415]   validation_0-rmse:3467.76622    validation_1-rmse:3500.17489
[0] validation_0-rmse:32528.44140   validation_1-rmse:31475.37803
[100]   validation_0-rmse:12461.95683   validation_1-rmse:12016.24890
[200]   validation_0-rmse:5736.08201    validation_1-rmse:5800.02075
[300]   validation_0-rmse:3913.36576    validation_1-rmse:4388.02984
[400]   validation_0-rmse:3495.35688    validation_1-rmse:4177.05330
[500]   validation_0-rmse:3380.70922    validation_1-rmse:4123.43863
[600]   validation_0-rmse:3321.42955    validation_1-rmse:4110.84393
[700]   validation_0-rmse:3280.93068    validation_1-rmse:4096.40531
[800]   validation_0-rmse:3249.14336    validation_1-rmse:4095.30547
[809]   validation_0-rmse:3246.14826    validation_1-rmse:4094.38398
[0] validation_0-rmse:32462.05402   validation_1-rmse:31463.86930
[100]   validation_0-rmse:12445.22753   validation_1-rmse:11954.79556
[200]   validation_0-rmse:5750.85887    validation_1-rmse:5616.16472
[300]   validation_0-rmse:3949.92308    validation_1-rmse:4154.55799
[400]   validation_0-rmse:3538.33857    validation_1-rmse:3996.70155
[448]   validation_0-rmse:3471.50174    validation_1-rmse:4005.60241</code></pre>
</div>
</div>
<div id="e1521906-f6eb-4f7e-aa50-ad47fdbd9f57" class="cell" data-tags="[]" data-execution_count="33">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>scores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>[3753.2775219986684,
 3434.3528874818867,
 3475.9138463312997,
 4093.3608331481823,
 3996.298054855067]</code></pre>
</div>
</div>
<div id="32f6e5d0" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Mean score across folds: </span><span class="sc">{</span>np<span class="sc">.</span>mean(scores)<span class="sc">:0.4f}</span><span class="ss">'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Fold scores:</span><span class="ch">\n</span><span class="sc">{</span>scores<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean score across folds: 3750.6406
Fold scores:
[3753.2775219986684, 3434.3528874818867, 3475.9138463312997, 4093.3608331481823, 3996.298054855067]</code></pre>
</div>
</div>
</section>
</section>
<section id="predicting-on-test-set" class="level1">
<h1>9. <a id="toc9_"></a><a href="#toc0_">Predicting on Test Set</a></h1>
<section id="fitting-an-xgbregressor" class="level2">
<h2 class="anchored" data-anchor-id="fitting-an-xgbregressor">9.1. <a id="toc9_1_"></a><a href="#toc0_">Fitting an <code>XGBRegressor</code></a></h2>
<div id="a942f965-1746-4bd2-b049-5c9b50f4593d" class="cell" data-tags="[]" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> xgb.XGBRegressor(base_score<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                         booster<span class="op">=</span><span class="st">'gbtree'</span>,    </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                         n_estimators<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                         early_stopping_rounds<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                         objective<span class="op">=</span><span class="st">'reg:squarederror'</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                         max_depth<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                         learning_rate<span class="op">=</span><span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b009faa3" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>          y_train, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>          eval_set<span class="op">=</span>[(X_train,y_train),(X_test,y_test)],</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>          verbose<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0] validation_0-rmse:32462.05402   validation_1-rmse:31463.86930
[100]   validation_0-rmse:12445.22753   validation_1-rmse:11954.79556
[200]   validation_0-rmse:5750.85887    validation_1-rmse:5616.16472
[300]   validation_0-rmse:3949.92308    validation_1-rmse:4154.55799
[400]   validation_0-rmse:3538.33857    validation_1-rmse:3996.70155
[447]   validation_0-rmse:3472.46884    validation_1-rmse:4004.66554</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBRegressor(base_score=0.5, booster='gbtree', callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=None, early_stopping_rounds=50,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=0.01, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=3, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=1000, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">XGBRegressor</label><div class="sk-toggleable__content"><pre>XGBRegressor(base_score=0.5, booster='gbtree', callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=None, early_stopping_rounds=50,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=0.01, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=3, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=1000, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="feature-importances" class="level2">
<h2 class="anchored" data-anchor-id="feature-importances">9.2. <a id="toc9_2_"></a><a href="#toc0_">Feature Importances</a></h2>
<div id="82062c05-7c39-4fde-a854-ad6d1e74f367" class="cell" data-tags="[]" data-execution_count="37">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fi <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>model.feature_importances_,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                  index<span class="op">=</span>model.feature_names_in_,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                  columns<span class="op">=</span>[<span class="st">'Importance'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1616872b" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fi.sort_values(<span class="st">'Importance'</span>).plot(kind<span class="op">=</span><span class="st">'barh'</span>,title<span class="op">=</span><span class="st">'Feature Importance'</span>,color<span class="op">=</span><span class="st">'blue'</span>,legend<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions" class="level2">
<h2 class="anchored" data-anchor-id="predictions">9.3. <a id="toc9_3_"></a><a href="#toc0_">Predictions</a></h2>
<div id="aaba617f-5c2d-4c03-93eb-fd727bd9ca53" class="cell" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">dayofweek</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dayofyear</th>
<th data-quarto-table-cell-role="th">lag1</th>
<th data-quarto-table-cell-role="th">lag2</th>
<th data-quarto-table-cell-role="th">lag3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Datetime</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-01 01:00:00</td>
<td>30393.0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-01-01 02:00:00</td>
<td>29265.0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-01 03:00:00</td>
<td>28357.0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-01-01 04:00:00</td>
<td>27899.0</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-01 05:00:00</td>
<td>28057.0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-01 20:00:00</td>
<td>45090.0</td>
<td>20</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>213</td>
<td>41056.0</td>
<td>46225.0</td>
<td>43934.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-08-01 21:00:00</td>
<td>43843.0</td>
<td>21</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>213</td>
<td>40151.0</td>
<td>44510.0</td>
<td>42848.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-01 22:00:00</td>
<td>41850.0</td>
<td>22</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>213</td>
<td>38662.0</td>
<td>42467.0</td>
<td>40861.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-08-01 23:00:00</td>
<td>38473.0</td>
<td>23</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>213</td>
<td>35583.0</td>
<td>38646.0</td>
<td>37361.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-02 00:00:00</td>
<td>35126.0</td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>214</td>
<td>32181.0</td>
<td>34829.0</td>
<td>33743.0</td>
</tr>
</tbody>
</table>

<p>136567 rows × 10 columns</p>
</div>
</div>
</div>
<div id="8a7111e9-f449-4d7c-8c42-fdcbf3534a81" class="cell" data-tags="[]" data-execution_count="40">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">dayofweek</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dayofyear</th>
<th data-quarto-table-cell-role="th">lag1</th>
<th data-quarto-table-cell-role="th">lag2</th>
<th data-quarto-table-cell-role="th">lag3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Datetime</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-03 01:00:00</td>
<td>29189.0</td>
<td>1</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>215</td>
<td>28809.0</td>
<td>29952.0</td>
<td>28465.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-08-03 02:00:00</td>
<td>27584.0</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>215</td>
<td>27039.0</td>
<td>27934.0</td>
<td>26712.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-03 03:00:00</td>
<td>26544.0</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>215</td>
<td>25881.0</td>
<td>26659.0</td>
<td>25547.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-08-03 04:00:00</td>
<td>26012.0</td>
<td>4</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>215</td>
<td>25300.0</td>
<td>25846.0</td>
<td>24825.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-03 05:00:00</td>
<td>26187.0</td>
<td>5</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2017</td>
<td>215</td>
<td>25412.0</td>
<td>25898.0</td>
<td>24927.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-08-02 20:00:00</td>
<td>44057.0</td>
<td>20</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>214</td>
<td>42256.0</td>
<td>41485.0</td>
<td>38804.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-08-02 21:00:00</td>
<td>43256.0</td>
<td>21</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>214</td>
<td>41210.0</td>
<td>40249.0</td>
<td>38748.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-08-02 22:00:00</td>
<td>41552.0</td>
<td>22</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>214</td>
<td>39525.0</td>
<td>38698.0</td>
<td>37330.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-08-02 23:00:00</td>
<td>38500.0</td>
<td>23</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>214</td>
<td>36490.0</td>
<td>35406.0</td>
<td>34552.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-08-03 00:00:00</td>
<td>35486.0</td>
<td>0</td>
<td>4</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>215</td>
<td>33539.0</td>
<td>32094.0</td>
<td>31695.0</td>
</tr>
</tbody>
</table>

<p>8760 rows × 10 columns</p>
</div>
</div>
</div>
<div id="f4f0793a-990d-47fd-bbb9-6f6acdd194e2" class="cell" data-tags="[]" data-execution_count="41">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>test[<span class="st">'prediction'</span>] <span class="op">=</span> model.predict(X_test)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(test[[<span class="st">'prediction'</span>]],how<span class="op">=</span><span class="st">'left'</span>,left_index<span class="op">=</span><span class="va">True</span>,right_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2db575f5-e3ae-4643-beb3-3bec31e6e67e" class="cell" data-tags="[]" data-execution_count="42">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>test[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>Datetime
2017-08-03 01:00:00    27884.035156
2017-08-03 02:00:00    27147.710938
2017-08-03 03:00:00    26344.050781
2017-08-03 04:00:00    25737.550781
2017-08-03 05:00:00    25737.550781
                           ...     
2018-08-02 20:00:00    40988.347656
2018-08-02 21:00:00    40045.542969
2018-08-02 22:00:00    38405.371094
2018-08-02 23:00:00    36211.242188
2018-08-03 00:00:00    30370.074219
Name: prediction, Length: 8760, dtype: float32</code></pre>
</div>
</div>
<div id="91a37ba7-cf98-4fb0-ac47-62455793e14c" class="cell" data-tags="[]" data-execution_count="43">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>test[<span class="st">'prediction'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>count     8760.000000
mean     30520.908203
std       5277.272949
min      21005.292969
25%      26730.913086
50%      30010.917969
75%      33361.808594
max      46170.230469
Name: prediction, dtype: float64</code></pre>
</div>
</div>
<p>We can visualise the predicted energy consumption for a particular week:</p>
<div id="acd18ed2" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> <span class="st">'04-01-2018'</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> <span class="st">'04-08-2018'</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df.loc[(df.index <span class="op">&gt;</span> start_date) <span class="op">&amp;</span> (df.index <span class="op">&lt;</span> end_date)]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span>filtered_df.index, y<span class="op">=</span><span class="st">'PJME_MW'</span>, label<span class="op">=</span><span class="st">'Truth'</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span>filtered_df.index, y<span class="op">=</span><span class="st">'prediction'</span>, label<span class="op">=</span><span class="st">'Prediction'</span>, marker<span class="op">=</span><span class="st">'.'</span>,color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Predicted vs. Actual Energy Consumption: </span><span class="sc">{</span>start_date<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>end_date<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>Text(0.5, 1.0, 'Predicted vs. Actual Energy Consumption: 04-01-2018 to 04-08-2018')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-45-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="forecasting-the-future" class="level1">
<h1>10. <a id="toc10_"></a><a href="#toc0_">Forecasting the Future</a></h1>
<div id="d779e5ba-06e6-483a-9a50-7c881f8eff03" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>FEATURES <span class="op">=</span> [<span class="st">'dayofyear'</span>, <span class="st">'hour'</span>, <span class="st">'dayofweek'</span>, <span class="st">'quarter'</span>, <span class="st">'month'</span>, <span class="st">'year'</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'lag1'</span>,<span class="st">'lag2'</span>,<span class="st">'lag3'</span>]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>TARGET <span class="op">=</span> <span class="st">'PJME_MW'</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>X_all <span class="op">=</span> df[FEATURES]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>y_all <span class="op">=</span> df[TARGET]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e91345bc-ec2b-4cf5-9fcb-84ea71f6b4a4" class="cell" data-tags="[]" data-execution_count="46">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>model.fit(X_all, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>          y_all,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>          eval_set<span class="op">=</span>[(X_all, y_all)],</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>          verbose<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0] validation_0-rmse:32403.75596
[100]   validation_0-rmse:12426.47572
[200]   validation_0-rmse:5752.30602
[300]   validation_0-rmse:3971.89168
[400]   validation_0-rmse:3571.56955
[500]   validation_0-rmse:3455.87507
[600]   validation_0-rmse:3402.19853
[700]   validation_0-rmse:3365.64606
[800]   validation_0-rmse:3334.40208
[900]   validation_0-rmse:3308.46216
[999]   validation_0-rmse:3283.79395</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBRegressor(base_score=0.5, booster='gbtree', callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=None, early_stopping_rounds=50,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=0.01, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=3, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=1000, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">XGBRegressor</label><div class="sk-toggleable__content"><pre>XGBRegressor(base_score=0.5, booster='gbtree', callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=None, early_stopping_rounds=50,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=0.01, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=3, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=1000, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<div id="d8f23863-d89b-4c00-ad22-899113dfdb8b" class="cell" data-tags="[]" data-execution_count="47">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df.index.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>Timestamp('2018-08-03 00:00:00')</code></pre>
</div>
</div>
<p>Create future dates to predict <code>PJME_MW</code> for. We forecast one year beyond the end of the data.</p>
<div id="9e65bf7e-89a2-407a-bbc0-9d1f5b42ca15" class="cell" data-tags="[]" data-execution_count="48">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>future <span class="op">=</span> pd.date_range(<span class="st">'2018-08-03'</span>,<span class="st">'2019-08-01'</span>,freq<span class="op">=</span><span class="st">'1h'</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>future_df <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>future)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>future_df[<span class="st">'isFuture'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'isFuture'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>df_and_future <span class="op">=</span> pd.concat([df,future_df])</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>df_and_future <span class="op">=</span> create_features(df_and_future)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>df_and_future <span class="op">=</span> add_lags(df_and_future)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="859a3995-fceb-4729-9fb6-0e4fa80554e0" class="cell" data-tags="[]" data-execution_count="49">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_and_future</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">dayofweek</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dayofyear</th>
<th data-quarto-table-cell-role="th">lag1</th>
<th data-quarto-table-cell-role="th">lag2</th>
<th data-quarto-table-cell-role="th">lag3</th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">isFuture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-01 01:00:00</td>
<td>30393.0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-01-01 02:00:00</td>
<td>29265.0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-01 03:00:00</td>
<td>28357.0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-01-01 04:00:00</td>
<td>27899.0</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-01 05:00:00</td>
<td>28057.0</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2002</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-07-31 20:00:00</td>
<td>NaN</td>
<td>20</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>46912.0</td>
<td>39352.0</td>
<td>40243.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-07-31 21:00:00</td>
<td>NaN</td>
<td>21</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>45985.0</td>
<td>38699.0</td>
<td>39183.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-07-31 22:00:00</td>
<td>NaN</td>
<td>22</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>44094.0</td>
<td>37346.0</td>
<td>37759.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-07-31 23:00:00</td>
<td>NaN</td>
<td>23</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>40666.0</td>
<td>34555.0</td>
<td>34641.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-08-01 00:00:00</td>
<td>NaN</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2019</td>
<td>213</td>
<td>37158.0</td>
<td>31646.0</td>
<td>31470.0</td>
<td>NaN</td>
<td>True</td>
</tr>
</tbody>
</table>

<p>154066 rows × 12 columns</p>
</div>
</div>
</div>
<div id="53be2c8e-5f77-4f63-b084-75af3c2e02c7" class="cell" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>future_w_features <span class="op">=</span> df_and_future.query(<span class="st">'isFuture'</span>).copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5484ceae-7dee-482a-8d64-daa2064f2b35" class="cell" data-tags="[]" data-execution_count="51">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>future_w_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PJME_MW</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">dayofweek</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dayofyear</th>
<th data-quarto-table-cell-role="th">lag1</th>
<th data-quarto-table-cell-role="th">lag2</th>
<th data-quarto-table-cell-role="th">lag3</th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">isFuture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-08-03 00:00:00</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>215</td>
<td>33539.0</td>
<td>32094.0</td>
<td>31695.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-08-03 01:00:00</td>
<td>NaN</td>
<td>1</td>
<td>4</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>215</td>
<td>30781.0</td>
<td>29503.0</td>
<td>29128.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-08-03 02:00:00</td>
<td>NaN</td>
<td>2</td>
<td>4</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>215</td>
<td>29015.0</td>
<td>27712.0</td>
<td>27373.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-08-03 03:00:00</td>
<td>NaN</td>
<td>3</td>
<td>4</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>215</td>
<td>27884.0</td>
<td>26535.0</td>
<td>26233.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-08-03 04:00:00</td>
<td>NaN</td>
<td>4</td>
<td>4</td>
<td>3</td>
<td>8</td>
<td>2018</td>
<td>215</td>
<td>27223.0</td>
<td>25870.0</td>
<td>25643.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-07-31 20:00:00</td>
<td>NaN</td>
<td>20</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>46912.0</td>
<td>39352.0</td>
<td>40243.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-07-31 21:00:00</td>
<td>NaN</td>
<td>21</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>45985.0</td>
<td>38699.0</td>
<td>39183.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-07-31 22:00:00</td>
<td>NaN</td>
<td>22</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>44094.0</td>
<td>37346.0</td>
<td>37759.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-07-31 23:00:00</td>
<td>NaN</td>
<td>23</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>2019</td>
<td>212</td>
<td>40666.0</td>
<td>34555.0</td>
<td>34641.0</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-08-01 00:00:00</td>
<td>NaN</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>8</td>
<td>2019</td>
<td>213</td>
<td>37158.0</td>
<td>31646.0</td>
<td>31470.0</td>
<td>NaN</td>
<td>True</td>
</tr>
</tbody>
</table>

<p>8713 rows × 12 columns</p>
</div>
</div>
</div>
<div id="f7c228ff-3936-41c4-80c4-7d2f6282d5f6" class="cell" data-tags="[]" data-execution_count="52">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>future_w_features[<span class="st">'prediction'</span>] <span class="op">=</span> model.predict(future_w_features[FEATURES])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d702c14b-7626-42ae-baa2-b91ac12620b2" class="cell" data-tags="[]" data-execution_count="53">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>future_w_features[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>2018-08-03 00:00:00    31290.783203
2018-08-03 01:00:00    29021.386719
2018-08-03 02:00:00    28264.789062
2018-08-03 03:00:00    27622.343750
2018-08-03 04:00:00    27305.328125
                           ...     
2019-07-31 20:00:00    42632.207031
2019-07-31 21:00:00    41855.734375
2019-07-31 22:00:00    40528.839844
2019-07-31 23:00:00    37727.152344
2019-08-01 00:00:00    32205.539062
Name: prediction, Length: 8713, dtype: float32</code></pre>
</div>
</div>
<div id="4ecd517f-9501-49b3-a6af-b5bbda8239c9" class="cell" data-tags="[]" data-execution_count="54">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>future_w_features[<span class="st">'prediction'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>count     8713.000000
mean     30962.250000
std       5223.142090
min      20941.083984
25%      27205.164062
50%      30601.240234
75%      33895.183594
max      46665.578125
Name: prediction, dtype: float64</code></pre>
</div>
</div>
<div id="b54c8776-6a40-46b2-a091-432c08015b38" class="cell" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">8</span>))</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>future_w_features[<span class="st">'prediction'</span>],</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span>color_pal[<span class="dv">5</span>],</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>             ms<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>             lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time'</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Predicted Energy Consumption (MW)'</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'PJME Energy Consumption, Forecasted with XGBoost'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>Text(0.5, 1.0, 'PJME Energy Consumption, Forecasted with XGBoost')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-56-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>