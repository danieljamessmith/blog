<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Smith">
<meta name="dcterms.date" content="2024-01-23">
<meta name="description" content="Sentiment analysis is performed on a dataset of Amazon reviews using NLTK’s VADER and a RoBERTa-base model from Hugging Face.">

<title>djs - Portfolio - Sentiment Analysis with NLTK and Hugging Face Transformers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">djs - Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sentiment Analysis with NLTK and Hugging Face Transformers</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">Natural Language Processing</div>
    <div class="quarto-category">NLTK</div>
    <div class="quarto-category">Hugging Face</div>
    <div class="quarto-category">Sentiment Analysis</div>
  </div>
  </div>

<div>
  <div class="description">
    Sentiment analysis is performed on a dataset of Amazon reviews using NLTK’s VADER and a RoBERTa-base model from Hugging Face.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Smith </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>color_pal <span class="op">=</span> sns.color_palette(<span class="st">"mako"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.notebook <span class="im">import</span> tqdm  <span class="co">#Progress Bar</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.sentiment <span class="im">import</span> SentimentIntensityAnalyzer</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer, AutoModelForSequenceClassification</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.special <span class="im">import</span> softmax</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, module<span class="op">=</span><span class="st">"torch._utils"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sentiment analysis is a standard application of natural language processing (NLP) in which a machine learning algorithm is trained to classify text as having either positive, negative or neutral emotional tone.</p>
<p>As a subfield of NLP, sentiment analysis is closely related to computational linguistics. Sentiment analysis has also been found to be useful in the implementation of recommender systems, in which an automated understanding of the emotional content of reviews proves to be crucial for accurate and personalized content recommendation.</p>
<p>In this post sentiment analysis is performed on a dataset of Amazon reviews using both NLTK’s VADER sentiment analysis tool and the Hugging Face transformer-based model RoBERTa.</p>
<section id="contents" class="level1">
<h1>Contents</h1>
<ul>
<li><ol type="1">
<li><a href="#data">Data</a></li>
</ol></li>
<li><ol start="2" type="1">
<li><a href="#vader">Sentiment Analysis with VADER</a></li>
</ol></li>
<li><ol start="3" type="1">
<li><a href="#rob">Sentiment Analysis with a Hugging Face Transformer (RoBERTa)</a></li>
</ol></li>
<li><ol start="4" type="1">
<li><a href="#comp">Comparing Models</a></li>
</ol></li>
</ul>
<p><a name="data"></a></p>
</section>
<section id="data" class="level1">
<h1>1 - Data</h1>
<p>The data can be downloaded from <a href="https://www.kaggle.com/datasets/snap/amazon-fine-food-reviews/data">Kaggle</a> and consists of 568,454 Amazon reviews of of 74,258 fine foods products by 256,059 users between Oct 1999 - Oct 2012. This post is based upon a <a href="https://www.youtube.com/watch?v=QpzMWQvxXWk">Youtube video</a> by <a href="https://www.youtube.com/@robmulla">Rob Mulla</a>.</p>
<div class="cell" data-tags="[]" data-execution_count="47">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Reviews.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="48">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Id</th>
<th data-quarto-table-cell-role="th">ProductId</th>
<th data-quarto-table-cell-role="th">UserId</th>
<th data-quarto-table-cell-role="th">ProfileName</th>
<th data-quarto-table-cell-role="th">HelpfulnessNumerator</th>
<th data-quarto-table-cell-role="th">HelpfulnessDenominator</th>
<th data-quarto-table-cell-role="th">Score</th>
<th data-quarto-table-cell-role="th">Time</th>
<th data-quarto-table-cell-role="th">Summary</th>
<th data-quarto-table-cell-role="th">Text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>B001E4KFG0</td>
<td>A3SGXH7AUHU8GW</td>
<td>delmartian</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1303862400</td>
<td>Good Quality Dog Food</td>
<td>I have bought several of the Vitality canned d...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>B00813GRG4</td>
<td>A1D87F6ZCVE5NK</td>
<td>dll pa</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1346976000</td>
<td>Not as Advertised</td>
<td>Product arrived labeled as Jumbo Salted Peanut...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>B000LQOCH0</td>
<td>ABXLMWJIXXAIN</td>
<td>Natalia Corres "Natalia Corres"</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>1219017600</td>
<td>"Delight" says it all</td>
<td>This is a confection that has been around a fe...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>B000UA0QIQ</td>
<td>A395BORC6FGVXV</td>
<td>Karl</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>1307923200</td>
<td>Cough Medicine</td>
<td>If you are looking for the secret ingredient i...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>B006K2ZZ7K</td>
<td>A1UQRSCLF8GW1T</td>
<td>Michael D. Bigham "M. Wassir"</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>1350777600</td>
<td>Great taffy</td>
<td>Great taffy at a great price. There was a wid...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="49">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>'I have bought several of the Vitality canned dog food products and have found them all to be of good quality. The product looks more like a stew than a processed meat and it smells better. My Labrador is finicky and she appreciates this product better than  most.'</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>(568454, 10)</code></pre>
</div>
</div>
<p>Working with the over half a million reviews directly would be computationally expensive. In the interests of time we look only at the first 1000 reviews. The techniques used would not change when working with the full dataset.</p>
<div class="cell" data-tags="[]" data-execution_count="51">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.head(<span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a name="eda"></a></p>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">1.1 - EDA</h2>
<div class="cell" data-tags="[]" data-execution_count="52">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df[<span class="st">'Score'</span>].value_counts().sort_index() <span class="op">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'bar'</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Count of Reviews by Stars'</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>          figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>          color <span class="op">=</span> color_pal[<span class="dv">3</span>])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Review Stars'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Reviews'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>Text(0, 0.5, 'Number of Reviews')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="53">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating a worldcloud of all the text in the 'Text' column of the dataframe</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(df[<span class="st">'Text'</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>,colormap<span class="op">=</span><span class="st">'mako'</span>).generate(text)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>(-0.5, 799.5, 399.5, -0.5)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="54">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'ReviewLength'</span>] <span class="op">=</span> df[<span class="st">'Text'</span>].<span class="bu">apply</span>(<span class="bu">len</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">'ReviewLength'</span>], bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span>color_pal[<span class="dv">2</span>], edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Review Lengths'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Review Length (Number of Characters)'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Reviews'</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> CountVectorizer(stop_words<span class="op">=</span><span class="st">'english'</span>, max_features<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>word_matrix <span class="op">=</span> vectorizer.fit_transform(df[<span class="st">'Text'</span>])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>word_frequency <span class="op">=</span> word_matrix.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> vectorizer.get_feature_names_out()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> word_frequency.A1</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>sorted_indices <span class="op">=</span> counts.argsort()[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> [words[i] <span class="cf">for</span> i <span class="kw">in</span> sorted_indices]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> counts[sorted_indices]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>words, y<span class="op">=</span>counts, palette<span class="op">=</span><span class="st">'mako'</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 20 Most Common Words in Reviews'</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Words'</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="cleaning-text" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-text">1.2 - Cleaning Text</h2>
<p>“br” is such a common word beacuse it is present in many of the reviews as a html tag: <code>&lt;br&gt;&lt;/br&gt;</code></p>
<p>We can fix this using the BeautifulSoup library.</p>
<div class="cell" data-tags="[]" data-execution_count="56">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_text(text):</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove HTML tags</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(<span class="bu">str</span>(text), <span class="st">'html.parser'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    cleaned_text <span class="op">=</span> soup.get_text()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cleaned_text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="57">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Text'</span>] <span class="op">=</span> df[<span class="st">'Text'</span>].<span class="bu">apply</span>(clean_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="58">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating a worldcloud of all the text in the 'Text' column of the dataframe</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(df[<span class="st">'Text'</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>,colormap<span class="op">=</span><span class="st">'mako'</span>).generate(text)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>(-0.5, 799.5, 399.5, -0.5)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="59">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> CountVectorizer(stop_words<span class="op">=</span><span class="st">'english'</span>, max_features<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>word_matrix <span class="op">=</span> vectorizer.fit_transform(df[<span class="st">'Text'</span>])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>word_frequency <span class="op">=</span> word_matrix.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> vectorizer.get_feature_names_out()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> word_frequency.A1</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>sorted_indices <span class="op">=</span> counts.argsort()[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> [words[i] <span class="cf">for</span> i <span class="kw">in</span> sorted_indices]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> counts[sorted_indices]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>words, y<span class="op">=</span>counts, palette<span class="op">=</span><span class="st">'mako'</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 20 Most Common Words in Reviews'</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Words'</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><a name="vader"></a></p>
</section>
</section>
<section id="sentiment-analysis-with-vader" class="level1">
<h1>2 - Sentiment Analysis with VADER</h1>
<p>NLTK’s <a href="https://www.nltk.org/api/nltk.sentiment.vader.html">VADER</a>, short for “Valence Aware Dictionary and sEntiment Reasoner,” is a pre-built sentiment analysis tool designed for analyzing the sentiment of text data, particularly in the context of natural language processing tasks.</p>
<section id="basic-nltk" class="level2">
<h2 class="anchored" data-anchor-id="basic-nltk">2.1 - Basic NLTK</h2>
<p>NLTK stands for <a href="https://www.nltk.org/">Natural Language Toolkit</a>. It is a comprehensive library in Python that provides tools and resources for working text data. NLTK includes various modules and packages for tasks such as tokenization, stemming, tagging, parsing, and sentiment analysis, making it a valuable resource for NLP tasks.</p>
<div class="cell" data-tags="[]" data-execution_count="60">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>example <span class="op">=</span> df[<span class="st">'Text'</span>][<span class="dv">50</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This oatmeal is not good. Its mushy, soft, I don't like it. Quaker Oats is the way to go.</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="61">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="op">=</span> nltk.word_tokenize(example)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tokens[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>['This', 'oatmeal', 'is', 'not', 'good', '.', 'Its', 'mushy', ',', 'soft']</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="62">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tagged <span class="op">=</span> nltk.pos_tag(tokens)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>tagged[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>[('This', 'DT'),
 ('oatmeal', 'NN'),
 ('is', 'VBZ'),
 ('not', 'RB'),
 ('good', 'JJ'),
 ('.', '.'),
 ('Its', 'PRP$'),
 ('mushy', 'NN'),
 (',', ','),
 ('soft', 'JJ')]</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="63">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>entities <span class="op">=</span> nltk.chunk.ne_chunk(tagged)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>entities.pprint()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(S
  This/DT
  oatmeal/NN
  is/VBZ
  not/RB
  good/JJ
  ./.
  Its/PRP$
  mushy/NN
  ,/,
  soft/JJ
  ,/,
  I/PRP
  do/VBP
  n't/RB
  like/VB
  it/PRP
  ./.
  (ORGANIZATION Quaker/NNP Oats/NNPS)
  is/VBZ
  the/DT
  way/NN
  to/TO
  go/VB
  ./.)</code></pre>
</div>
</div>
</section>
<section id="sentimentintensityanalyzer" class="level2">
<h2 class="anchored" data-anchor-id="sentimentintensityanalyzer">2.2 - SentimentIntensityAnalyzer</h2>
<p><code>SentimentIntensityAnalyzer</code> is a class in the NLTK library’s VADER module. It is designed for sentiment analysis and provides a pre-trained machine learning model to assess the sentiment of a piece of text by analyzing the intensity of positive, negative, and neutral sentiments.</p>
<p>This uses a “bag of words” approach in which: 1. Stop words are removed 2. Each word is scored, and combined to give a total score</p>
<div class="cell" data-tags="[]" data-execution_count="64">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sia <span class="op">=</span> SentimentIntensityAnalyzer()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="65">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>sia.polarity_scores(<span class="st">'This is a positive sentence.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>{'neg': 0.0, 'neu': 0.29, 'pos': 0.71, 'compound': 0.5994}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="66">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sia.polarity_scores(<span class="st">'This is a negative sentence.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>{'neg': 0.529, 'neu': 0.286, 'pos': 0.186, 'compound': -0.5267}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="67">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>sia.polarity_scores(<span class="st">'I am so happy!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>{'neg': 0.0, 'neu': 0.318, 'pos': 0.682, 'compound': 0.6468}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="68">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>sia.polarity_scores(<span class="st">'I hate this product'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>{'neg': 0.649, 'neu': 0.351, 'pos': 0.0, 'compound': -0.5719}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="69">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>"This oatmeal is not good. Its mushy, soft, I don't like it. Quaker Oats is the way to go."</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>sia.polarity_scores(example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>{'neg': 0.22, 'neu': 0.78, 'pos': 0.0, 'compound': -0.5448}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="71">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the polarity score on the entire dataset</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> {}</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> tqdm(df.iterrows(), total<span class="op">=</span><span class="bu">len</span>(df)):</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> row[<span class="st">'Text'</span>]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    myid <span class="op">=</span> row[<span class="st">'Id'</span>]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    res[myid] <span class="op">=</span> sia.polarity_scores(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"72e03a6ee94245389c48b1b2fe118f64","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="72">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert res to a dataframe</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>vaders <span class="op">=</span> pd.DataFrame(res).T</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>vaders <span class="op">=</span> vaders.reset_index().rename(columns<span class="op">=</span>{<span class="st">'index'</span>:<span class="st">'Id'</span>})</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>vaders <span class="op">=</span> vaders.merge(df,how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="73">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we have sentiment score and metadata</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>vaders</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Id</th>
<th data-quarto-table-cell-role="th">neg</th>
<th data-quarto-table-cell-role="th">neu</th>
<th data-quarto-table-cell-role="th">pos</th>
<th data-quarto-table-cell-role="th">compound</th>
<th data-quarto-table-cell-role="th">ProductId</th>
<th data-quarto-table-cell-role="th">UserId</th>
<th data-quarto-table-cell-role="th">ProfileName</th>
<th data-quarto-table-cell-role="th">HelpfulnessNumerator</th>
<th data-quarto-table-cell-role="th">HelpfulnessDenominator</th>
<th data-quarto-table-cell-role="th">Score</th>
<th data-quarto-table-cell-role="th">Time</th>
<th data-quarto-table-cell-role="th">Summary</th>
<th data-quarto-table-cell-role="th">Text</th>
<th data-quarto-table-cell-role="th">ReviewLength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.000</td>
<td>0.695</td>
<td>0.305</td>
<td>0.9441</td>
<td>B001E4KFG0</td>
<td>A3SGXH7AUHU8GW</td>
<td>delmartian</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1303862400</td>
<td>Good Quality Dog Food</td>
<td>I have bought several of the Vitality canned d...</td>
<td>263</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0.138</td>
<td>0.862</td>
<td>0.000</td>
<td>-0.5664</td>
<td>B00813GRG4</td>
<td>A1D87F6ZCVE5NK</td>
<td>dll pa</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1346976000</td>
<td>Not as Advertised</td>
<td>Product arrived labeled as Jumbo Salted Peanut...</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>0.091</td>
<td>0.754</td>
<td>0.155</td>
<td>0.8265</td>
<td>B000LQOCH0</td>
<td>ABXLMWJIXXAIN</td>
<td>Natalia Corres "Natalia Corres"</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>1219017600</td>
<td>"Delight" says it all</td>
<td>This is a confection that has been around a fe...</td>
<td>509</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>0.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.0000</td>
<td>B000UA0QIQ</td>
<td>A395BORC6FGVXV</td>
<td>Karl</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>1307923200</td>
<td>Cough Medicine</td>
<td>If you are looking for the secret ingredient i...</td>
<td>219</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>0.000</td>
<td>0.552</td>
<td>0.448</td>
<td>0.9468</td>
<td>B006K2ZZ7K</td>
<td>A1UQRSCLF8GW1T</td>
<td>Michael D. Bigham "M. Wassir"</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>1350777600</td>
<td>Great taffy</td>
<td>Great taffy at a great price. There was a wid...</td>
<td>140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">995</td>
<td>996</td>
<td>0.026</td>
<td>0.716</td>
<td>0.257</td>
<td>0.9788</td>
<td>B006F2NYI2</td>
<td>A1D3F6UI1RTXO0</td>
<td>Swopes</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1331856000</td>
<td>Hot &amp; Flavorful</td>
<td>BLACK MARKET HOT SAUCE IS WONDERFUL.... My hus...</td>
<td>477</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">996</td>
<td>997</td>
<td>0.000</td>
<td>0.786</td>
<td>0.214</td>
<td>0.9309</td>
<td>B006F2NYI2</td>
<td>AF50D40Y85TV3</td>
<td>Mike A.</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1328140800</td>
<td>Great Hot Sauce and people who run it!</td>
<td>Man what can i say, this salsa is the bomb!! i...</td>
<td>305</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">997</td>
<td>998</td>
<td>0.000</td>
<td>0.673</td>
<td>0.327</td>
<td>0.9634</td>
<td>B006F2NYI2</td>
<td>A3G313KLWDG3PW</td>
<td>kefka82</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1324252800</td>
<td>this sauce is the shiznit</td>
<td>this sauce is so good with just about anything...</td>
<td>265</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">998</td>
<td>999</td>
<td>0.063</td>
<td>0.874</td>
<td>0.062</td>
<td>-0.0129</td>
<td>B006F2NYI2</td>
<td>A3NIDDT7E7JIFW</td>
<td>V. B. Brookshaw</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1336089600</td>
<td>Not Hot</td>
<td>Not hot at all. Like the other low star review...</td>
<td>280</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999</td>
<td>1000</td>
<td>0.032</td>
<td>0.928</td>
<td>0.041</td>
<td>-0.1027</td>
<td>B006F2NYI2</td>
<td>A132DJVI37RB4X</td>
<td>Scottdrum</td>
<td>2</td>
<td>5</td>
<td>2</td>
<td>1332374400</td>
<td>Not hot, not habanero</td>
<td>I have to admit, I was a sucker for the large ...</td>
<td>563</td>
</tr>
</tbody>
</table>

<p>1000 rows × 15 columns</p>
</div>
</div>
</div>
</section>
<section id="plotting-vader-results" class="level2">
<h2 class="anchored" data-anchor-id="plotting-vader-results">2.3 - Plotting VADER Results</h2>
<div class="cell" data-tags="[]" data-execution_count="74">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.barplot(data<span class="op">=</span>vaders,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                 x <span class="op">=</span> <span class="st">'Score'</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                 y <span class="op">=</span> <span class="st">'compound'</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                 palette <span class="op">=</span> color_pal)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Compound Score by Amazon Star Review'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>Text(0.5, 1.0, 'Compound Score by Amazon Star Review')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-30-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Unsuprisingly there is a positive correlation between review score (stars out of five) and the compound score from VADER.</p>
<div class="cell" data-tags="[]" data-execution_count="75">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>vaders, x <span class="op">=</span> <span class="st">'Score'</span>, y <span class="op">=</span> <span class="st">'pos'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>], palette <span class="op">=</span> color_pal)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Positive Score'</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>vaders, x <span class="op">=</span> <span class="st">'Score'</span>, y <span class="op">=</span> <span class="st">'neu'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>], palette <span class="op">=</span> color_pal)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Neutral Score'</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>vaders, x <span class="op">=</span> <span class="st">'Score'</span>, y <span class="op">=</span> <span class="st">'neg'</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>], palette <span class="op">=</span> color_pal)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="st">'Negative Score'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><a name="rob"></a></p>
</section>
</section>
<section id="sentiment-analysis-with-a-hugging-face-transformer-roberta" class="level1">
<h1>3 - Sentiment Analysis with a Hugging Face Transformer (RoBERTa)</h1>
<ul>
<li>Hugging Face is an AI research organization that has contributed significantly to the development of transformer-based models for NLP. The Hugging Face Transformers library is a popular open-source library that provides pre-trained transformer models, including RoBERTa.</li>
<li>RoBERTa is a robustly optimized transformer-based natural language processing model developed by Facebook AI Research (FAIR), designed as an extension and enhancement of the BERT architecture.</li>
<li>The powerful transformer model acounts not only for the words but also the context related to other words, a fact that makes RoBERTa more expressive than VADER.</li>
</ul>
<p>The specific model we use here can be found at https://huggingface.co/cardiffnlp/twitter-roberta-base-sentiment</p>
<p>It is a RoBERTa-base model pre-trained on a dataset of over 50 million tweets and fine-tuned for sentiment analysis. This is an example of <em>transfer learning</em>, the application to a task of a ML model that has been pre-trained on data for another closely related task for which data is more easily gathered.</p>
<div class="cell" data-tags="[]" data-execution_count="76">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>task <span class="op">=</span> <span class="st">"sentiment"</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>MODEL <span class="op">=</span> <span class="ss">f"cardiffnlp/twitter-roberta-base-</span><span class="sc">{</span>task<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> AutoModelForSequenceClassification.from_pretrained(MODEL)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(MODEL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="77">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VADER results on example</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(example)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>sia.polarity_scores(example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This oatmeal is not good. Its mushy, soft, I don't like it. Quaker Oats is the way to go.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>{'neg': 0.22, 'neu': 0.78, 'pos': 0.0, 'compound': -0.5448}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="78">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run for Roberta Model</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>encoded_text <span class="op">=</span> tokenizer(example, return_tensors<span class="op">=</span><span class="st">'pt'</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> model(<span class="op">**</span>encoded_text)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> output[<span class="dv">0</span>][<span class="dv">0</span>].detach().numpy() <span class="co"># Save scores as NumPy array</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> softmax(scores)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>scores_dict <span class="op">=</span> {</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'roberta_neg'</span> : scores[<span class="dv">0</span>],</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'roberta_neu'</span> : scores[<span class="dv">1</span>],</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'roberta_pos'</span> : scores[<span class="dv">2</span>]</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="79">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(scores_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'roberta_neg': 0.97635514, 'roberta_neu': 0.020687459, 'roberta_pos': 0.0029573692}</code></pre>
</div>
</div>
<p>Roberta is far more certain that the example review is negative in sentiment than the VADER model. I would agree.</p>
<div class="cell" data-tags="[]" data-execution_count="80">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> polarity_scores_roberta(example):</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Applies the Roberta model to extract polarity scores for an inputted review</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments:</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">    example - A string representing the text attached to an amazon review</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">    scores_dict - A dictionary containing the negative/neutral/positive scores</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    encoded_text <span class="op">=</span> tokenizer(example, return_tensors<span class="op">=</span><span class="st">'pt'</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> model(<span class="op">**</span>encoded_text)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> output[<span class="dv">0</span>][<span class="dv">0</span>].detach().numpy()</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> softmax(scores)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    scores_dict <span class="op">=</span> {</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'roberta_neg'</span> : scores[<span class="dv">0</span>],</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'roberta_neu'</span> : scores[<span class="dv">1</span>],</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'roberta_pos'</span> : scores[<span class="dv">2</span>]</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scores_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="81">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> {}</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> tqdm(df.iterrows(), total<span class="op">=</span><span class="bu">len</span>(df)):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>: </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> row[<span class="st">'Text'</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        myid <span class="op">=</span> row[<span class="st">'Id'</span>]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        vader_result <span class="op">=</span> sia.polarity_scores(text)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Rename the keys for the VADER results for consistency</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        vader_result_rename <span class="op">=</span> {}</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key, value <span class="kw">in</span> vader_result.items():</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>            vader_result_rename[<span class="ss">f"vader_</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> value</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        roberta_result <span class="op">=</span> polarity_scores_roberta(text)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        both <span class="op">=</span> {<span class="op">**</span>vader_result_rename, <span class="op">**</span>roberta_result} <span class="co">#Combine dictionaries</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        res[myid] <span class="op">=</span> both</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">RuntimeError</span>:        <span class="co">#Avoids the loop breaking when a review cannot be parsed by the model</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Broke for id </span><span class="sc">{</span>myid<span class="sc">}</span><span class="ss">'</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"509e3a36785b481d8789cf3be66bbebb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Broke for id 83
Broke for id 187
Broke for id 529
Broke for id 540
Broke for id 746
Broke for id 863</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="82">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>both</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>{'vader_neg': 0.032,
 'vader_neu': 0.928,
 'vader_pos': 0.041,
 'vader_compound': -0.1027,
 'roberta_neg': 0.8209421,
 'roberta_neu': 0.15652642,
 'roberta_pos': 0.022531545}</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="83">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame(res).T</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> results_df.reset_index().rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'Id'</span>})</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> results_df.merge(df, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="84">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>results_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Id</th>
<th data-quarto-table-cell-role="th">vader_neg</th>
<th data-quarto-table-cell-role="th">vader_neu</th>
<th data-quarto-table-cell-role="th">vader_pos</th>
<th data-quarto-table-cell-role="th">vader_compound</th>
<th data-quarto-table-cell-role="th">roberta_neg</th>
<th data-quarto-table-cell-role="th">roberta_neu</th>
<th data-quarto-table-cell-role="th">roberta_pos</th>
<th data-quarto-table-cell-role="th">ProductId</th>
<th data-quarto-table-cell-role="th">UserId</th>
<th data-quarto-table-cell-role="th">ProfileName</th>
<th data-quarto-table-cell-role="th">HelpfulnessNumerator</th>
<th data-quarto-table-cell-role="th">HelpfulnessDenominator</th>
<th data-quarto-table-cell-role="th">Score</th>
<th data-quarto-table-cell-role="th">Time</th>
<th data-quarto-table-cell-role="th">Summary</th>
<th data-quarto-table-cell-role="th">Text</th>
<th data-quarto-table-cell-role="th">ReviewLength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.000</td>
<td>0.695</td>
<td>0.305</td>
<td>0.9441</td>
<td>0.009624</td>
<td>0.049980</td>
<td>0.940395</td>
<td>B001E4KFG0</td>
<td>A3SGXH7AUHU8GW</td>
<td>delmartian</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>1303862400</td>
<td>Good Quality Dog Food</td>
<td>I have bought several of the Vitality canned d...</td>
<td>263</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0.138</td>
<td>0.862</td>
<td>0.000</td>
<td>-0.5664</td>
<td>0.508986</td>
<td>0.452414</td>
<td>0.038600</td>
<td>B00813GRG4</td>
<td>A1D87F6ZCVE5NK</td>
<td>dll pa</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1346976000</td>
<td>Not as Advertised</td>
<td>Product arrived labeled as Jumbo Salted Peanut...</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>0.091</td>
<td>0.754</td>
<td>0.155</td>
<td>0.8265</td>
<td>0.003229</td>
<td>0.098067</td>
<td>0.898704</td>
<td>B000LQOCH0</td>
<td>ABXLMWJIXXAIN</td>
<td>Natalia Corres "Natalia Corres"</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>1219017600</td>
<td>"Delight" says it all</td>
<td>This is a confection that has been around a fe...</td>
<td>509</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>0.000</td>
<td>1.000</td>
<td>0.000</td>
<td>0.0000</td>
<td>0.002295</td>
<td>0.090219</td>
<td>0.907486</td>
<td>B000UA0QIQ</td>
<td>A395BORC6FGVXV</td>
<td>Karl</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>1307923200</td>
<td>Cough Medicine</td>
<td>If you are looking for the secret ingredient i...</td>
<td>219</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>0.000</td>
<td>0.552</td>
<td>0.448</td>
<td>0.9468</td>
<td>0.001635</td>
<td>0.010302</td>
<td>0.988063</td>
<td>B006K2ZZ7K</td>
<td>A1UQRSCLF8GW1T</td>
<td>Michael D. Bigham "M. Wassir"</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>1350777600</td>
<td>Great taffy</td>
<td>Great taffy at a great price. There was a wid...</td>
<td>140</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="85">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>results_df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>Index(['Id', 'vader_neg', 'vader_neu', 'vader_pos', 'vader_compound',
       'roberta_neg', 'roberta_neu', 'roberta_pos', 'ProductId', 'UserId',
       'ProfileName', 'HelpfulnessNumerator', 'HelpfulnessDenominator',
       'Score', 'Time', 'Summary', 'Text', 'ReviewLength'],
      dtype='object')</code></pre>
</div>
</div>
<p><a name="comp"></a></p>
</section>
<section id="comparing-models" class="level1">
<h1>4 - Comparing Models</h1>
<div class="cell" data-tags="[]" data-execution_count="86">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'vader_neg'</span>, <span class="st">'vader_neu'</span>, <span class="st">'vader_pos'</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'roberta_neg'</span>, <span class="st">'roberta_neu'</span>, <span class="st">'roberta_pos'</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>sns.pairplot(data<span class="op">=</span>results_df,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>             <span class="bu">vars</span><span class="op">=</span>cols,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>             hue<span class="op">=</span><span class="st">'Score'</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>             palette<span class="op">=</span>color_pal[:<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="reviewing-examples" class="level1">
<h1>4.1 - Reviewing Examples</h1>
<p>We can look at some specific examples of reviews with extreme sentiment to try and gain some insight into the limitations of the models.</p>
<div class="cell" data-tags="[]" data-execution_count="87">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing the 1 star review with the highest positive polarity according to each model</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>roberta_result <span class="op">=</span> results_df.query(<span class="st">'Score == 1'</span>) <span class="op">\</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'roberta_pos'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>vader_result <span class="op">=</span> results_df.query(<span class="st">'Score == 1'</span>) <span class="op">\</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'vader_pos'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"1 Star Review with Highest Positive Polarity (VADER):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>vader_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">------------------------------------------------------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"1 Star Review with Highest Positive Polarity (RoBERTa):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>roberta_result<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 Star Review with Highest Positive Polarity (VADER):

 So we cancelled the order.  It was cancelled without any problem.  That is a positive note...

------------------------------------------------------------------------------

1 Star Review with Highest Positive Polarity (RoBERTa):

 I just wanted to post here that I found small bits of plastic in this food as I was feeding my 9 month old.  Plastic!!! in food!!!! baby food!!!  So please be careful if you buy this or are considering it.My daughter LOVES this food-- it's actually her favorite.  This is the first time we have noticed plastic in it in over 2 months.

</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="88">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing the 5 star review with the highest negative polarity according to each model</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>roberta_result <span class="op">=</span> results_df.query(<span class="st">'Score == 5'</span>) <span class="op">\</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'roberta_neg'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>vader_result <span class="op">=</span> results_df.query(<span class="st">'Score == 5'</span>) <span class="op">\</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'vader_neg'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"5 Star Review with Highest Negative Polarity (VADER):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>vader_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">------------------------------------------------------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"5 Star Review with Highest Negative Polarity (RoBERTa):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>roberta_result<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5 Star Review with Highest Negative Polarity (VADER):

 this was sooooo deliscious but too bad i ate em too fast and gained 2 pds! my fault

------------------------------------------------------------------------------

5 Star Review with Highest Negative Polarity (RoBERTa):

 this was sooooo deliscious but too bad i ate em too fast and gained 2 pds! my fault

</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="89">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing the 1 star review with the highest negative polarity according to each model</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>roberta_result <span class="op">=</span> results_df.query(<span class="st">'Score == 1'</span>) <span class="op">\</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'roberta_neg'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>vader_result <span class="op">=</span> results_df.query(<span class="st">'Score == 1'</span>) <span class="op">\</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'vader_neg'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"1 Star Review with Highest Negative Polarity (VADER):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>vader_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">------------------------------------------------------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"1 Star Review with Highest Negative Polarity (RoBERTa):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>roberta_result<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 Star Review with Highest Negative Polarity (VADER):

 The laddoos turned bad in a few days after we received it. No other item inside our fridge turned bad.

------------------------------------------------------------------------------

1 Star Review with Highest Negative Polarity (RoBERTa):

 I so wish I would have read this review before purchasing TWO gallons of this oil for my health issues. It reeks like a chemical rubber smell. This smell is coming from the black rubber gasket in the lid. When I called to report the situation to the company, Sabrina told me I would have to pay to send them a sample to have tested by a lab. Unbelievable. Good customer service would indicate that they would pay for the product to be returned and give me a full refund, including shipping. The product is faulty. Period. I will never order anything from this company again and do not recommend it to anyone based on this horrible customer service and lack of responsibility and ownership.

</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="90">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing the 5 star review with the highest positive polarity according to each model</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>roberta_result <span class="op">=</span> results_df.query(<span class="st">'Score == 5'</span>) <span class="op">\</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'roberta_pos'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>vader_result <span class="op">=</span> results_df.query(<span class="st">'Score == 5'</span>) <span class="op">\</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'vader_pos'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Text'</span>].values[<span class="dv">0</span>]</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"5 Star Review with Highest Positive Polarity (VADER):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>vader_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">------------------------------------------------------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"5 Star Review with Highest Positive Polarity (RoBERTa):</span><span class="ch">\n\n</span><span class="ss"> </span><span class="sc">{</span>roberta_result<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5 Star Review with Highest Positive Polarity (VADER):

 This is an great product. The taste is great, and it works exactly as described. Superb natural sleep aid. AMAZING!

------------------------------------------------------------------------------

5 Star Review with Highest Positive Polarity (RoBERTa):

 This is my son's favorite dinner! Best of all it seems it has the best combo of protein (21%) , vitamin A (100%) and C (30%). It is runnier than most of their dinners which was a great start for solids with protein in it. Love love love this brand and flavor. I think I purchased 50 jars so far.

</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>